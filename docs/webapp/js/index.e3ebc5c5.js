(function(){var e={3161:function(e,t,i){"use strict";i(1703);var n=i(9963),o=i(6252),a=i(3577);function s(e,t,i,n,s,r){const l=(0,o.up)("StandardLayout"),c=(0,o.up)("GameDialog"),h=(0,o.up)("CSAGameDialog"),d=(0,o.up)("ResearchDialog"),u=(0,o.up)("AnalysisDialog"),p=(0,o.up)("USIEngineManagementDialog"),g=(0,o.up)("AppSettingDialog"),m=(0,o.up)("PasteDialog"),_=(0,o.up)("BussyMessage"),v=(0,o.up)("ConfirmDialog"),S=(0,o.up)("CSAGameReadyDialog"),E=(0,o.up)("InfoMessage"),f=(0,o.up)("ErrorMessage");return(0,o.wg)(),(0,o.iD)("div",{class:(0,a.C_)(["root",e.thema])},[(0,o.Wm)(l,{class:"main"}),e.dialogVisibilities.game?((0,o.wg)(),(0,o.j4)(c,{key:0})):(0,o.kq)("",!0),e.dialogVisibilities.csaGame?((0,o.wg)(),(0,o.j4)(h,{key:1})):(0,o.kq)("",!0),e.dialogVisibilities.research?((0,o.wg)(),(0,o.j4)(d,{key:2})):(0,o.kq)("",!0),e.dialogVisibilities.analysis?((0,o.wg)(),(0,o.j4)(u,{key:3})):(0,o.kq)("",!0),e.dialogVisibilities.usiEngineSetting?((0,o.wg)(),(0,o.j4)(p,{key:4})):(0,o.kq)("",!0),e.dialogVisibilities.appSetting?((0,o.wg)(),(0,o.j4)(g,{key:5})):(0,o.kq)("",!0),e.dialogVisibilities.paste?((0,o.wg)(),(0,o.j4)(m,{key:6})):(0,o.kq)("",!0),e.dialogVisibilities.bussy?((0,o.wg)(),(0,o.j4)(_,{key:7})):(0,o.kq)("",!0),e.dialogVisibilities.confirm?((0,o.wg)(),(0,o.j4)(v,{key:8})):(0,o.kq)("",!0),e.dialogVisibilities.csaGameReady?((0,o.wg)(),(0,o.j4)(S,{key:9})):(0,o.kq)("",!0),e.hasMessage?((0,o.wg)(),(0,o.j4)(E,{key:10})):(0,o.kq)("",!0),e.hasErrors?((0,o.wg)(),(0,o.j4)(f,{key:11})):(0,o.kq)("",!0)],2)}const r={class:"main"},l={class:"top-pane"};function c(e,t,i,n,s,c){const h=(0,o.up)("BoardPane"),d=(0,o.up)("RecordPane"),u=(0,o.up)("TabPane");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",r,[(0,o._)("div",l,[(0,o.Wm)(h,{class:"top-left-pane","max-size":e.boardPaneMaxSize,onResize:e.onBoardPaneResize},null,8,["max-size","onResize"]),(0,o.Wm)(d,{class:"top-right-pane",style:(0,a.j5)(e.recordPaneStyle)},null,8,["style"])]),(0,o.Wm)(u,{class:"bottom-pane",size:e.bottomPaneSize},null,8,["size"])])])}var h=i(2262);const d={class:"control top"},u=(0,o.Uk)(" 対局 "),p=(0,o.Uk)(" 対局中断 "),g=(0,o.Uk)(" 勝ち宣言 "),m=(0,o.Uk)(" 投了 "),_=(0,o.Uk)(" 検討 "),v=(0,o.Uk)(" 検討終了 "),S=(0,o.Uk)(" 解析 "),E=(0,o.Uk)(" 解析中断 "),f=(0,o.Uk)(" 局面編集 "),I=(0,o.Uk)(" 局面編集終了 "),y=(0,o.Uk)(" 手番変更 "),w={class:"control bottom"},b=(0,o.Uk)(" アプリ設定 "),A=["disabled"],T=(0,o.Uk)(" エンジン設定 "),N=(0,o.Uk)(" 盤面反転 "),R=(0,o.Uk)(" ファイル "),k=["disabled"],P=(0,o.Uk)(" 指し手削除 ");function C(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon"),l=(0,o.up)("BoardView"),c=(0,o.up)("GameMenu"),h=(0,o.up)("FileMenu"),C=(0,o.up)("InitialPositionMenu");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(l,{"piece-image-type":e.appSetting.pieceImage,"board-image-type":e.appSetting.boardImage,"board-label-type":e.appSetting.boardLabelType,"max-size":e.maxSize,position:e.position,"last-move":e.lastMove,flip:e.appSetting.boardFlipping,"allow-move":e.allowMove,"allow-edit":e.allowEdit,"black-player-name":e.blackPlayerName,"white-player-name":e.whitePlayerName,"black-player-time":e.clock?.black.time,"black-player-byoyomi":e.clock?.black.byoyomi,"white-player-time":e.clock?.white.time,"white-player-byoyomi":e.clock?.white.byoyomi,onResize:e.onResize,onMove:e.onMove,onEdit:e.onEdit},{"right-control":(0,o.w5)((()=>[(0,o._)("div",d,[e.controlStates.game?((0,o.wg)(),(0,o.iD)("button",{key:0,class:"control-item",onClick:t[0]||(t[0]=(...t)=>e.onGame&&e.onGame(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),u])):(0,o.kq)("",!0),e.controlStates.stop?((0,o.wg)(),(0,o.iD)("button",{key:1,class:"control-item",onClick:t[1]||(t[1]=(...t)=>e.onStop&&e.onStop(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.STOP},null,8,["icon"]),p])):(0,o.kq)("",!0),e.controlStates.win?((0,o.wg)(),(0,o.iD)("button",{key:2,class:"control-item",onClick:t[2]||(t[2]=(...t)=>e.onWin&&e.onWin(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CALL},null,8,["icon"]),g])):(0,o.kq)("",!0),e.controlStates.resign?((0,o.wg)(),(0,o.iD)("button",{key:3,class:"control-item",onClick:t[3]||(t[3]=(...t)=>e.onResign&&e.onResign(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.RESIGN},null,8,["icon"]),m])):(0,o.kq)("",!0),e.controlStates.research?((0,o.wg)(),(0,o.iD)("button",{key:4,class:"control-item",onClick:t[4]||(t[4]=(...t)=>e.onResearch&&e.onResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.RESEARCH},null,8,["icon"]),_])):(0,o.kq)("",!0),e.controlStates.endResearch?((0,o.wg)(),(0,o.iD)("button",{key:5,class:"control-item",onClick:t[5]||(t[5]=(...t)=>e.onEndResearch&&e.onEndResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.END},null,8,["icon"]),v])):(0,o.kq)("",!0),e.controlStates.analysis?((0,o.wg)(),(0,o.iD)("button",{key:6,class:"control-item",onClick:t[6]||(t[6]=(...t)=>e.onAnalysis&&e.onAnalysis(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.ANALYSIS},null,8,["icon"]),S])):(0,o.kq)("",!0),e.controlStates.endAnalysis?((0,o.wg)(),(0,o.iD)("button",{key:7,class:"control-item",onClick:t[7]||(t[7]=(...t)=>e.onEndAnalysis&&e.onEndAnalysis(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.STOP},null,8,["icon"]),E])):(0,o.kq)("",!0),e.controlStates.startEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:8,class:"control-item",onClick:t[8]||(t[8]=(...t)=>e.onStartEditPosition&&e.onStartEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.EDIT},null,8,["icon"]),f])):(0,o.kq)("",!0),e.controlStates.endEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:9,class:"control-item",onClick:t[9]||(t[9]=(...t)=>e.onEndEditPosition&&e.onEndEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CHECK},null,8,["icon"]),I])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:10,class:"control-item",onClick:t[10]||(t[10]=(...t)=>e.onChangeTurn&&e.onChangeTurn(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SWAP},null,8,["icon"]),y])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:11,class:"control-item",onClick:t[11]||(t[11]=(...t)=>e.onInitPosition&&e.onInitPosition(...t))}," 局面の初期化 ")):(0,o.kq)("",!0)])])),"left-control":(0,o.w5)((()=>[(0,o._)("div",w,[(0,o._)("button",{class:"control-item",onClick:t[12]||(t[12]=(...t)=>e.onOpenAppSettings&&e.onOpenAppSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SETTINGS},null,8,["icon"]),b]),(0,o._)("button",{class:"control-item",disabled:!e.controlStates.engineSettings,onClick:t[13]||(t[13]=(...t)=>e.onOpenEngineSettings&&e.onOpenEngineSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.ENGINE_SETTINGS},null,8,["icon"]),T],8,A),(0,o._)("button",{class:"control-item",onClick:t[14]||(t[14]=(...t)=>e.onFlip&&e.onFlip(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.FLIP},null,8,["icon"]),N]),(0,o._)("button",{class:"control-item",onClick:t[15]||(t[15]=(...t)=>e.onFileAction&&e.onFileAction(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.FILE},null,8,["icon"]),R]),(0,o._)("button",{class:"control-item",disabled:!e.controlStates.removeCurrentMove,onClick:t[16]||(t[16]=(...t)=>e.onRemoveCurrentMove&&e.onRemoveCurrentMove(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.DELETE},null,8,["icon"]),P],8,k)])])),_:1},8,["piece-image-type","board-image-type","board-label-type","max-size","position","last-move","flip","allow-move","allow-edit","black-player-name","white-player-name","black-player-time","black-player-byoyomi","white-player-time","white-player-byoyomi","onResize","onMove","onEdit"]),e.isGameMenuVisible?((0,o.wg)(),(0,o.j4)(c,{key:0,onClose:t[17]||(t[17]=t=>e.isGameMenuVisible=!1)})):(0,o.kq)("",!0),e.isFileMenuVisible?((0,o.wg)(),(0,o.j4)(h,{key:1,onClose:t[18]||(t[18]=t=>e.isFileMenuVisible=!1)})):(0,o.kq)("",!0),e.isInitialPositionMenuVisible?((0,o.wg)(),(0,o.j4)(C,{key:2,onClose:t[19]||(t[19]=t=>e.isInitialPositionMenuVisible=!1)})):(0,o.kq)("",!0)])}const O=["src"],M=["src"],H={class:"player-name-text"},L={class:"clock-text"},D={class:"player-name-text"},G={class:"clock-text"},B=["src"],x=["onClick","onContextmenu"],W=["src"],U=["onClick"],F=["src"],K=["onClick"],q=["src"],j=["src"];function V(e,t,i,n,s,r){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{class:"frame",style:(0,a.j5)(e.layout.frame.style),onClick:t[2]||(t[2]=t=>e.clickFrame())},[e.layout.board.textureImagePath?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"board-texture",style:(0,a.j5)(e.layout.board.style)},[(0,o._)("img",{class:"board-image",src:e.layout.board.textureImagePath},null,8,O)],4)):(0,o.kq)("",!0),(0,o._)("div",{class:"board-grid",style:(0,a.j5)(e.layout.board.style)},[(0,o._)("img",{class:"board-image",src:e.layout.board.gridImagePath},null,8,M)],4),(0,o._)("div",{class:(0,a.C_)(["player-name",{active:"black"==e.position.color}]),style:(0,a.j5)(e.layout.blackPlayerName.style)},[(0,o._)("span",H,"▲"+(0,a.zw)(e.blackPlayerName),1)],6),(0,o._)("div",{class:(0,a.C_)(["clock",e.blackPlayerTimeSeverity]),style:(0,a.j5)(e.layout.blackClock.style)},[(0,o._)("span",L,(0,a.zw)(e.blackPlayerTimeText),1)],6),(0,o._)("div",{class:(0,a.C_)(["player-name",{active:"white"==e.position.color}]),style:(0,a.j5)(e.layout.whitePlayerName.style)},[(0,o._)("span",D,"△"+(0,a.zw)(e.whitePlayerName),1)],6),(0,o._)("div",{class:(0,a.C_)(["clock",e.whitePlayerTimeSeverity]),style:(0,a.j5)(e.layout.whiteClock.style)},[(0,o._)("span",G,(0,a.zw)(e.whitePlayerTimeText),1)],6),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"square",style:(0,a.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.piece,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,a.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,B)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.labels,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"label",style:(0,a.j5)(e.style)},(0,a.zw)(e.character),5)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"square",style:(0,a.j5)(t.style),onClick:i=>e.clickSquare(i,t.file,t.rank),onContextmenu:i=>e.clickSquareR(i,t.file,t.rank)},null,44,x)))),128)),(0,o._)("div",{class:"hand",style:(0,a.j5)(e.layout.blackHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,a.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,a.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,W)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,a.j5)(t.style),onClick:i=>e.clickHand(i,e.Color.BLACK,t.type)},null,12,U)))),128))],4),(0,o._)("div",{class:"hand",style:(0,a.j5)(e.layout.whiteHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,a.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,a.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,F)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,a.j5)(t.style),onClick:i=>e.clickHand(i,e.Color.WHITE,t.type)},null,12,K)))),128))],4),e.layout.promotion?((0,o.wg)(),(0,o.iD)("div",{key:1,class:"promotion-selector",style:(0,a.j5)(e.layout.promotion.style)},[(0,o._)("div",{class:"select-button promote",onClick:t[0]||(t[0]=t=>e.clickPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.promoteImagePath},null,8,q)]),(0,o._)("div",{class:"select-button not-promote",onClick:t[1]||(t[1]=t=>e.clickNotPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.notPromoteImagePath},null,8,j)])],4)):(0,o.kq)("",!0),(0,o._)("div",{class:"turn",style:(0,a.j5)(e.layout.turn.style)},"手番",4),(0,o._)("div",{style:(0,a.j5)(e.layout.control.left.style)},[(0,o.WI)(e.$slots,"left-control",{},void 0,!0)],4),(0,o._)("div",{style:(0,a.j5)(e.layout.control.right.style)},[(0,o.WI)(e.$slots,"right-control",{},void 0,!0)],4)],4)])}i(7686),i(4506);var Z,z,Y=i(2482);function $(e){return e===Z.BLACK?Z.WHITE:Z.BLACK}function J(e){return e===Z.BLACK?"b":"w"}function X(e){return"b"===e||"w"===e}function Q(e){return"b"===e?Z.BLACK:Z.WHITE}(function(e){e["BLACK"]="black",e["WHITE"]="white"})(Z||(Z={})),function(e){e["PAWN"]="pawn",e["LANCE"]="lance",e["KNIGHT"]="knight",e["SILVER"]="silver",e["GOLD"]="gold",e["BISHOP"]="bishop",e["ROOK"]="rook",e["KING"]="king",e["PROM_PAWN"]="promPawn",e["PROM_LANCE"]="promLance",e["PROM_KNIGHT"]="promKnight",e["PROM_SILVER"]="promSilver",e["HORSE"]="horse",e["DRAGON"]="dragon"}(z||(z={}));const ee={pawn:"歩",lance:"香",knight:"桂",silver:"銀",gold:"金",bishop:"角",rook:"飛",king:"玉",promPawn:"と",promLance:"成香",promKnight:"成桂",promSilver:"成銀",horse:"馬",dragon:"竜"};function te(e){const t=ee[e];return t||""}z.PAWN,z.LANCE,z.KNIGHT,z.SILVER,z.GOLD,z.BISHOP,z.ROOK,z.KING,z.PROM_PAWN,z.PROM_LANCE,z.PROM_KNIGHT,z.PROM_SILVER,z.HORSE,z.DRAGON;const ie=[z.PAWN,z.LANCE,z.KNIGHT,z.SILVER,z.GOLD,z.BISHOP,z.ROOK],ne={pawn:!0,lance:!0,knight:!0,silver:!0,gold:!1,bishop:!0,rook:!0,king:!1,promPawn:!1,promLance:!1,promKnight:!1,promSilver:!1,horse:!1,dragon:!1},oe={pawn:z.PROM_PAWN,lance:z.PROM_LANCE,knight:z.PROM_KNIGHT,silver:z.PROM_SILVER,bishop:z.HORSE,rook:z.DRAGON};function ae(e){return oe[e]||e}const se={promPawn:z.PAWN,promLance:z.LANCE,promKnight:z.KNIGHT,promSilver:z.SILVER,horse:z.BISHOP,dragon:z.ROOK};const re={pawn:"P",lance:"L",knight:"N",silver:"S",gold:"G",bishop:"B",rook:"R",king:"K",promPawn:"+P",promLance:"+L",promKnight:"+N",promSilver:"+S",horse:"+B",dragon:"+R"};function le(e){return re[e]}const ce={pawn:"p",lance:"l",knight:"n",silver:"s",gold:"g",bishop:"b",rook:"r",king:"k",promPawn:"+p",promLance:"+l",promKnight:"+n",promSilver:"+s",horse:"+b",dragon:"+r"},he={P:z.PAWN,L:z.LANCE,N:z.KNIGHT,S:z.SILVER,G:z.GOLD,B:z.BISHOP,R:z.ROOK,K:z.KING,"+P":z.PROM_PAWN,"+L":z.PROM_LANCE,"+N":z.PROM_KNIGHT,"+S":z.PROM_SILVER,"+B":z.HORSE,"+R":z.DRAGON,p:z.PAWN,l:z.LANCE,n:z.KNIGHT,s:z.SILVER,g:z.GOLD,b:z.BISHOP,r:z.ROOK,k:z.KING,"+p":z.PROM_PAWN,"+l":z.PROM_LANCE,"+n":z.PROM_KNIGHT,"+s":z.PROM_SILVER,"+b":z.HORSE,"+r":z.DRAGON},de={P:Z.BLACK,L:Z.BLACK,N:Z.BLACK,S:Z.BLACK,G:Z.BLACK,B:Z.BLACK,R:Z.BLACK,K:Z.BLACK,"+P":Z.BLACK,"+L":Z.BLACK,"+N":Z.BLACK,"+S":Z.BLACK,"+B":Z.BLACK,"+R":Z.BLACK,p:Z.WHITE,l:Z.WHITE,n:Z.WHITE,s:Z.WHITE,g:Z.WHITE,b:Z.WHITE,r:Z.WHITE,k:Z.WHITE,"+p":Z.WHITE,"+l":Z.WHITE,"+n":Z.WHITE,"+s":Z.WHITE,"+b":Z.WHITE,"+r":Z.WHITE},ue=new Map;ue.set(z.PAWN,{type:z.PROM_PAWN,reverseColor:!1}),ue.set(z.LANCE,{type:z.PROM_LANCE,reverseColor:!1}),ue.set(z.KNIGHT,{type:z.PROM_KNIGHT,reverseColor:!1}),ue.set(z.SILVER,{type:z.PROM_SILVER,reverseColor:!1}),ue.set(z.GOLD,{type:z.GOLD,reverseColor:!0}),ue.set(z.BISHOP,{type:z.HORSE,reverseColor:!1}),ue.set(z.ROOK,{type:z.DRAGON,reverseColor:!1}),ue.set(z.KING,{type:z.KING,reverseColor:!0}),ue.set(z.PROM_PAWN,{type:z.PAWN,reverseColor:!0}),ue.set(z.PROM_LANCE,{type:z.LANCE,reverseColor:!0}),ue.set(z.PROM_KNIGHT,{type:z.KNIGHT,reverseColor:!0}),ue.set(z.PROM_SILVER,{type:z.SILVER,reverseColor:!0}),ue.set(z.HORSE,{type:z.BISHOP,reverseColor:!0}),ue.set(z.DRAGON,{type:z.ROOK,reverseColor:!0});class pe{constructor(e,t){(0,Y.Z)(this,"color",void 0),(0,Y.Z)(this,"type",void 0),this.color=e,this.type=t}black(){return this.withColor(Z.BLACK)}white(){return this.withColor(Z.WHITE)}withColor(e){return new pe(e,this.type)}equals(e){return this.type===e.type&&this.color===e.color}promoted(){const e=oe[this.type];return new pe(this.color,e||this.type)}unpromoted(){const e=se[this.type];return new pe(this.color,e||this.type)}isPromotable(){return!!ne[this.type]}rotate(){const e=ue.get(this.type),t=new pe(this.color,e?e.type:this.type);return e&&e.reverseColor&&(t.color=$(this.color)),t}get id(){return this.color+"_"+this.type}get sfen(){switch(this.color){default:case Z.BLACK:return re[this.type];case Z.WHITE:return ce[this.type]}}static isValidSFEN(e){return!!he[e]}static newBySFEN(e){const t=he[e];if(!t)return null;const i=de[e];return i?new pe(i,t):null}}var ge;i(7658);(function(e){e["UP"]="up",e["DOWN"]="down",e["LEFT"]="left",e["RIGHT"]="right",e["LEFT_UP"]="left_up",e["RIGHT_UP"]="right_up",e["LEFT_DOWN"]="left_down",e["RIGHT_DOWN"]="right_down",e["LEFT_UP_KNIGHT"]="left_up_knight",e["RIGHT_UP_KNIGHT"]="right_up_knight",e["LEFT_DOWN_KNIGHT"]="left_down_knight",e["RIGHT_DOWN_KNIGHT"]="right_down_knight"})(ge||(ge={}));const me={up:ge.DOWN,down:ge.UP,left:ge.RIGHT,right:ge.LEFT,left_up:ge.RIGHT_DOWN,right_up:ge.LEFT_DOWN,left_down:ge.RIGHT_UP,right_down:ge.LEFT_UP,left_up_knight:ge.RIGHT_DOWN_KNIGHT,right_up_knight:ge.LEFT_DOWN_KNIGHT,left_down_knight:ge.RIGHT_UP_KNIGHT,right_down_knight:ge.LEFT_UP_KNIGHT};function _e(e){return me[e]}const ve=[ge.UP,ge.DOWN,ge.LEFT,ge.RIGHT,ge.LEFT_UP,ge.RIGHT_UP,ge.LEFT_DOWN,ge.RIGHT_DOWN,ge.LEFT_UP_KNIGHT,ge.RIGHT_UP_KNIGHT,ge.LEFT_DOWN_KNIGHT,ge.RIGHT_DOWN_KNIGHT];var Se;(function(e){e["SHORT"]="short",e["LONG"]="long"})(Se||(Se={}));const Ee={black:{pawn:{up:Se.SHORT},lance:{up:Se.LONG},knight:{left_up_knight:Se.SHORT,right_up_knight:Se.SHORT},silver:{left_up:Se.SHORT,up:Se.SHORT,right_up:Se.SHORT,left_down:Se.SHORT,right_down:Se.SHORT},gold:{left_up:Se.SHORT,up:Se.SHORT,right_up:Se.SHORT,left:Se.SHORT,right:Se.SHORT,down:Se.SHORT},bishop:{left_up:Se.LONG,right_up:Se.LONG,left_down:Se.LONG,right_down:Se.LONG},rook:{up:Se.LONG,left:Se.LONG,right:Se.LONG,down:Se.LONG},king:{left_down:Se.SHORT,right_down:Se.SHORT,left_up:Se.SHORT,right_up:Se.SHORT,down:Se.SHORT,left:Se.SHORT,right:Se.SHORT,up:Se.SHORT},promPawn:{left_up:Se.SHORT,up:Se.SHORT,right_up:Se.SHORT,left:Se.SHORT,right:Se.SHORT,down:Se.SHORT},promLance:{left_up:Se.SHORT,up:Se.SHORT,right_up:Se.SHORT,left:Se.SHORT,right:Se.SHORT,down:Se.SHORT},promKnight:{left_up:Se.SHORT,up:Se.SHORT,right_up:Se.SHORT,left:Se.SHORT,right:Se.SHORT,down:Se.SHORT},promSilver:{left_up:Se.SHORT,up:Se.SHORT,right_up:Se.SHORT,left:Se.SHORT,right:Se.SHORT,down:Se.SHORT},horse:{left_up:Se.LONG,right_up:Se.LONG,left_down:Se.LONG,right_down:Se.LONG,up:Se.SHORT,left:Se.SHORT,right:Se.SHORT,down:Se.SHORT},dragon:{up:Se.LONG,left:Se.LONG,right:Se.LONG,down:Se.LONG,left_up:Se.SHORT,right_up:Se.SHORT,left_down:Se.SHORT,right_down:Se.SHORT}},white:{pawn:{down:Se.SHORT},lance:{down:Se.LONG},knight:{left_down_knight:Se.SHORT,right_down_knight:Se.SHORT},silver:{left_down:Se.SHORT,down:Se.SHORT,right_down:Se.SHORT,left_up:Se.SHORT,right_up:Se.SHORT},gold:{left_down:Se.SHORT,down:Se.SHORT,right_down:Se.SHORT,left:Se.SHORT,right:Se.SHORT,up:Se.SHORT},bishop:{left_down:Se.LONG,right_down:Se.LONG,left_up:Se.LONG,right_up:Se.LONG},rook:{down:Se.LONG,left:Se.LONG,right:Se.LONG,up:Se.LONG},king:{left_down:Se.SHORT,right_down:Se.SHORT,left_up:Se.SHORT,right_up:Se.SHORT,down:Se.SHORT,left:Se.SHORT,right:Se.SHORT,up:Se.SHORT},promPawn:{left_down:Se.SHORT,down:Se.SHORT,right_down:Se.SHORT,left:Se.SHORT,right:Se.SHORT,up:Se.SHORT},promLance:{left_down:Se.SHORT,down:Se.SHORT,right_down:Se.SHORT,left:Se.SHORT,right:Se.SHORT,up:Se.SHORT},promKnight:{left_down:Se.SHORT,down:Se.SHORT,right_down:Se.SHORT,left:Se.SHORT,right:Se.SHORT,up:Se.SHORT},promSilver:{left_down:Se.SHORT,down:Se.SHORT,right_down:Se.SHORT,left:Se.SHORT,right:Se.SHORT,up:Se.SHORT},horse:{left_down:Se.LONG,right_down:Se.LONG,left_up:Se.LONG,right_up:Se.LONG,down:Se.SHORT,left:Se.SHORT,right:Se.SHORT,up:Se.SHORT},dragon:{down:Se.LONG,left:Se.LONG,right:Se.LONG,up:Se.LONG,left_down:Se.SHORT,right_down:Se.SHORT,left_up:Se.SHORT,right_up:Se.SHORT}}};function fe(e){return Object.keys(Ee[e.color][e.type])}function Ie(e,t){return Ee[e.color][e.type][t]}const ye={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},left_up:{x:-1,y:-1},right_up:{x:1,y:-1},left_down:{x:-1,y:1},right_down:{x:1,y:1},left_up_knight:{x:-1,y:-2},right_up_knight:{x:1,y:-2},left_down_knight:{x:-1,y:2},right_down_knight:{x:1,y:2}};function we(e,t){if(1===e&&-2===t)return{direction:ge.RIGHT_UP_KNIGHT,distance:1,ok:!0};if(-1===e&&-2===t)return{direction:ge.LEFT_UP_KNIGHT,distance:1,ok:!0};if(1===e&&2===t)return{direction:ge.RIGHT_DOWN_KNIGHT,distance:1,ok:!0};if(-1===e&&2===t)return{direction:ge.LEFT_DOWN_KNIGHT,distance:1,ok:!0};if(0!==e&&0!==t&&Math.abs(e)!==Math.abs(t))return{direction:"",distance:0,ok:!1};let i=e,n=t,o=0;return 0!==i&&(o=Math.abs(i),i/=o),0!==n&&(o=Math.abs(n),n/=o),-1===i&&-1===n?{direction:ge.LEFT_UP,distance:o,ok:!0}:0===i&&-1===n?{direction:ge.UP,distance:o,ok:!0}:1===i&&-1===n?{direction:ge.RIGHT_UP,distance:o,ok:!0}:-1===i&&0===n?{direction:ge.LEFT,distance:o,ok:!0}:1===i&&0===n?{direction:ge.RIGHT,distance:o,ok:!0}:-1===i&&1===n?{direction:ge.LEFT_DOWN,distance:o,ok:!0}:0===i&&1===n?{direction:ge.DOWN,distance:o,ok:!0}:1===i&&1===n?{direction:ge.RIGHT_DOWN,distance:o,ok:!0}:{direction:"",distance:0,ok:!1}}function be(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}function Ae(e){switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;case"i":return 9;default:return null}}const Te=["a","b","c","d","e","f","g","h","i"];class Ne{constructor(e,t){(0,Y.Z)(this,"file",void 0),(0,Y.Z)(this,"rank",void 0),this.file=e,this.rank=t}get x(){return 9-this.file}get y(){return this.rank-1}get index(){return 9*this.y+this.x}get opposite(){return new Ne(10-this.file,10-this.rank)}neighbor(e,t){switch(e){case ge.UP:return new Ne(this.file,this.rank-1);case ge.DOWN:return new Ne(this.file,this.rank+1);case ge.LEFT:return new Ne(this.file+1,this.rank);case ge.RIGHT:return new Ne(this.file-1,this.rank);case ge.LEFT_UP:return new Ne(this.file+1,this.rank-1);case ge.RIGHT_UP:return new Ne(this.file-1,this.rank-1);case ge.LEFT_DOWN:return new Ne(this.file+1,this.rank+1);case ge.RIGHT_DOWN:return new Ne(this.file-1,this.rank+1);case ge.LEFT_UP_KNIGHT:return new Ne(this.file+1,this.rank-2);case ge.RIGHT_UP_KNIGHT:return new Ne(this.file-1,this.rank-2);case ge.LEFT_DOWN_KNIGHT:return new Ne(this.file+1,this.rank+2);case ge.RIGHT_DOWN_KNIGHT:return new Ne(this.file-1,this.rank+2)}const i=e,n=t;return new Ne(this.file-i,this.rank+n)}get valid(){return this.file>=1&&this.file<=9&&this.rank>=1&&this.rank<=9}equals(e){return!!e&&this.file===e.file&&this.rank===e.rank}static newByXY(e,t){return new Ne(9-e,t+1)}static newByIndex(e){return new Ne(9-e%9,Math.trunc(e/9)+1)}get sfen(){return this.file+Te[this.rank-1]}static parseSFENSquare(e){const t=be(e[0]),i=Ae(e[1]);return t&&i?new Ne(t,i):null}}(0,Y.Z)(Ne,"all",[]);for(let Cm=0;Cm<81;Cm+=1)Ne.all.push(Ne.newByIndex(Cm));const Re=["１","２","３","４","５","６","７","８","９"],ke=["一","二","三","四","五","六","七","八","九"];class Pe{constructor(e,t,i,n,o,a){(0,Y.Z)(this,"from",void 0),(0,Y.Z)(this,"to",void 0),(0,Y.Z)(this,"promote",void 0),(0,Y.Z)(this,"color",void 0),(0,Y.Z)(this,"pieceType",void 0),(0,Y.Z)(this,"capturedPieceType",void 0),this.from=e,this.to=t,this.promote=i,this.color=n,this.pieceType=o,this.capturedPieceType=a}equals(e){return!!e&&((this.from instanceof Ne&&e.from instanceof Ne&&this.from.equals(e.from)||!(this.from instanceof Ne)&&!(e.from instanceof Ne)&&this.from===e.from)&&this.to.equals(e.to)&&this.promote===e.promote&&this.color===e.color&&this.pieceType===e.pieceType&&this.capturedPieceType===e.capturedPieceType)}withPromote(){return new Pe(this.from,this.to,!0,this.color,this.pieceType,this.capturedPieceType)}getDisplayText(e){let t="";if(t+=this.color===Z.BLACK?"▲":"△",e&&e.to.equals(this.to)?t+="同　":(t+=Re[this.to.file-1],t+=ke[this.to.rank-1]),t+=te(this.pieceType),this.promote&&(t+="成"),this.from instanceof Ne){const e=this.from;t+=`(${e.file}${e.rank})`}else t+="打";return t}get sfen(){let e="";return this.from instanceof Ne?e+=this.from.sfen:e+=le(this.from)+"*",e+=this.to.sfen,this.promote&&(e+="+"),e}}function Ce(e){let t;if("*"===e[1]){const i=pe.newBySFEN(e[0]);if(!i)return null;t=i.type}else{const i=Ne.parseSFENSquare(e);if(!i)return null;t=i}const i=Ne.parseSFENSquare(e.substring(2));if(!i)return null;const n=e.length>=5&&"+"===e[4];return{from:t,to:i,promote:n}}var Oe;function Me(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}(function(e){e["STANDARD"]="standard",e["EMPTY"]="empty",e["HANDICAP_LANCE"]="handicapLance",e["HANDICAP_RIGHT_LANCE"]="handicapRightLance",e["HANDICAP_BISHOP"]="handicapBishop",e["HANDICAP_ROOK"]="handicapRook",e["HANDICAP_ROOK_LANCE"]="handicapRookLance",e["HANDICAP_2PIECES"]="handicap2Pieces",e["HANDICAP_4PIECES"]="handicap4Pieces",e["HANDICAP_6PIECES"]="handicap6Pieces",e["HANDICAP_8PIECES"]="handicap8Pieces",e["TSUME_SHOGI"]="tsumeShogi",e["TSUME_SHOGI_2KINGS"]="tsumeShogi2Kings"})(Oe||(Oe={}));class He{constructor(){(0,Y.Z)(this,"squares",void 0),this.squares=new Array;for(let e=0;e<81;e+=1)this.squares.push(null);this.reset(Oe.STANDARD)}at(e){return this.squares[e.index]}set(e,t){this.squares[e.index]=t}swap(e,t){const i=this.squares[e.index];this.squares[e.index]=this.squares[t.index],this.squares[t.index]=i}remove(e){const t=this.squares[e.index];return this.squares[e.index]=null,t}listNonEmptySquares(){const e=new Array;return Ne.all.forEach((t=>{this.squares[t.index]&&e.push(t)})),e}listSquaresByColor(e){const t=new Array;return Ne.all.forEach((i=>{const n=this.squares[i.index];n&&n.color===e&&t.push(i)})),t}clear(){Ne.all.forEach((e=>{this.squares[e.index]=null}))}reset(e){if(this.clear(),e!==Oe.EMPTY&&(this.squares[new Ne(5,1).index]=new pe(Z.WHITE,z.KING),e!==Oe.TSUME_SHOGI&&(this.squares[new Ne(5,9).index]=new pe(Z.BLACK,z.KING),e!==Oe.TSUME_SHOGI_2KINGS)))switch(this.squares[new Ne(2,8).index]=new pe(Z.BLACK,z.ROOK),this.squares[new Ne(8,2).index]=new pe(Z.WHITE,z.ROOK),this.squares[new Ne(8,8).index]=new pe(Z.BLACK,z.BISHOP),this.squares[new Ne(2,2).index]=new pe(Z.WHITE,z.BISHOP),this.squares[new Ne(4,9).index]=new pe(Z.BLACK,z.GOLD),this.squares[new Ne(6,9).index]=new pe(Z.BLACK,z.GOLD),this.squares[new Ne(6,1).index]=new pe(Z.WHITE,z.GOLD),this.squares[new Ne(4,1).index]=new pe(Z.WHITE,z.GOLD),this.squares[new Ne(3,9).index]=new pe(Z.BLACK,z.SILVER),this.squares[new Ne(7,9).index]=new pe(Z.BLACK,z.SILVER),this.squares[new Ne(7,1).index]=new pe(Z.WHITE,z.SILVER),this.squares[new Ne(3,1).index]=new pe(Z.WHITE,z.SILVER),this.squares[new Ne(2,9).index]=new pe(Z.BLACK,z.KNIGHT),this.squares[new Ne(8,9).index]=new pe(Z.BLACK,z.KNIGHT),this.squares[new Ne(8,1).index]=new pe(Z.WHITE,z.KNIGHT),this.squares[new Ne(2,1).index]=new pe(Z.WHITE,z.KNIGHT),this.squares[new Ne(1,9).index]=new pe(Z.BLACK,z.LANCE),this.squares[new Ne(9,9).index]=new pe(Z.BLACK,z.LANCE),this.squares[new Ne(9,1).index]=new pe(Z.WHITE,z.LANCE),this.squares[new Ne(1,1).index]=new pe(Z.WHITE,z.LANCE),this.squares[new Ne(1,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(2,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(3,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(4,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(5,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(6,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(7,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(8,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(9,7).index]=new pe(Z.BLACK,z.PAWN),this.squares[new Ne(1,3).index]=new pe(Z.WHITE,z.PAWN),this.squares[new Ne(2,3).index]=new pe(Z.WHITE,z.PAWN),this.squares[new Ne(3,3).index]=new pe(Z.WHITE,z.PAWN),this.squares[new Ne(4,3).index]=new pe(Z.WHITE,z.PAWN),this.squares[new Ne(5,3).index]=new pe(Z.WHITE,z.PAWN),this.squares[new Ne(6,3).index]=new pe(Z.WHITE,z.PAWN),this.squares[new Ne(7,3).index]=new pe(Z.WHITE,z.PAWN),this.squares[new Ne(8,3).index]=new pe(Z.WHITE,z.PAWN),this.squares[new Ne(9,3).index]=new pe(Z.WHITE,z.PAWN),e){default:case Oe.STANDARD:return;case Oe.HANDICAP_LANCE:return void(this.squares[new Ne(1,1).index]=null);case Oe.HANDICAP_RIGHT_LANCE:return void(this.squares[new Ne(9,1).index]=null);case Oe.HANDICAP_BISHOP:return void(this.squares[new Ne(2,2).index]=null);case Oe.HANDICAP_ROOK:return void(this.squares[new Ne(8,2).index]=null);case Oe.HANDICAP_ROOK_LANCE:return this.squares[new Ne(8,2).index]=null,void(this.squares[new Ne(1,1).index]=null);case Oe.HANDICAP_2PIECES:return this.squares[new Ne(8,2).index]=null,void(this.squares[new Ne(2,2).index]=null);case Oe.HANDICAP_4PIECES:return this.squares[new Ne(8,2).index]=null,this.squares[new Ne(2,2).index]=null,this.squares[new Ne(1,1).index]=null,void(this.squares[new Ne(9,1).index]=null);case Oe.HANDICAP_6PIECES:return this.squares[new Ne(8,2).index]=null,this.squares[new Ne(2,2).index]=null,this.squares[new Ne(1,1).index]=null,this.squares[new Ne(2,1).index]=null,this.squares[new Ne(8,1).index]=null,void(this.squares[new Ne(9,1).index]=null);case Oe.HANDICAP_8PIECES:return this.squares[new Ne(8,2).index]=null,this.squares[new Ne(2,2).index]=null,this.squares[new Ne(1,1).index]=null,this.squares[new Ne(2,1).index]=null,this.squares[new Ne(3,1).index]=null,this.squares[new Ne(7,1).index]=null,this.squares[new Ne(8,1).index]=null,void(this.squares[new Ne(9,1).index]=null)}}get sfen(){let e="",t=0;for(let i=0;i<9;i+=1){for(let n=0;n<9;n+=1){const o=this.at(Ne.newByXY(n,i));o?(t&&(e+=t,t=0),e+=o.sfen):t+=1}t&&(e+=t,t=0),8!==i&&(e+="/")}return e}resetBySFEN(e){if(!He.isValidSFEN(e))return!1;this.clear();const t=e.split("/");for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=Me(o);a?e+=a:(this.set(Ne.newByXY(e,i),pe.newBySFEN(o)),e+=1)}}return!0}findKing(e){const t=new pe(e,z.KING);return Ne.all.find((e=>{const i=this.at(e);if(i&&t.equals(i))return!0}))}hasPower(e,t,i){return!!ve.find((n=>{let o=0;for(let a=e.neighbor(n);a.valid;a=a.neighbor(n)){if(o+=1,i&&i.filled&&a.equals(i.filled))break;if(i&&i.ignore&&a.equals(i.ignore))continue;const e=this.at(a);if(e){if(e.color!==t)return!1;const i=_e(n),a=Ie(e,i);return a===Se.LONG||a===Se.SHORT&&1===o}}return!1}))}isChecked(e,t){const i=this.findKing(e);return!!i&&this.hasPower(i,$(e),{filled:t&&t.filled,ignore:t&&t.ignore})}static isValidSFEN(e){const t=e.split("/");if(9!==t.length)return!1;for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=Me(o);if(a)e+=a;else{if(!pe.isValidSFEN(o))return!1;e+=1}}if(9!==e)return!1}return!0}copyFrom(e){Ne.all.forEach((t=>{this.squares[t.index]=e.at(t)}))}}function Le(e,t){return 0===e?"":(1!==e?e:"")+t.sfen}class De{constructor(){(0,Y.Z)(this,"pieces",void 0),this.pieces=new Map,this.pieces.set(z.PAWN,0),this.pieces.set(z.LANCE,0),this.pieces.set(z.KNIGHT,0),this.pieces.set(z.SILVER,0),this.pieces.set(z.GOLD,0),this.pieces.set(z.BISHOP,0),this.pieces.set(z.ROOK,0)}count(e){return this.pieces.get(e)}set(e,t){this.pieces.set(e,t)}add(e,t){let i=this.pieces.get(e);return i+=t,this.pieces.set(e,i),i}reduce(e,t){let i=this.pieces.get(e);return i-=t,this.pieces.set(e,i),i}forEach(e){e(z.PAWN,this.pieces.get(z.PAWN)),e(z.LANCE,this.pieces.get(z.LANCE)),e(z.KNIGHT,this.pieces.get(z.KNIGHT)),e(z.SILVER,this.pieces.get(z.SILVER)),e(z.GOLD,this.pieces.get(z.GOLD)),e(z.BISHOP,this.pieces.get(z.BISHOP)),e(z.ROOK,this.pieces.get(z.ROOK))}get sfenBlack(){return this.formatSFEN(Z.BLACK)}get sfenWhite(){return this.formatSFEN(Z.WHITE)}formatSFEN(e){let t="";return t+=Le(this.count(z.ROOK),new pe(e,z.ROOK)),t+=Le(this.count(z.BISHOP),new pe(e,z.BISHOP)),t+=Le(this.count(z.GOLD),new pe(e,z.GOLD)),t+=Le(this.count(z.SILVER),new pe(e,z.SILVER)),t+=Le(this.count(z.KNIGHT),new pe(e,z.KNIGHT)),t+=Le(this.count(z.LANCE),new pe(e,z.LANCE)),t+=Le(this.count(z.PAWN),new pe(e,z.PAWN)),""===t?"-":t}static formatSFEN(e,t){const i=e.sfenBlack,n=t.sfenWhite;return"-"===i&&"-"===n?"-":"-"===n?i:"-"===i?n:i+n}static isValidSFEN(e){return"-"===e||!!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/)}static parseSFEN(e){if("-"===e)return{black:new De,white:new De};if(!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/))return null;const t=e.match(/([0-9]*[PLNSGBRplnsgbr])/g),i=new De,n=new De;for(let o=0;o<t.length;o+=1){const e=t[o];let a=1;e.length>=2&&(a=Number(e.substring(0,e.length-1)));const s=pe.newBySFEN(e[e.length-1]);s.color===Z.BLACK?i.add(s.type,a):n.add(s.type,a)}return{black:i,white:n}}copyFrom(e){e.pieces.forEach(((e,t)=>{this.pieces.set(t,e)}))}}const Ge={black:{pawn:{1:!0},lance:{1:!0},knight:{1:!0,2:!0}},white:{pawn:{9:!0},lance:{9:!0},knight:{9:!0,8:!0}}};function Be(e,t,i){const n=Ge[e][t];return!!n&&n[i]}function xe(e,t){return e===Z.BLACK?t<=3:t>=7}function We(e,t,i){for(let n=1;n<=9;n+=1){const o=t.at(new Ne(i,n));if(o&&o.type===z.PAWN&&o.color===e)return!0}return!1}class Ue{constructor(){(0,Y.Z)(this,"_board",new He),(0,Y.Z)(this,"_color",Z.BLACK),(0,Y.Z)(this,"_blackHand",new De),(0,Y.Z)(this,"_whiteHand",new De)}get board(){return this._board}get color(){return this._color}get blackHand(){return this._blackHand}get whiteHand(){return this._whiteHand}reset(e){switch(this._board.reset(e),this._blackHand=new De,this._whiteHand=new De,e){case Oe.STANDARD:case Oe.EMPTY:case Oe.TSUME_SHOGI:case Oe.TSUME_SHOGI_2KINGS:this._color=Z.BLACK;break;case Oe.HANDICAP_LANCE:case Oe.HANDICAP_RIGHT_LANCE:case Oe.HANDICAP_BISHOP:case Oe.HANDICAP_ROOK:case Oe.HANDICAP_ROOK_LANCE:case Oe.HANDICAP_2PIECES:case Oe.HANDICAP_4PIECES:case Oe.HANDICAP_6PIECES:case Oe.HANDICAP_8PIECES:this._color=Z.WHITE;break}e!==Oe.TSUME_SHOGI&&e!==Oe.TSUME_SHOGI_2KINGS||(this._whiteHand.set(z.PAWN,18),this._whiteHand.set(z.LANCE,4),this._whiteHand.set(z.KNIGHT,4),this._whiteHand.set(z.SILVER,4),this._whiteHand.set(z.GOLD,4),this._whiteHand.set(z.BISHOP,2),this._whiteHand.set(z.ROOK,2))}hand(e){return this._hand(e)}_hand(e){return e===Z.BLACK?this._blackHand:this._whiteHand}get checked(){return this._board.isChecked(this.color)}createMove(e,t){let i;if(e instanceof Ne){const t=this._board.at(e);if(!t)return null;i=t.type}else i=e;const n=this._board.at(t);return new Pe(e,t,!1,this.color,i,n?n.type:null)}createMoveBySFEN(e){const t=Ce(e);if(!t)return null;let i=this.createMove(t.from,t.to);return i?(t.promote&&(i=i.withPromote()),i):null}isPawnDropMate(e){if(e.from instanceof Ne)return!1;if(e.pieceType!==z.PAWN)return!1;const t=e.to.neighbor(e.color===Z.BLACK?ge.UP:ge.DOWN),i=this.board.at(t);if(!i||i.type!==z.KING||i.color===e.color)return!1;const n=fe(i).find((n=>{const o=t.neighbor(n);if(!o.valid)return!1;const a=this.board.at(o);return(!a||a.color!=i.color)&&!this.board.hasPower(o,e.color,{filled:e.to})}));return!n&&!this.board.listSquaresByColor(i.color).find((n=>!n.equals(t)&&this.isMovable(n,e.to)&&!this.board.isChecked(i.color,{filled:e.to,ignore:n})))}isValidMove(e){if(e.from instanceof Ne){const t=this._board.at(e.from);if(!t||t.color!==this.color)return!1;if(!this.isMovable(e.from,e.to))return!1;const i=this._board.at(e.to);if(i&&i.color===this.color)return!1;if(e.promote){if(!t.isPromotable())return!1;if(!xe(this.color,e.from.rank)&&!xe(this.color,e.to.rank))return!1}else if(Be(this.color,t.type,e.to.rank))return!1;if(e.pieceType!==z.KING?this._board.isChecked(this.color,{filled:e.to,ignore:e.from}):this._board.hasPower(e.to,$(this.color),{ignore:e.from}))return!1}else{if(e.promote)return!1;if(e.color!==this.color)return!1;if(0===this.hand(this.color).count(e.from))return!1;if(this._board.at(e.to))return!1;if(Be(this.color,e.from,e.to.rank))return!1;if(e.from===z.PAWN&&We(this.color,this._board,e.to.file))return!1;if(this._board.isChecked(this.color,{filled:e.to}))return!1;if(this.isPawnDropMate(e))return!1}return!0}doMove(e,t){if((!t||!t.ignoreValidation)&&!this.isValidMove(e))return!1;if(e.from instanceof Ne){const t=this._board.at(e.from),i=this._board.at(e.to);this._board.remove(e.from),this._board.set(e.to,e.promote?t.promoted():t),i&&i.type!==z.KING&&this._hand(this.color).add(i.unpromoted().type,1)}else this._hand(this.color).reduce(e.from,1),this._board.set(e.to,new pe(this.color,e.from));return this._color=$(this.color),!0}undoMove(e){if(this._color=$(this.color),e.from instanceof Ne)if(this._board.set(e.from,new pe(this.color,e.pieceType)),e.capturedPieceType){const t=new pe($(this.color),e.capturedPieceType);this._board.set(e.to,t),t.type!==z.KING&&this._hand(this.color).reduce(t.unpromoted().type,1)}else this._board.remove(e.to);else this._hand(this.color).add(e.from,1),this._board.remove(e.to)}isValidEditing(e,t){if(e instanceof Ne){const i=this._board.at(e);if(!i)return!1;if(t instanceof Ne){if(e.equals(t))return!1}else if(i.type===z.KING)return!1}else{if(!e.color)return!1;if(0===this.hand(e.color).count(e.type))return!1;if(t instanceof Ne){if(this._board.at(t))return!1}else if(e.color===t)return!1}return!0}edit(e){if(e.move){if(!this.isValidEditing(e.move.from,e.move.to))return!1;if(e.move.from instanceof Ne)if(e.move.to instanceof Ne)this._board.swap(e.move.from,e.move.to);else{const t=this._board.remove(e.move.from);this._hand(e.move.to).add(t.unpromoted().type,1)}else this._hand(e.move.from.color).reduce(e.move.from.type,1),e.move.to instanceof Ne?this._board.set(e.move.to,e.move.from):this._hand(e.move.to).add(e.move.from.type,1)}if(e.rotate){const t=this._board.at(e.rotate);t&&this._board.set(e.rotate,t.rotate())}return!0}get sfen(){return this.getSFEN(1)}getSFEN(e){let t=`${this._board.sfen} ${J(this.color)} `;return t+=De.formatSFEN(this._blackHand,this._whiteHand),t+=" "+e,t}resetBySFEN(e){if(!Ue.isValidSFEN(e))return!1;const t=e.split(" ");"sfen"===t[0]&&t.shift(),this._board.resetBySFEN(t[0]),this._color=Q(t[1]);const i=De.parseSFEN(t[2]);return this._blackHand=i.black,this._whiteHand=i.white,!0}setColor(e){this._color=e}static isValidSFEN(e){const t=e.split(" ");return 5===t.length&&"sfen"===t[0]&&t.shift(),4===t.length&&(!!He.isValidSFEN(t[0])&&(!!X(t[1])&&(!!De.isValidSFEN(t[2])&&!!t[3].match(/[0-9]+/))))}static newBySFEN(e){const t=new Ue;return t.resetBySFEN(e)?t:null}isMovable(e,t){const i=t.x-e.x,n=t.y-e.y,{direction:o,distance:a,ok:s}=we(i,n);if(!s)return!1;const r=this._board.at(e);if(!r)return!1;switch(Ie(r,o)){default:return!1;case Se.SHORT:return 1===a;case Se.LONG:{const i=ye[o];for(let n=e.neighbor(i.x,i.y);n.valid;n=n.neighbor(i.x,i.y)){if(n.equals(t))return!0;if(this._board.at(n))return!1}return!1}}}copyFrom(e){this._board.copyFrom(e._board),this._color=e.color,this._blackHand.copyFrom(e._blackHand),this._whiteHand.copyFrom(e._whiteHand)}clone(){const e=new Ue;return e.copyFrom(this),e}}function Fe(e){const t={pawn:0,lance:0,knight:0,silver:0,gold:0,bishop:0,rook:0,king:0,promPawn:0,promLance:0,promKnight:0,promSilver:0,horse:0,dragon:0};return Ne.all.forEach((i=>{const n=e.board.at(i);n&&(t[n.type]+=1)})),e.blackHand.forEach(((e,i)=>{t[e]+=i})),e.whiteHand.forEach(((e,i)=>{t[e]+=i})),t}function Ke(e){const t=Fe(e);return{pawn:18-t.pawn-t.promPawn,lance:4-t.lance-t.promLance,knight:4-t.knight-t.promKnight,silver:4-t.silver-t.promSilver,gold:4-t.gold,bishop:2-t.bishop-t.horse,rook:2-t.rook-t.dragon,king:2-t.king,promPawn:0,promLance:0,promKnight:0,promSilver:0,horse:0,dragon:0}}var qe,je;i(541);function Ve(e){return ze(Math.floor(e/1e3))}function Ze(e){return Ye(Math.floor(e/1e3))}function ze(e){const t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=e%60;return t+":"+String(i).padStart(2,"0")+":"+String(n).padStart(2,"0")}function Ye(e){const t=Math.floor(e/60),i=e%60;return String(t).padStart(2," ")+":"+String(i).padStart(2,"0")}function $e(e){switch(e){case qe.BLACK_NAME:return"先手";case qe.WHITE_NAME:return"後手";case qe.START_DATETIME:return"開始日時";case qe.END_DATETIME:return"終了日時";case qe.DATE:return"対局日";case qe.TOURNAMENT:return"棋戦";case qe.STRATEGY:return"戦型";case qe.TITLE:return"表題";case qe.TIME_LIMIT:return"持ち時間";case qe.TIME_SPENT:return"消費時間";case qe.PLACE:return"場所";case qe.POSTED_ON:return"掲載";case qe.NOTE:return"備考";case qe.BLACK_SHORT_NAME:return"先手省略名";case qe.WHITE_SHORT_NAME:return"後手省略名";case qe.OPUS_NO:return"作品番号";case qe.OPUS_NAME:return"作品名";case qe.AUTHOR:return"作者";case qe.PUBLISHED_ON:return"発表誌";case qe.PUBLISHED_AT:return"発表年月";case qe.SOURCE:return"出典";case qe.LENGTH:return"手数";case qe.INTEGRITY:return"完全性";case qe.CATEGORY:return"分類";case qe.AWARD:return"受賞"}}(function(e){e["TITLE"]="title",e["BLACK_NAME"]="blackName",e["WHITE_NAME"]="whiteName",e["START_DATETIME"]="startDatetime",e["END_DATETIME"]="endDatetime",e["DATE"]="date",e["TOURNAMENT"]="tournament",e["STRATEGY"]="strategy",e["TIME_LIMIT"]="timeLimit",e["TIME_SPENT"]="timeSpent",e["PLACE"]="place",e["POSTED_ON"]="postedOn",e["NOTE"]="note",e["BLACK_SHORT_NAME"]="blackShortName",e["WHITE_SHORT_NAME"]="whiteShortName",e["OPUS_NO"]="opusNo",e["OPUS_NAME"]="opusName",e["AUTHOR"]="author",e["PUBLISHED_ON"]="publishedOn",e["PUBLISHED_AT"]="publishedAt",e["SOURCE"]="source",e["LENGTH"]="length",e["INTEGRITY"]="integrity",e["CATEGORY"]="category",e["AWARD"]="award"})(qe||(qe={}));class Je{constructor(){(0,Y.Z)(this,"standard",new Map),(0,Y.Z)(this,"custom",new Map)}get standardMetadataKeys(){return this.standard.keys()}getStandardMetadata(e){return this.standard.get(e)}setStandardMetadata(e,t){t?this.standard.set(e,t):this.standard.delete(e)}get customMetadataKeys(){return this.custom.keys()}getCustomMetadata(e){return this.custom.get(e)}setCustomMetadata(e,t){t?this.custom.set(e,t):this.custom.delete(e)}}(function(e){e["START"]="start",e["INTERRUPT"]="interrupt",e["RESIGN"]="resign",e["DRAW"]="draw",e["REPETITION_DRAW"]="repetitionDraw",e["MATE"]="mate",e["TIMEOUT"]="timeout",e["FOUL_WIN"]="foulWin",e["FOUL_LOSE"]="foulLose",e["ENTERING_OF_KING"]="enteringOfKing",e["WIN_BY_DEFAULT"]="winByDefault",e["LOSS_BY_DEFAULT"]="lossByDefault"})(je||(je={}));const Xe={start:"開始局面",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function Qe(e){return Xe[e]}class et{constructor(e,t,i,n,o,a,s){(0,Y.Z)(this,"number",void 0),(0,Y.Z)(this,"prev",void 0),(0,Y.Z)(this,"branchIndex",void 0),(0,Y.Z)(this,"activeBranch",void 0),(0,Y.Z)(this,"nextColor",void 0),(0,Y.Z)(this,"move",void 0),(0,Y.Z)(this,"isCheck",void 0),(0,Y.Z)(this,"next",null),(0,Y.Z)(this,"branch",null),(0,Y.Z)(this,"comment",""),(0,Y.Z)(this,"customData",void 0),(0,Y.Z)(this,"elapsedMs",0),(0,Y.Z)(this,"totalElapsedMs",0),this.number=e,this.prev=t,this.branchIndex=i,this.activeBranch=n,this.nextColor=o,this.move=a,this.isCheck=s}get displayText(){const e=this.prev&&this.prev.move instanceof Pe?this.prev.move:null;return this.move instanceof Pe?this.move.getDisplayText(e):Qe(this.move)}get timeText(){const e=Ze(this.elapsedMs),t=Ve(this.totalElapsedMs);return`${e} / ${t}`}get hasBranch(){return!!this.prev&&!!this.prev.next&&!!this.prev.next.branch}get isFirstBranch(){return!this.prev||this.prev.next===this}get isLastMove(){if(!this.next)return!0;for(let e=this.next;e;e=e.branch)if(e.move instanceof Pe)return!1;return!0}updateTotalElapsedMs(){this.totalElapsedMs=this.elapsedMs,this.prev&&this.prev.prev&&(this.totalElapsedMs+=this.prev.prev.totalElapsedMs)}setElapsedMs(e){this.elapsedMs=e,this.updateTotalElapsedMs();let t=this.next;const i=[];while(t)t.updateTotalElapsedMs(),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}static newRootEntry(e){return new et(0,null,0,!0,e,je.START,!1)}}class tt{constructor(e){(0,Y.Z)(this,"metadata",void 0),(0,Y.Z)(this,"_initialPosition",void 0),(0,Y.Z)(this,"_position",void 0),(0,Y.Z)(this,"_first",void 0),(0,Y.Z)(this,"_current",void 0),(0,Y.Z)(this,"repetitionCounts",{}),(0,Y.Z)(this,"repetitionStart",{}),(0,Y.Z)(this,"onChangePosition",(()=>{})),this.metadata=new Je,this._initialPosition=e?e.clone():new Ue,this._position=this.initialPosition.clone(),this._first=et.newRootEntry(this._initialPosition.color),this._current=this._first,this.incrementRepetition()}get initialPosition(){return this._initialPosition}get position(){return this._position}get first(){return this._first}get current(){return this._current}get moves(){const e=this.movesBefore;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e.push(t)}return e}get movesBefore(){return this._movesBefore}get _movesBefore(){const e=new Array;e.unshift(this._current);for(let t=this._current.prev;t;t=t.prev)e.unshift(t);return e}get length(){let e=this._current.number;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e=t.number}return e}get branchBegin(){return this._current.prev?this._current.prev.next:this._current}clear(e){this.metadata=new Je,e&&(this._initialPosition=e.clone()),this._position=this.initialPosition.clone(),this._first=et.newRootEntry(this._initialPosition.color),this._current=this._first,this.repetitionCounts={},this.repetitionStart={},this.incrementRepetition(),this.onChangePosition()}goBack(){return!!this._goBack()&&(this.onChangePosition(),!0)}_goBack(){return!!this._current.prev&&(this._current.move instanceof Pe&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=this._current.prev,!0)}goForward(){return!!this._goForward()&&(this.onChangePosition(),!0)}_goForward(){if(this._current.next){this._current=this._current.next;while(!this._current.activeBranch)this._current=this._current.branch;return this._current.move instanceof Pe&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),!0}return!1}goto(e){while(e<this._current.number)if(!this._goBack())break;while(e>this._current.number)if(!this._goForward())break;this.onChangePosition()}resetAllBranchSelection(){this._forEach((e=>{e.activeBranch=e.isFirstBranch}))}switchBranchByIndex(e){if(this.current.branchIndex===e)return!0;if(!this._current.prev)return!1;let t=!1;for(let i=this._current.prev.next;i;i=i.branch)i.branchIndex===e?(i.activeBranch=!0,this._current.move instanceof Pe&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=i,this._current.move instanceof Pe&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),t=!0):i.activeBranch=!1;return t&&this.onChangePosition(),t}append(e,t){let i,n=!1;if(e instanceof Pe){if(!this._position.doMove(e,t))return!1;this.incrementRepetition(),n=this.position.checked}if(this._current===this.first||this._current.move instanceof Pe||this.goBack(),!this._current.next)return this._current.next=new et(this._current.number+1,this._current,0,!0,this.position.color,e,n),this._current=this._current.next,this._current.setElapsedMs(0),this.onChangePosition(),!0;for(i=this._current.next;i;i=i.branch)i.activeBranch=!1;let o=this._current.next;for(i=this._current.next;i;i=i.branch){if(i.move instanceof Pe&&e instanceof Pe&&e.equals(i.move)||e===i.move)return this._current=i,this._current.activeBranch=!0,this.onChangePosition(),!0;o=i}return this._current=new et(this._current.number+1,this._current,o.branchIndex+1,!0,this.position.color,e,n),this._current.setElapsedMs(0),o.branch=this._current,this.onChangePosition(),!0}removeCurrentMove(){const e=this._current;if(!this.goBack())return void(this._current.next=null);if(this._current.next===e)this._current.next=e.branch;else for(let i=this._current.next;i;i=i.branch)if(i.branch===e){i.branch=e.branch;break}let t=0;for(let i=this._current.next;i;i=i.branch)i.branchIndex=t,t+=1;this._current.next&&(this._current.next.activeBranch=!0),this.onChangePosition()}removeNextMove(){this._current.next=null}incrementRepetition(){const e=this.position.sfen;this.repetitionCounts[e]?this.repetitionCounts[e]+=1:(this.repetitionCounts[e]=1,this.repetitionStart[e]=this.current.number)}decrementRepetition(){const e=this.position.sfen;this.repetitionCounts[e]-=1,0===this.repetitionCounts[e]&&(delete this.repetitionCounts[e],delete this.repetitionStart[e])}get repetition(){return this.repetitionCounts[this.position.sfen]>=4}get perpetualCheck(){if(!this.repetition)return null;const e=this.position.sfen,t=this.repetitionStart[e];let i=!0,n=!0,o=this.position.color;for(let a=this.current;a.number>=t;a=a.prev)o=$(o),a.isCheck||(o===Z.BLACK?i=!1:n=!1);return i?Z.BLACK:n?Z.WHITE:null}get usi(){let e="position sfen "+this.initialPosition.sfen+" moves";return this.movesBefore.forEach((t=>{t.move instanceof Pe&&(e+=" "+t.move.sfen)})),e}get usiAll(){let e=this.usi;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;t.move instanceof Pe&&(e+=" "+t.move.sfen)}return e}get sfen(){return this.position.getSFEN(this._current.number+1)}forEach(e){this._forEach(e)}_forEach(e){let t=this._first;const i=[];while(t)e(t),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}on(e,t){switch(e){case"changePosition":this.onChangePosition=t;break}}static newByUSI(e){const t="position startpos ",i="position sfen ",n="startpos ",o="sfen ",a="moves ";return e.startsWith(t)?tt.newByUSIFromMoves(new Ue,e.slice(t.length)):e.startsWith(i)?tt.newByUSIFromSFENPosition(e.slice(i.length)):e.startsWith(n)?tt.newByUSIFromMoves(new Ue,e.slice(n.length)):e.startsWith(o)?tt.newByUSIFromSFENPosition(e.slice(o.length)):e.startsWith(a)?tt.newByUSIFromMoves(new Ue,e):new Error("不正なUSI(1): "+e)}static newByUSIFromSFENPosition(e){const t=e.split(" ");if(t.length<4)return new Error("不正なUSI(2): "+e);const i=Ue.newBySFEN(t.slice(0,4).join(" "));return i?tt.newByUSIFromMoves(i,t.slice(4).join(" ")):new Error("不正なUSI(3): "+e)}static newByUSIFromMoves(e,t){const i=new tt(e);if(0===t.length)return i;const n=t.split(" ");if("moves"!==n[0])return new Error("不正なUSI(4): "+t);for(let o=1;o<n.length;o++){const e=Ce(n[o]);if(!e)break;let t=i.position.createMove(e.from,e.to);if(!t)return new Error("不正な指し手: "+n[o]);e.promote&&(t=t.withPromote()),i.append(t,{ignoreValidation:!0})}return i}}function it(e,t){return e+(!e||e.endsWith("\n")?"":"\n")+t}function nt(e){return e instanceof Object?JSON.stringify(e):String(e)}function ot(e,t,i){return(e/t*100).toFixed(i)+"%"}const at={"先手":qe.BLACK_NAME,"後手":qe.WHITE_NAME,"開始日時":qe.START_DATETIME,"終了日時":qe.END_DATETIME,"対局日":qe.DATE,"棋戦":qe.TOURNAMENT,"戦型":qe.STRATEGY,"表題":qe.TITLE,"持ち時間":qe.TIME_LIMIT,"消費時間":qe.TIME_SPENT,"場所":qe.PLACE,"掲載":qe.POSTED_ON,"備考":qe.NOTE,"先手省略名":qe.BLACK_SHORT_NAME,"後手省略名":qe.WHITE_SHORT_NAME,"作品番号":qe.OPUS_NO,"作品名":qe.OPUS_NAME,"作者":qe.AUTHOR,"発表誌":qe.PUBLISHED_ON,"発表年月":qe.PUBLISHED_AT,"出典":qe.SOURCE,"手数":qe.LENGTH,"完全性":qe.INTEGRITY,"分類":qe.CATEGORY,"受賞":qe.AWARD},st={blackName:"先手",whiteName:"後手",startDatetime:"開始日時",endDatetime:"終了日時",date:"対局日",tournament:"棋戦",strategy:"戦型",title:"表題",timeLimit:"持ち時間",timeSpent:"消費時間",place:"場所",postedOn:"掲載",note:"備考",blackShortName:"先手省略名",whiteShortName:"後手省略名",opusNo:"作品番号",opusName:"作品名",author:"作者",publishedOn:"発表誌",publishedAt:"発表年月",source:"出典",length:"手数",integrity:"完全性",category:"分類",award:"受賞"};var rt;(function(e){e[e["PROGRAM_COMMENT"]=0]="PROGRAM_COMMENT",e[e["METADATA"]=1]="METADATA",e[e["HANDICAP"]=2]="HANDICAP",e[e["BLACK_HAND"]=3]="BLACK_HAND",e[e["WHITE_HAND"]=4]="WHITE_HAND",e[e["BOARD"]=5]="BOARD",e[e["BLACK_TURN"]=6]="BLACK_TURN",e[e["WHITE_TURN"]=7]="WHITE_TURN",e[e["MOVE"]=8]="MOVE",e[e["COMMENT"]=9]="COMMENT",e[e["UNKNOWN"]=10]="UNKNOWN"})(rt||(rt={}));const lt=[{prefix:/^#/,type:rt.PROGRAM_COMMENT,removePrefix:!1,isPosition:!1},{prefix:/^手合割：/,type:rt.HANDICAP,removePrefix:!0,isPosition:!0},{prefix:/^先手の持駒：/,type:rt.BLACK_HAND,removePrefix:!0,isPosition:!0},{prefix:/^後手の持駒：/,type:rt.WHITE_HAND,removePrefix:!0,isPosition:!0},{prefix:/^\|/,type:rt.BOARD,removePrefix:!1,isPosition:!0},{prefix:/^先手番/,type:rt.BLACK_TURN,removePrefix:!1,isPosition:!0},{prefix:/^後手番/,type:rt.WHITE_TURN,removePrefix:!1,isPosition:!0},{prefix:/^ *[0-9]+ +/,type:rt.MOVE,removePrefix:!1,isPosition:!1},{prefix:/^\*/,type:rt.COMMENT,removePrefix:!0,isPosition:!1}];function ct(e){for(let i=0;i<lt.length;i++){const t=lt[i],n=e.match(t.prefix);if(n){const i=t.removePrefix?n[0].length:0;return{type:t.type,data:e.substring(i),isPosition:t.isPosition,metadataKey:""}}}const t=e.match(/^[^ ]+：/);if(t){const i=t[0];return{type:rt.METADATA,data:e.substring(i.length),isPosition:!1,metadataKey:i.substring(0,i.length-1)}}return{type:rt.UNKNOWN,data:e,isPosition:!1,metadataKey:""}}function ht(e,t){switch(t.trim()){case"平手":return void e.reset(Oe.STANDARD);case"香落ち":return void e.reset(Oe.HANDICAP_LANCE);case"右香落ち":return void e.reset(Oe.HANDICAP_RIGHT_LANCE);case"角落ち":return void e.reset(Oe.HANDICAP_BISHOP);case"飛車落ち":return void e.reset(Oe.HANDICAP_ROOK);case"飛香落ち":return void e.reset(Oe.HANDICAP_ROOK_LANCE);case"二枚落ち":return void e.reset(Oe.HANDICAP_2PIECES);case"四枚落ち":return void e.reset(Oe.HANDICAP_4PIECES);case"六枚落ち":return void e.reset(Oe.HANDICAP_6PIECES);case"八枚落ち":return void e.reset(Oe.HANDICAP_8PIECES);case"その他":return void e.reset(Oe.EMPTY)}return new Error("不正なデータ:"+t)}const dt={"１":1,"２":2,"３":3,"４":4,"５":5,"６":6,"７":7,"８":8,"９":9},ut={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},pt={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"十一":11,"十二":12,"十三":13,"十四":14,"十五":15,"十六":16,"十七":17,"十八":18},gt={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},mt={"王":z.KING,"玉":z.KING,"飛":z.ROOK,"龍":z.DRAGON,"竜":z.DRAGON,"角":z.BISHOP,"馬":z.HORSE,"金":z.GOLD,"銀":z.SILVER,"成銀":z.PROM_SILVER,"全":z.PROM_SILVER,"桂":z.KNIGHT,"成桂":z.PROM_KNIGHT,"圭":z.PROM_KNIGHT,"香":z.LANCE,"成香":z.PROM_LANCE,"杏":z.PROM_LANCE,"歩":z.PAWN,"と":z.PROM_PAWN},_t={"中断":je.INTERRUPT,"投了":je.RESIGN,"持将棋":je.DRAW,"千日手":je.REPETITION_DRAW,"詰み":je.MATE,"切れ負け":je.TIMEOUT,"反則勝ち":je.FOUL_WIN,"反則負け":je.FOUL_LOSE,"入玉勝ち":je.ENTERING_OF_KING,"不戦勝":je.WIN_BY_DEFAULT,"不戦敗":je.LOSS_BY_DEFAULT},vt=/^ *([0-9]+) +[▲△]?([１２３４５６７８９][一二三四五六七八九]|同\u3000)(王|玉|飛|龍|竜|角|馬|金|銀|成銀|全|桂|成桂|圭|香|成香|杏|歩|と)(成?)(打|\([1-9][1-9]\)) *(.*)$/,St=/\( *([0-9]+):([0-9]+)\/[0-9: ]*\)/,Et=/^ *([0-9]+) +(中断|投了|持将棋|千日手|詰み|切れ負け|反則勝ち|反則負け|入玉勝ち|不戦勝|不戦敗) *(.*)$/;function ft(e,t){if(t.length<21)return new Error("不正な盤面:"+t);const i=t[20],n=ut[i];if(!n)return new Error("不正な盤面:"+t);for(let o=0;o<9;o+=1){const i=9-o,a=new Ne(i,n),s=2*o+1,r=t[s+1],l=mt[r];if(!l){e.remove(a);continue}const c="v"!==t[s]?Z.BLACK:Z.WHITE;e.set(a,new pe(c,l))}}function It(e,t){const i=t.split(/[ 　]/);for(const n of i){if(!n||"なし"===n)continue;const t=n[0],i=n.substring(1),o=mt[t],a=pt[i]||1;if(!o)return new Error("不正な持ち駒: "+n);e.add(o,a)}}function yt(e,t){const i=St.exec(t);if(i){const t=i[1],n=i[2],o=60*Number.parseInt(t)+Number.parseInt(n);e.current.setElapsedMs(1e3*o)}}function wt(e,t){let i=Et.exec(t);if(i){const t=Number(i[1]),n=_t[i[2]],o=i[3];return e.goto(t-1),e.append(n,{ignoreValidation:!0}),void yt(e,o)}if(i=vt.exec(t),!i)return new Error("不正な指し手形式:"+t);const n=Number(i[1]),o=i[2],a=i[3],s=i[4],r=i[5],l=i[6];if(0===n)return new Error("不正な手数:"+t);let c,h;if(e.goto(n-1),"同　"===o){if(!(e.current.move instanceof Pe))return new Error("不明な移動先: "+t);c=e.current.move.to}else{const e=dt[o[0]],t=ut[o[1]];c=new Ne(e,t)}if("打"===r)h=mt[a];else{const e=gt[r[1]],t=gt[r[2]];h=new Ne(e,t)}let d=e.position.createMove(h,c);if(!d)return new Error("不正な指し手: "+t);"成"===s&&(d=d.withPromote()),e.append(d,{ignoreValidation:!0}),yt(e,l)}function bt(e){const t=new Je,i=new tt,n=e.split(/\r?\n/),o=new Ue;let a="",s=!1;for(const r of n){if(""===r)continue;const e=ct(r);if(s&&e.isPosition)return new Error("不正なデータ: "+r);let n;switch(e.type){case rt.METADATA:{const i=at[e.metadataKey];i?t.setStandardMetadata(i,e.data):t.setCustomMetadata(e.metadataKey,e.data);break}case rt.HANDICAP:n=ht(o,e.data);break;case rt.BLACK_HAND:n=It(o.blackHand,e.data);break;case rt.WHITE_HAND:n=It(o.whiteHand,e.data);break;case rt.BOARD:n=ft(o.board,e.data);break;case rt.BLACK_TURN:o.setColor(Z.BLACK);break;case rt.WHITE_TURN:o.setColor(Z.WHITE);break;case rt.MOVE:s||(i.clear(o),i.first.comment=a,s=!0),n=wt(i,e.data);break;case rt.COMMENT:s?i.current.comment=it(i.current.comment,e.data):a=it(a,e.data);break;case rt.PROGRAM_COMMENT:break;case rt.UNKNOWN:break}if(n)return n}return s||(i.clear(o),i.first.comment=a),i.goto(0),i.resetAllBranchSelection(),i.metadata=t,i}const At=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八"],Tt=["１","２","３","４","５","６","７","８","９"],Nt=At,Rt={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"成銀",knight:"桂",promKnight:"成桂",lance:"香",promLance:"成香",pawn:"歩",promPawn:"と"},kt={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"全",knight:"桂",promKnight:"圭",lance:"香",promLance:"杏",pawn:"歩",promPawn:"と"},Pt={start:"",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉勝ち",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function Ct(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";for(const o of e.standardMetadataKeys)i+=st[o]+"："+e.getStandardMetadata(o)+n;for(const o of e.customMetadataKeys)i+=o+"："+e.getCustomMetadata(o)+n;return i}function Ot(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";i+="後手の持駒："+Ht(e.whiteHand)+n,i+="  ９ ８ ７ ６ ５ ４ ３ ２ １"+n,i+="+---------------------------+"+n;for(let o=0;o<9;o++){i+="|";for(let t=0;t<9;t++){const n=Ne.newByXY(t,o),a=e.board.at(n);a?a.color===Z.BLACK?i+=" "+kt[a.type]:i+="v"+kt[a.type]:i+=" ・"}i+="|"+Nt[o]+n}return i+="+---------------------------+"+n,i+="先手の持駒："+Ht(e.blackHand)+n,e.color===Z.BLACK?i+="先手番"+n:i+="後手番"+n,i}function Mt(e){let t="";return t+=Tt[e.to.file-1],t+=Nt[e.to.rank-1],t+=Rt[e.pieceType],e.promote&&(t+="成"),e.from instanceof Ne?t+="("+e.from.file+e.from.rank+")":t+="打",t}function Ht(e){let t="";return e.forEach(((e,i)=>{i>=1&&(t+=kt[e],i>=2&&(t+=At[i-1]),t+="　")})),t}function Lt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";return i+="# KIF形式棋譜ファイル Generated by Electron Shogi"+n,i+=Ct(e.metadata,t),i+=Ot(e.initialPosition,t),i+="手数----指手---------消費時間--"+n,e.forEach((e=>{if(0!==e.number){e.isFirstBranch||(i+=n,i+="変化："+e.number+"手"+n),i+=e.number+" ",e.move instanceof Pe?i+=Mt(e.move):i+=Pt[e.move];const t=Ze(e.elapsedMs),o=Ve(e.totalElapsedMs);i+=` (${t}/${o})`,e.isFirstBranch&&e.hasBranch&&(i+="+"),i+=n}0!==e.comment.length&&(i+="*"+e.comment.replaceAll("\n",n+"*")+n)})),i}var Dt,Gt;(function(e){e[e["VERSION"]=0]="VERSION",e[e["EXTENDED_COMMENT"]=1]="EXTENDED_COMMENT",e[e["COMMENT"]=2]="COMMENT",e[e["BLACK_NAME"]=3]="BLACK_NAME",e[e["WHITE_NAME"]=4]="WHITE_NAME",e[e["METADATA"]=5]="METADATA",e[e["POSITION"]=6]="POSITION",e[e["RANK"]=7]="RANK",e[e["PIECES"]=8]="PIECES",e[e["FIRST_TURN"]=9]="FIRST_TURN",e[e["MOVE"]=10]="MOVE",e[e["SPECIAL_MOVE"]=11]="SPECIAL_MOVE",e[e["ELAPSED"]=12]="ELAPSED"})(Dt||(Dt={})),function(e){e[e["HEADER"]=0]="HEADER",e[e["MOVE"]=1]="MOVE",e[e["NEUTRAL"]=2]="NEUTRAL"}(Gt||(Gt={}));const Bt=[{pattern:/^V/,type:Dt.VERSION,sectionType:Gt.HEADER},{pattern:/^'\*(.+)$/,type:Dt.EXTENDED_COMMENT,sectionType:Gt.NEUTRAL},{pattern:/^'(.+)$/,type:Dt.COMMENT,sectionType:Gt.NEUTRAL},{pattern:/^N\+(.+)$/,type:Dt.BLACK_NAME,sectionType:Gt.HEADER},{pattern:/^N-(.+)$/,type:Dt.WHITE_NAME,sectionType:Gt.HEADER},{pattern:/^\$([^:]+):(.+)$/,type:Dt.METADATA,sectionType:Gt.HEADER},{pattern:/^PI([1-9]{2}[A-Z]{2})*$/,type:Dt.POSITION,sectionType:Gt.HEADER},{pattern:/^P[1-9]( \* |[-+][A-Z][A-Z]){9}$/,type:Dt.RANK,sectionType:Gt.HEADER},{pattern:/^P[-+]([0-9]{2}[A-Z]{2})*/,type:Dt.PIECES,sectionType:Gt.HEADER},{pattern:/^[-+]$/,type:Dt.FIRST_TURN,sectionType:Gt.HEADER},{pattern:/^[-+][0-9]{4}[A-Z]{2}/,type:Dt.MOVE,sectionType:Gt.MOVE},{pattern:/^%[-+A-Z_]+/,type:Dt.SPECIAL_MOVE,sectionType:Gt.MOVE},{pattern:/^T([0-9]+)/,type:Dt.ELAPSED,sectionType:Gt.MOVE}];function xt(e){const t=[],i=e.match(/^['N$]/)?[e]:e.split(",");for(const n of i)for(let e=0;e<Bt.length;e++){const i=Bt[e].pattern.exec(n);if(i){t.push({type:Bt[e].type,line:n,args:i.slice(1),sectionType:Bt[e].sectionType});break}}return t}const Wt={EVENT:qe.TITLE,SITE:qe.PLACE,START_TIME:qe.START_DATETIME,END_TIME:qe.END_DATETIME,TIME_LIMIT:qe.TIME_LIMIT,OPENING:qe.STRATEGY},Ut={FU:z.PAWN,KY:z.LANCE,KE:z.KNIGHT,GI:z.SILVER,KI:z.GOLD,KA:z.BISHOP,HI:z.ROOK,OU:z.KING,TO:z.PROM_PAWN,NY:z.PROM_LANCE,NK:z.PROM_KNIGHT,NG:z.PROM_SILVER,UM:z.HORSE,RY:z.DRAGON};function Ft(e,t){t.reset(Oe.STANDARD);for(let i=2;i+4<=e.length;i+=4){const n=Number(e[i]),o=Number(e[i+1]);t.board.remove(new Ne(n,o))}}function Kt(e,t){const i=Number(e[1]);for(let n=0;n<9;n+=1){const o=9-n,a=3*n+2,s=e.slice(a,a+3);if(" "===s[0])continue;const r="+"===s[0]?Z.BLACK:Z.WHITE,l=Ut[s.slice(1)];if(!l)return new Error("不正な駒: "+s);t.board.set(new Ne(o,i),new pe(r,l))}}function qt(e,t){const i="+"===e[1]?Z.BLACK:Z.WHITE;for(let n=2;n+4<=e.length;n+=4){const o=e.slice(n,n+4);if("00AL"===o){const e=Ke(t);return void(i===Z.BLACK?t.blackHand.forEach((i=>{t.blackHand.add(i,e[i])})):t.whiteHand.forEach((i=>{t.whiteHand.add(i,e[i])})))}const a=Number(o[0]),s=Number(o[1]),r=Ut[o.slice(2)];if(!r)return new Error("不正な駒: "+o);0!==a&&0!==s?t.board.set(new Ne(a,s),new pe(i,r)):i===Z.BLACK?t.blackHand.add(r,1):t.whiteHand.add(r,1)}}function jt(e,t){const i="+"===e[0]?Z.BLACK:Z.WHITE;if(i!=t.color)return new Error("不正な手番: "+e);const n=Number(e[1]),o=Number(e[2]),a=Number(e[3]),s=Number(e[4]),r=Ut[e.slice(5,7)];if(!r)return new Error("不正な駒の種類: "+e);const l=0===n&&0===o?r:new Ne(n,o),c=new Ne(a,s);let h=t.createMove(l,c);if(!h)return new Error("不正な指し手: "+e);if(l instanceof Ne){const i=t.board.at(l);if(!i)return new Error("存在しない駒: "+e);if(i.type!==r){if(i.promoted().type!==r)return new Error("存在しない駒: "+e);h=h.withPromote()}}return h}function Vt(e){switch(e){case"%TORYO":return je.RESIGN;case"%CHUDAN":return je.INTERRUPT;case"%SENNICHITE":return je.REPETITION_DRAW;case"%TIME_UP":return je.TIMEOUT;case"%ILLEGAL_MOVE":return je.FOUL_LOSE;case"%JISHOGI":return je.DRAW;case"%KACHI":return je.ENTERING_OF_KING;case"%HIKIWAKE":return je.DRAW;case"%TSUMI":return je.MATE}}function Zt(e,t){return jt(t,e)}function zt(e){const t=new Je,i=new tt,n=new Ue;n.reset(Oe.EMPTY);let o="",a=!1;const s=e.replace(/\r?\n\/(\r?\n[\s\S]*)?$/,"").split(/\r?\n/);for(const r of s)for(const e of xt(r)){if(e.sectionType===Gt.HEADER&&a||e.sectionType===Gt.MOVE&&!a)return new Error("不正な行が検出されました: "+e.line);switch(e.type){case Dt.VERSION:break;case Dt.EXTENDED_COMMENT:a?i.current.comment=it(i.current.comment,e.args[0]):o=it(o,e.args[0]);break;case Dt.COMMENT:break;case Dt.BLACK_NAME:t.setStandardMetadata(qe.BLACK_NAME,e.args[0]);break;case Dt.WHITE_NAME:t.setStandardMetadata(qe.WHITE_NAME,e.args[0]);break;case Dt.METADATA:{const i=Wt[e.args[0]];i?t.setStandardMetadata(i,e.args[1]):t.setCustomMetadata(e.args[0],e.args[1]);break}case Dt.POSITION:Ft(e.line,n);break;case Dt.RANK:{const t=Kt(e.line,n);if(t)return t;break}case Dt.PIECES:{const t=qt(e.line,n);if(t)return t;break}case Dt.FIRST_TURN:"+"===e.line[0]?n.setColor(Z.BLACK):n.setColor(Z.WHITE),i.clear(n),i.first.comment=o,a=!0;break;case Dt.MOVE:{const t=jt(e.line,i.position);if(t instanceof Error)return t;i.append(t,{ignoreValidation:!0});break}case Dt.SPECIAL_MOVE:{const t=Vt(e.line);t&&i.append(t,{ignoreValidation:!0});break}case Dt.ELAPSED:i.current.setElapsedMs(1e3*Number(e.args[0]));break}}return a||(i.clear(n),i.first.comment=o),i.goto(0),i.resetAllBranchSelection(),i.metadata=t,i}function Yt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n",o=e.getStandardMetadata(qe.BLACK_NAME)||e.getStandardMetadata(qe.BLACK_SHORT_NAME);o&&(i+="N+"+o+n);const a=e.getStandardMetadata(qe.WHITE_NAME)||e.getStandardMetadata(qe.WHITE_SHORT_NAME);a&&(i+="N-"+a+n);const s=e.getStandardMetadata(qe.TOURNAMENT)||e.getStandardMetadata(qe.TITLE)||e.getStandardMetadata(qe.OPUS_NAME)||e.getStandardMetadata(qe.PUBLISHED_ON);s&&(i+="$EVENT:"+s+n);const r=e.getStandardMetadata(qe.PLACE);r&&(i+="$SITE:"+r+n);const l=e.getStandardMetadata(qe.START_DATETIME)||e.getStandardMetadata(qe.DATE);l&&(i+="$START_TIME:"+l.slice(10)+n);const c=e.getStandardMetadata(qe.DATE);c&&(i+="$END_TIME:"+c.slice(10)+n);const h=e.getStandardMetadata(qe.STRATEGY);return h&&(i+="$OPENING:"+h+n),i}const $t={king:"OU",rook:"HI",dragon:"RY",bishop:"KA",horse:"UM",gold:"KI",silver:"GI",promSilver:"NG",knight:"KE",promKnight:"NK",lance:"KY",promLance:"NY",pawn:"FU",promPawn:"TO"};function Jt(e){let t="";return e.forEach(((e,i)=>{for(let n=0;n<i;n++)t+="00"+$t[e]})),t}function Xt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";for(let o=1;o<=9;o+=1){i+="P"+o;for(let t=9;t>=1;t-=1){const n=e.board.at(new Ne(t,o));n?n.color===Z.BLACK?i+="+"+$t[n.type]:i+="-"+$t[n.type]:i+=" * "}i+=n}return i+="P+"+Jt(e.blackHand)+n,i+="P-"+Jt(e.whiteHand)+n,i+=(e.color===Z.BLACK?"+":"-")+n,i}function Qt(e){return e instanceof Ne?`${e.file}${e.rank}`:"00"}function ei(e){return(e.color===Z.BLACK?"+":"-")+Qt(e.from)+Qt(e.to)+$t[e.promote?ae(e.pieceType):e.pieceType]}function ti(e){switch(e){case je.RESIGN:return"%TORYO";case je.INTERRUPT:return"%CHUDAN";case je.REPETITION_DRAW:return"%SENNICHITE";case je.TIMEOUT:return"%TIME_UP";case je.FOUL_LOSE:return"%ILLEGAL_MOVE";case je.DRAW:return"%JISHOGI";case je.ENTERING_OF_KING:return"%KACHI";case je.MATE:return"%TSUMI"}}function ii(e){return ei(e)}function ni(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";return i+="' CSA形式棋譜ファイル Generated by Electron Shogi"+n,i+="V2.2"+n,i+=Yt(e.metadata,t),i+=Xt(e.initialPosition,t),e.moves.forEach((e=>{if(0===e.number)return;let t;t=e.move instanceof Pe?ei(e.move):ti(e.move),t&&(i+=t+n,i+="T"+Math.floor(e.elapsedMs/1e3)+n),e.comment&&e.comment.split("\n").forEach((e=>{i+="'*"+e+n}))})),i}var oi;function ai(e){if(e.startsWith("position sfen ")||e.startsWith("position startpos ")||e.startsWith("sfen ")||e.startsWith("startpos ")||e.startsWith("moves "))return oi.USI;if(Ue.isValidSFEN(e))return oi.SFEN;const t=/(^|\n)[#0-9開終棋手戦表持秒記消場掲備先後作発出完分受]/g,i=/(^|,|\n)[-+$%'VNPT]/g,n=e.match(t),o=e.match(i),a=n?n.length:0,s=o?o.length:0;return a>=s?oi.KIF:oi.CSA}(function(e){e[e["USI"]=0]="USI",e[e["SFEN"]=1]="SFEN",e[e["KIF"]=2]="KIF",e[e["CSA"]=3]="CSA"})(oi||(oi={}));const si={};function ri(e){if(si[e])return;const t=document.createElement("img");t.src=e,si[e]=t}class li{constructor(e,t){(0,Y.Z)(this,"width",void 0),(0,Y.Z)(this,"height",void 0),this.width=e,this.height=t}add(e){return new li(this.width+e.width,this.height+e.height)}reduce(e){return new li(this.width-e.width,this.height-e.height)}}var ci,hi,di;(function(e){e["HITOMOJI"]="hitomoji",e["HITOMOJI_DARK"]="hitomojiDark",e["HITOMOJI_GOTHIC"]="hitomojiGothic",e["HITOMOJI_GOTHIC_DARK"]="hitomojiGothicDark"})(ci||(ci={})),function(e){e["LIGHT"]="light",e["WARM"]="warm",e["RESIN"]="resin",e["RESIN2"]="resin2",e["RESIN3"]="resin3",e["DARK"]="dark",e["GREEN"]="green",e["CHERRY_BLOSSOM"]="cherry-blossom"}(hi||(hi={})),function(e){e["NONE"]="none",e["STANDARD"]="standard"}(di||(di={}));const ui={frame:{width:1471,height:959},board:{x:296.5,y:0,width:878,height:960,squreWidth:94.8,squreHeight:104,leftSquarePadding:12,topSquarePadding:12.2,leftPiecePadding:17.5,topPiecePadding:18.5,highlight:{selected:{"background-color":"#0088ff",opacity:"0.8"},lastMoveTo:{"background-color":"#44cc44",opacity:"0.8"},lastMoveFrom:{"background-color":"#44cc44",opacity:"0.4"}}},label:{fontSize:24},piece:{width:88,height:93},hand:{black:{x:1184,y:600},white:{x:0,y:0},width:288,height:360,highlight:{selected:{"background-color":"#ff4800",opacity:"0.7"}}},turn:{black:{x:1184,y:425},white:{x:0,y:492},width:288,height:45,fontSize:32},playerName:{black:{x:1184,y:480},white:{x:0,y:370},width:288,height:45,fontSize:25},clock:{black:{x:1184,y:535},white:{x:0,y:425},width:288,height:55,fontSize:40},control:{left:{x:0,y:547,width:288,height:412,fontSize:26},right:{x:1184,y:0,width:288,height:412,fontSize:26}}},pi={[ci.HITOMOJI]:{black:{pawn:"./piece/hitomoji/black_pawn.png",lance:"./piece/hitomoji/black_lance.png",knight:"./piece/hitomoji/black_knight.png",silver:"./piece/hitomoji/black_silver.png",gold:"./piece/hitomoji/black_gold.png",bishop:"./piece/hitomoji/black_bishop.png",rook:"./piece/hitomoji/black_rook.png",king:"./piece/hitomoji/black_king.png",king2:"./piece/hitomoji/black_king2.png",promPawn:"./piece/hitomoji/black_prom_pawn.png",promLance:"./piece/hitomoji/black_prom_lance.png",promKnight:"./piece/hitomoji/black_prom_knight.png",promSilver:"./piece/hitomoji/black_prom_silver.png",horse:"./piece/hitomoji/black_horse.png",dragon:"./piece/hitomoji/black_dragon.png"},white:{pawn:"./piece/hitomoji/white_pawn.png",lance:"./piece/hitomoji/white_lance.png",knight:"./piece/hitomoji/white_knight.png",silver:"./piece/hitomoji/white_silver.png",gold:"./piece/hitomoji/white_gold.png",bishop:"./piece/hitomoji/white_bishop.png",rook:"./piece/hitomoji/white_rook.png",king:"./piece/hitomoji/white_king.png",king2:"./piece/hitomoji/white_king2.png",promPawn:"./piece/hitomoji/white_prom_pawn.png",promLance:"./piece/hitomoji/white_prom_lance.png",promKnight:"./piece/hitomoji/white_prom_knight.png",promSilver:"./piece/hitomoji/white_prom_silver.png",horse:"./piece/hitomoji/white_horse.png",dragon:"./piece/hitomoji/white_dragon.png"}},[ci.HITOMOJI_DARK]:{black:{pawn:"./piece/hitomoji_dark/black_pawn.png",lance:"./piece/hitomoji_dark/black_lance.png",knight:"./piece/hitomoji_dark/black_knight.png",silver:"./piece/hitomoji_dark/black_silver.png",gold:"./piece/hitomoji_dark/black_gold.png",bishop:"./piece/hitomoji_dark/black_bishop.png",rook:"./piece/hitomoji_dark/black_rook.png",king:"./piece/hitomoji_dark/black_king.png",king2:"./piece/hitomoji_dark/black_king2.png",promPawn:"./piece/hitomoji_dark/black_prom_pawn.png",promLance:"./piece/hitomoji_dark/black_prom_lance.png",promKnight:"./piece/hitomoji_dark/black_prom_knight.png",promSilver:"./piece/hitomoji_dark/black_prom_silver.png",horse:"./piece/hitomoji_dark/black_horse.png",dragon:"./piece/hitomoji_dark/black_dragon.png"},white:{pawn:"./piece/hitomoji_dark/white_pawn.png",lance:"./piece/hitomoji_dark/white_lance.png",knight:"./piece/hitomoji_dark/white_knight.png",silver:"./piece/hitomoji_dark/white_silver.png",gold:"./piece/hitomoji_dark/white_gold.png",bishop:"./piece/hitomoji_dark/white_bishop.png",rook:"./piece/hitomoji_dark/white_rook.png",king:"./piece/hitomoji_dark/white_king.png",king2:"./piece/hitomoji_dark/white_king2.png",promPawn:"./piece/hitomoji_dark/white_prom_pawn.png",promLance:"./piece/hitomoji_dark/white_prom_lance.png",promKnight:"./piece/hitomoji_dark/white_prom_knight.png",promSilver:"./piece/hitomoji_dark/white_prom_silver.png",horse:"./piece/hitomoji_dark/white_horse.png",dragon:"./piece/hitomoji_dark/white_dragon.png"}},[ci.HITOMOJI_GOTHIC]:{black:{pawn:"./piece/hitomoji_gothic/black_pawn.png",lance:"./piece/hitomoji_gothic/black_lance.png",knight:"./piece/hitomoji_gothic/black_knight.png",silver:"./piece/hitomoji_gothic/black_silver.png",gold:"./piece/hitomoji_gothic/black_gold.png",bishop:"./piece/hitomoji_gothic/black_bishop.png",rook:"./piece/hitomoji_gothic/black_rook.png",king:"./piece/hitomoji_gothic/black_king.png",king2:"./piece/hitomoji_gothic/black_king2.png",promPawn:"./piece/hitomoji_gothic/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic/black_prom_silver.png",horse:"./piece/hitomoji_gothic/black_horse.png",dragon:"./piece/hitomoji_gothic/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic/white_pawn.png",lance:"./piece/hitomoji_gothic/white_lance.png",knight:"./piece/hitomoji_gothic/white_knight.png",silver:"./piece/hitomoji_gothic/white_silver.png",gold:"./piece/hitomoji_gothic/white_gold.png",bishop:"./piece/hitomoji_gothic/white_bishop.png",rook:"./piece/hitomoji_gothic/white_rook.png",king:"./piece/hitomoji_gothic/white_king.png",king2:"./piece/hitomoji_gothic/white_king2.png",promPawn:"./piece/hitomoji_gothic/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic/white_prom_silver.png",horse:"./piece/hitomoji_gothic/white_horse.png",dragon:"./piece/hitomoji_gothic/white_dragon.png"}},[ci.HITOMOJI_GOTHIC_DARK]:{black:{pawn:"./piece/hitomoji_gothic_dark/black_pawn.png",lance:"./piece/hitomoji_gothic_dark/black_lance.png",knight:"./piece/hitomoji_gothic_dark/black_knight.png",silver:"./piece/hitomoji_gothic_dark/black_silver.png",gold:"./piece/hitomoji_gothic_dark/black_gold.png",bishop:"./piece/hitomoji_gothic_dark/black_bishop.png",rook:"./piece/hitomoji_gothic_dark/black_rook.png",king:"./piece/hitomoji_gothic_dark/black_king.png",king2:"./piece/hitomoji_gothic_dark/black_king2.png",promPawn:"./piece/hitomoji_gothic_dark/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic_dark/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic_dark/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic_dark/black_prom_silver.png",horse:"./piece/hitomoji_gothic_dark/black_horse.png",dragon:"./piece/hitomoji_gothic_dark/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic_dark/white_pawn.png",lance:"./piece/hitomoji_gothic_dark/white_lance.png",knight:"./piece/hitomoji_gothic_dark/white_knight.png",silver:"./piece/hitomoji_gothic_dark/white_silver.png",gold:"./piece/hitomoji_gothic_dark/white_gold.png",bishop:"./piece/hitomoji_gothic_dark/white_bishop.png",rook:"./piece/hitomoji_gothic_dark/white_rook.png",king:"./piece/hitomoji_gothic_dark/white_king.png",king2:"./piece/hitomoji_gothic_dark/white_king2.png",promPawn:"./piece/hitomoji_gothic_dark/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic_dark/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic_dark/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic_dark/white_prom_silver.png",horse:"./piece/hitomoji_gothic_dark/white_horse.png",dragon:"./piece/hitomoji_gothic_dark/white_dragon.png"}}},gi={[hi.LIGHT]:"./board/grid.svg",[hi.WARM]:"./board/grid.svg",[hi.RESIN]:"./board/grid.svg",[hi.RESIN2]:"./board/grid.svg",[hi.RESIN3]:"./board/grid.svg",[hi.DARK]:"./board/grid_white.svg",[hi.GREEN]:"./board/grid.svg",[hi.CHERRY_BLOSSOM]:"./board/grid.svg"},mi={[hi.LIGHT]:"./board/wood_light.png",[hi.WARM]:"./board/wood_warm.png",[hi.RESIN]:null,[hi.RESIN2]:null,[hi.RESIN3]:null,[hi.DARK]:null,[hi.GREEN]:null,[hi.CHERRY_BLOSSOM]:null},_i={[hi.LIGHT]:"rgba(0, 0, 0, 0)",[hi.WARM]:"rgba(0, 0, 0, 0)",[hi.RESIN]:"#d69b00",[hi.RESIN2]:"#efbf63",[hi.RESIN3]:"#ad7624",[hi.DARK]:"#333333",[hi.GREEN]:"#598459",[hi.CHERRY_BLOSSOM]:"#ecb6b6"},vi={[hi.LIGHT]:"#8b4513",[hi.WARM]:"#8b4513",[hi.RESIN]:"#8b4513",[hi.RESIN2]:"#8b4513",[hi.RESIN3]:"#8b4513",[hi.DARK]:"#333333",[hi.GREEN]:"#527a52",[hi.CHERRY_BLOSSOM]:"#e8a9a9"},Si={black:{pawn:{row:3,column:0,width:2},lance:{row:2,column:0,width:1},knight:{row:2,column:1,width:1},silver:{row:1,column:0,width:1},gold:{row:1,column:1,width:1},bishop:{row:0,column:0,width:1},rook:{row:0,column:1,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}},white:{pawn:{row:0,column:0,width:2},lance:{row:1,column:1,width:1},knight:{row:1,column:0,width:1},silver:{row:2,column:1,width:1},gold:{row:2,column:0,width:1},bishop:{row:3,column:1,width:1},rook:{row:3,column:0,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}}},Ei={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九"};class fi{constructor(e,t,i){(0,Y.Z)(this,"boardImageType",void 0),(0,Y.Z)(this,"boardLabelType",void 0),(0,Y.Z)(this,"pieceImages",void 0),(0,Y.Z)(this,"boardGridImage",void 0),(0,Y.Z)(this,"boardTextureImage",void 0),this.boardImageType=t,this.boardLabelType=i,this.pieceImages=pi[e]||pi[ci.HITOMOJI],this.boardGridImage=gi[t],this.boardTextureImage=mi[t]}preload(){ri(this.boardGridImage),this.boardTextureImage&&ri(this.boardTextureImage),Object.values(this.pieceImages.black).forEach(ri),Object.values(this.pieceImages.white).forEach(ri)}build(e,t,i,n,o,a){let s=e.width/ui.frame.width;ui.frame.height*s>e.height&&(s=e.height/ui.frame.height);const r=()=>{const e=ui.frame.height*s,t=ui.frame.width*s;return{style:{height:e+"px",width:t+"px"},size:new li(t,e)}},l=()=>{const e=ui.board.x*s,t=ui.board.y*s,i=ui.board.width*s,n=ui.board.height*s,o=_i[this.boardImageType],a={"background-color":o,left:e+"px",top:t+"px",height:n+"px",width:i+"px"};return{gridImagePath:this.boardGridImage,textureImagePath:this.boardTextureImage,x:e,y:t,style:a}},c=e=>{const t=[];if(this.boardLabelType==di.NONE)return t;const i=ui.label.fontSize*s,n=.1*i,o={color:"black","font-size":i+"px","font-weight":"bold","text-shadow":`${n}px ${n}px  ${n}px white`};for(let r=1;r<=9;r++){const n=e.x-.5*i+(a?0:ui.board.width)*s+.5*ui.board.leftPiecePadding*s*(a?1:-1),l=e.y-.5*i+(ui.board.topSquarePadding+((a?10-r:r)-.5)*ui.board.squreHeight)*s;t.push({id:"rank"+r,character:Ei[r],style:{left:n+"px",top:l+"px",...o}})}for(let r=1;r<=9;r++){const n=e.x-.5*i+(ui.board.leftPiecePadding+(9.5-(a?10-r:r))*ui.board.squreWidth)*s,l=e.y-.5*i+(a?ui.board.height:0)*s+.5*ui.board.topSquarePadding*s*(a?-1:1);t.push({id:"file"+r,character:String(r),style:{left:n+"px",top:l+"px",...o}})}return t},h=e=>{const i=[];return t.board.listNonEmptySquares().forEach((n=>{const o=t.board.at(n),r=o.id+n.index,l=a?$(o.color):o.color,c=o.type==z.KING&&o.color==Z.BLACK?"king2":o.type,h=this.pieceImages[l][c],d=e.x+(ui.board.leftPiecePadding+ui.board.squreWidth*(a?n.opposite:n).x)*s,u=e.y+(ui.board.topPiecePadding+ui.board.squreHeight*(a?n.opposite:n).y)*s,p=ui.piece.width*s,g=ui.piece.height*s;i.push({id:r,imagePath:h,style:{left:d+"px",top:u+"px",width:p+"px",height:g+"px"}})})),i},d=e=>{const t=[];return Ne.all.forEach((o=>{const r=o.index,{file:l}=o,{rank:c}=o,h=e.x+(ui.board.leftSquarePadding+ui.board.squreWidth*(a?o.opposite:o).x)*s,d=e.y+(ui.board.topSquarePadding+ui.board.squreHeight*(a?o.opposite:o).y)*s,u=ui.board.squreWidth*s,p=ui.board.squreHeight*s,g={left:h+"px",top:d+"px",width:u+"px",height:p+"px"};let m=g;i&&o.equals(i.to)&&(m={...m,...ui.board.highlight.lastMoveTo}),i&&i.from instanceof Ne&&o.equals(i.from)&&(m={...m,...ui.board.highlight.lastMoveFrom}),n instanceof Ne&&n.equals(o)&&(m={...m,...ui.board.highlight.selected}),t.push({id:r,file:l,rank:c,style:g,backgroundStyle:m})})),t},u=(e,t)=>{const i=a?$(e):e,o=vi[this.boardImageType],r=ui.hand[i].x*s,l=ui.hand[i].y*s,c=ui.hand.width*s,h=ui.hand.height*s,d={"background-color":o,left:r+"px",top:l+"px",width:c+"px",height:h+"px"},u=[],p=[];return ie.forEach((o=>{const a=t.count(o),r=Si[i][o],l=ui.hand.width/2*r.width*s,c=ui.hand.height/4*s,h=l*r.column,d=c*r.row,g=ui.piece.width*s,m=ui.piece.height*s,_=Math.max(l-g*a,0)/(2*a),v=(l-g-2*_)/Math.max(a-1,1);for(let e=a-1;e>=0;e-=1){const t=o+e,n=this.pieceImages[i][o],a=h+_+v*e,s=d;u.push({id:t,imagePath:n,style:{left:a+"px",top:s+"px",width:g+"px",height:m+"px"}})}const S=o,E={left:h+"px",top:d+"px",width:l+"px",height:c+"px"};let f=E;n&&n instanceof pe&&n.color===e&&n.type===o&&(f={...f,...ui.hand.highlight.selected}),p.push({id:S,type:o,style:E,backgroundStyle:f})})),{style:d,pieces:u,pointers:p}},p=(e,t)=>{if(!t)return null;const i=a?$(t.color):t.color,n=a?t.to.opposite:t.to,o=new pe(i,t.pieceType),r=o.promoted(),l=o.unpromoted(),c=this.pieceImages[i][r.type],h=this.pieceImages[i][l.type],d=e.x+(ui.board.leftSquarePadding+ui.board.squreWidth*(0===n.x?0:8===n.x?7:n.x-.5))*s,u=e.y+(ui.board.topSquarePadding+ui.board.squreHeight*n.y)*s,p=2*ui.board.squreWidth*s,g=ui.board.squreHeight*s,m={left:d+"px",top:u+"px",width:p+"px",height:g+"px","font-size":g/4+"px"};return{promoteImagePath:c,notPromoteImagePath:h,style:m}},g=()=>{const e=t.color,i=a?$(e):e,n=2;return{style:{left:ui.turn[i].x*s-n+"px",top:ui.turn[i].y*s-n+"px",width:ui.turn.width*s-n+"px",height:ui.turn.height*s-n+"px","font-size":ui.turn.fontSize*s+"px","border-radius":ui.turn.height*s*.4+"px","border-width":n+"px","border-style":"solid"}}},m=e=>{const t=a?$(e):e;return{style:{left:ui.playerName[t].x*s+"px",top:ui.playerName[t].y*s+"px",width:ui.playerName.width*s+"px",height:ui.playerName.height*s+"px","font-size":ui.playerName.fontSize*s+"px"}}},_=e=>{const t=a?$(e):e;return{style:{left:ui.clock[t].x*s+"px",top:ui.clock[t].y*s+"px",width:ui.clock.width*s+"px",height:ui.clock.height*s+"px","font-size":ui.clock.fontSize*s+"px"}}},v=()=>({left:{style:{left:ui.control.left.x*s+"px",top:ui.control.left.y*s+"px",width:ui.control.left.width*s+"px",height:ui.control.left.height*s+"px","font-size":ui.control.left.fontSize*s+"px"}},right:{style:{left:ui.control.right.x*s+"px",top:ui.control.right.y*s+"px",width:ui.control.right.width*s+"px",height:ui.control.right.height*s+"px","font-size":ui.control.right.fontSize*s+"px"}}}),S=r(),E=l(),f=c(E),I=h(E),y=d(E),w=u(Z.BLACK,t.hand(Z.BLACK)),b=u(Z.WHITE,t.hand(Z.WHITE)),A=p(E,o),T=g(),N=m(Z.BLACK),R=m(Z.WHITE),k=_(Z.BLACK),P=_(Z.WHITE),C=v();return{frame:S,board:E,labels:f,piece:I,square:y,blackHand:w,whiteHand:b,promotion:A,turn:T,blackPlayerName:N,whitePlayerName:R,blackClock:k,whiteClock:P,control:C}}}var Ii=(0,o.aZ)({name:"BoardView",props:{pieceImageType:{type:String,required:!0},boardImageType:{type:String,required:!0},boardLabelType:{type:String,required:!0},maxSize:{type:li,required:!0},position:{type:Object,required:!0},lastMove:{type:Object,required:!1,default:null},flip:{type:Boolean,required:!1},allowEdit:{type:Boolean,required:!1},allowMove:{type:Boolean,required:!1},blackPlayerName:{type:String,required:!1,default:"先手"},whitePlayerName:{type:String,required:!1,default:"後手"},blackPlayerTime:{type:Number,required:!1,default:void 0},blackPlayerByoyomi:{type:Number,required:!1,default:void 0},whitePlayerTime:{type:Number,required:!1,default:void 0},whitePlayerByoyomi:{type:Number,required:!1,default:void 0}},emits:["resize","move","edit"],setup(e,t){const i=(0,h.qj)({pointer:null,reservedMove:null}),n=()=>{i.pointer=null,i.reservedMove=null};(0,o.YP)([()=>e.position,()=>e.allowEdit,()=>e.allowMove],(()=>{n()}));const a=()=>{n()},s=(o,a,s)=>{const r=i.pointer;if(n(),!(o instanceof Ne&&r instanceof Ne&&o.equals(r))&&!(o instanceof pe&&r instanceof pe&&o.equals(r))){if(r){const n=r,a=o instanceof Ne?o:o.color;if(e.allowEdit&&e.position.isValidEditing(n,a))return void t.emit("edit",{move:{from:r,to:a}});if(e.allowMove&&o instanceof Ne){const n=r instanceof Ne?r:r.type,a=o,s=e.position.createMove(n,a);if(!s)return;const l=e.position.isValidMove(s),c=e.position.isValidMove(s.withPromote());if(l&&c)return void(i.reservedMove=s);if(l)return void t.emit("move",s);if(c)return void t.emit("move",s.withPromote())}}!e.allowMove&&!e.allowEdit||a||(e.allowEdit||s===e.position.color)&&(i.pointer=o)}},r=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=new Ne(i,n),a=e.position.board.at(o),r=!a;s(o,r,a?.color)},l=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=0===e.position.hand(i).count(n);s(new pe(i,n),o,i)},c=(i,o,a)=>{i.stopPropagation(),i.preventDefault(),n();const s=new Ne(o,a);e.allowEdit&&e.position.board.at(s)&&t.emit("edit",{rotate:s})},d=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a.withPromote())&&t.emit("move",a.withPromote())},u=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a)&&t.emit("move",a)},p=(0,o.Fl)((()=>{const t=new fi(e.pieceImageType,e.boardImageType,e.boardLabelType);return t.preload(),t})),g=(0,o.Fl)((()=>{const n=new li(20,20),o=p.value.build(e.maxSize.reduce(n),e.position,e.lastMove,i.pointer,i.reservedMove,e.flip);return t.emit("resize",o.frame.size.add(n)),o})),m=(e,t)=>e?ze(e):void 0!==t?""+t:"0:00:00",_=(e,t)=>{if(!e&&!t)return"normal";const i=(e||0)+(t||0);return i<=5?"danger":i<=10?"warning":"normal"},v=(0,o.Fl)((()=>m(e.blackPlayerTime,e.blackPlayerByoyomi))),S=(0,o.Fl)((()=>_(e.blackPlayerTime,e.blackPlayerByoyomi))),E=(0,o.Fl)((()=>m(e.whitePlayerTime,e.whitePlayerByoyomi))),f=(0,o.Fl)((()=>_(e.whitePlayerTime,e.whitePlayerByoyomi)));return{clickFrame:a,clickSquare:r,clickHand:l,clickSquareR:c,clickPromote:d,clickNotPromote:u,layout:g,blackPlayerTimeText:v,blackPlayerTimeSeverity:S,whitePlayerTimeText:E,whitePlayerTimeSeverity:f,Color:Z}}}),yi=i(3744);const wi=(0,yi.Z)(Ii,[["render",V],["__scopeId","data-v-7f489073"]]);var bi=wi;const Ai="es://human",Ti="es://usi-engine/";function Ni(e){return e.startsWith(Ti)}function Ri(){const e=Date.now(),t=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16);return Ti+`${e}/${t}`}const ki="USI_Ponder",Pi="USI_MultiPV",Ci="Threads",Oi="NumberOfThreads",Mi="MultiPV";function Hi(e){if(e)return void 0!==e.value?e.value:void 0!==e.default?"string"===e.type&&"<empty>"===e.default?"":e.default:void 0}function Li(e){const t=JSON.parse(JSON.stringify(e));return t.uri=Ri(),t.name+=" のコピー",t}function Di(e,t){e.uri=t.uri,e.name=t.name,Object.keys(t.options).forEach((i=>{e.options[i]&&(e.options[i].value=t.options[i].value)}))}class Gi{constructor(e){if((0,Y.Z)(this,"engines",{}),e){const t=JSON.parse(e);t.engines instanceof Object&&(this.engines=t.engines)}}hasEngine(e){return!!this.engines[e]}addEngine(e){this.engines[e.uri]=e}updateEngine(e){return!!this.engines[e.uri]&&(this.engines[e.uri]=e,!0)}removeEngine(e){return!!this.engines[e]&&(delete this.engines[e],!0)}getEngine(e){return this.engines[e]}get engineList(){return Object.values(this.engines).sort(((e,t)=>e.name!==t.name?e.name>t.name?1:-1:e.defaultName!==t.defaultName?e.defaultName>t.defaultName?1:-1:e.uri>t.uri?1:-1))}get json(){return JSON.stringify(this)}get jsonWithIndent(){return JSON.stringify(this,void 0,2)}}function Bi(e){return(e||new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}function xi(e){return(e||new Date).toLocaleTimeString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}var Wi,Ui,Fi,Ki,qi,ji,Vi,Zi=i(4914),zi=i.n(Zi);function Yi(e){return e>=1500?"先手勝勢":e>=600?"先手優勢":e>=400?"先手有利":e>=200?"先手有望":e>=-200?"互角":e>=-400?"後手有望":e>=-600?"後手有利":e>=-1500?"後手優勢":"後手勝勢"}function $i(e,t){return 100/(1+Math.exp(-e/t))}function Ji(e){const t=/^\*評価値=([+-]?[.0-9]+)/.exec(e);return t?Number(t[1]):void 0}function Xi(e){const t=/^#評価値=([+-]?[.0-9]+)/.exec(e);return t?Number(t[1]):void 0}function Qi(e){const t=/^\* *([+-]?[.0-9]+)/.exec(e);return t?Number(t[1]):void 0}function en(e){e.forEach((t=>{const i=t.customData||{},n=t.comment.split("\n");for(const o of n){const t=Ji(o)||Qi(o);void 0!==t&&(i.playerSearchInfo={usi:e.usi,score:t});const n=Xi(o);void 0!==n&&(i.researchInfo={usi:e.usi,score:n})}t.customData=i}))}function tn(e){switch(e){case Wi.PLAYER:return"*";case Wi.RESEARCHER:return"#"}}function nn(e,t){const i=tn(e);let n="";if(t.mate&&(n+=`${Math.abs(t.mate)}手詰\n`),void 0!==t.score&&(n+=Yi(t.score)+"\n",n+=`${i}評価値=${t.score}\n`),t.pv&&0!==t.pv.length){n+=`${i}読み筋=`;for(const e of t.pv)n+=`${e.getDisplayText()}`;n+="\n"}return n}function on(e){return Ye(e.timeSeconds)+"+"+String(e.byoyomi).padStart(2,"0")}(function(e){e[e["PLAYER"]=0]="PLAYER",e[e["RESEARCHER"]=1]="RESEARCHER"})(Wi||(Wi={})),function(e){e["NONE"]="none",e["INSERT"]="insert",e["APPEND"]="append",e["OVERWRITE"]="overwrite"}(Ui||(Ui={}));class an{constructor(){(0,Y.Z)(this,"_record",new tt),(0,Y.Z)(this,"_recordFilePath",void 0),(0,Y.Z)(this,"onChangePosition",(()=>{})),this.setupHandler()}get record(){return this._record}get recordFilePath(){return this._recordFilePath}updateRecordFilePath(e){this._recordFilePath=e}clearRecordFilePath(){this._recordFilePath=void 0}reset(e){if(e){const t=new Ue;t.reset(e),this._record.clear(t)}else this._record.clear();this.clearRecordFilePath()}resetByCurrentPosition(){this._record.clear(this._record.position),this.clearRecordFilePath()}importRecord(e,t){let i;switch(t||(t=ai(e)),t){case oi.SFEN:{const t=Ue.newBySFEN(e);i=t?new tt(t):new Error("局面を読み込めませんでした。");break}case oi.USI:i=tt.newByUSI(e);break;case oi.KIF:i=bt(e);break;case oi.CSA:i=zt(e);break;default:i=new Error("棋譜フォーマットの検出ができませんでした。");break}if(i instanceof Error)return i;this._record=i,this.setupHandler(),this.clearRecordFilePath(),en(this._record)}importRecordFromBuffer(e,t){let i;if(t.match(/\.kif$/)||t.match(/\.kifu$/)){const n=t.match(/\.kif$/)?zi().decode(e,"Shift_JIS"):(new TextDecoder).decode(e);i=bt(n)}else i=t.match(/\.csa$/)?zt((new TextDecoder).decode(e)):new Error("不明なファイル形式: "+t);if(i instanceof Error)return i;this._record=i,this.setupHandler(),this._recordFilePath=t,en(this._record)}exportRecordAsBuffer(e,t){let i;if(e.match(/\.kif$/)||e.match(/\.kifu$/)){const n=Lt(this.record,t);i=e.match(/\.kif$/)?zi().encode(n,"Shift_JIS"):(new TextEncoder).encode(n)}else{if(!e.match(/\.csa$/))return new Error("不明なファイル形式: "+e);i=(new TextEncoder).encode(ni(this.record,t))}return this.updateRecordFilePath(e),i}swapNextTurn(){const e=this.record.position.clone();e.setColor($(e.color)),this._record.clear(e),this.clearRecordFilePath()}changePosition(e){const t=this.record.position.clone();t.edit(e),this._record.clear(t),this.clearRecordFilePath()}changeMoveNumber(e){this._record.goto(e)}changeBranch(e){return this._record.switchBranchByIndex(e)}removeCurrentMove(){this._record.removeCurrentMove()}removeNextMove(){this._record.removeNextMove()}updateComment(e){this._record.current.comment=e}appendComment(e,t){if(!e)return;const i=this._record.current.comment,n=this.record.current.comment?"\n":"";switch(t){case Ui.NONE:break;case Ui.INSERT:this._record.current.comment=e+n+i;break;case Ui.APPEND:this._record.current.comment=i+n+e;break;case Ui.OVERWRITE:this._record.current.comment=e;break}}setGameStartMetadata(e){e.gameTitle&&this._record.metadata.setStandardMetadata(qe.TITLE,e.gameTitle),e.blackName&&this._record.metadata.setStandardMetadata(qe.BLACK_NAME,e.blackName),e.whiteName&&this._record.metadata.setStandardMetadata(qe.WHITE_NAME,e.whiteName),this._record.metadata.setStandardMetadata(qe.DATE,Bi()),this._record.metadata.setStandardMetadata(qe.START_DATETIME,xi()),e.timeLimit&&this._record.metadata.setStandardMetadata(qe.TIME_LIMIT,on(e.timeLimit))}setGameEndMetadata(){this._record.metadata.setStandardMetadata(qe.END_DATETIME,xi())}updateSearchInfo(e,t){const i=this.record.current.customData||{};switch(e){case Wi.PLAYER:i.playerSearchInfo=t;break;case Wi.RESEARCHER:i.researchInfo=t;break}this._record.current.customData=i}updateEnemySearchInfo(e){const t=this.record.current.customData||{};t.enemySearchInfo=e,this._record.current.customData=t}appendMove(e){const t=this._record.append(e.move,e.moveOption);return!!t&&(void 0!==e.elapsedMs&&this._record.current.setElapsedMs(e.elapsedMs),!0)}updateStandardMetadata(e){this._record.metadata.setStandardMetadata(e.key,e.value)}on(e,t){switch(e){case"changePosition":this.onChangePosition=t;break}this.setupHandler()}setupHandler(){this._record.on("changePosition",this.onChangePosition)}}function sn(){return{startCriteria:{enableNumber:!1,number:20},endCriteria:{enableNumber:!1,number:100},perMoveCriteria:{maxSeconds:5},commentBehavior:Ui.INSERT}}function rn(e){return{thema:Fi.STANDARD,pieceImage:ci.HITOMOJI,boardImage:hi.LIGHT,boardLabelType:di.STANDARD,pieceVolume:30,clockVolume:30,clockPitch:500,clockSoundTarget:qi.ONLY_USER,boardFlipping:!1,tab:Ki.RECORD_INFO,returnCode:e?.returnCode||"\r\n",autoSaveDirectory:e?.autoSaveDirectory||"",coefficientInSigmoid:600,badMoveLevelThreshold1:5,badMoveLevelThreshold2:10,badMoveLevelThreshold3:20,badMoveLevelThreshold4:50,showElapsedTimeInRecordView:!0,showCommentInRecordView:!0,enableAppLog:!1,enableUSILog:!1,enableCSALog:!1}}function ln(e){return e.pieceVolume<0||e.pieceVolume>100?new Error("駒音の大きさには0%～100%の値を指定してください。"):e.clockVolume<0||e.clockVolume>100?new Error("時計音の大きさには0%～100%の値を指定してください。"):e.clockPitch<220||e.clockPitch>880?new Error("時計音の高さには220Hz～880Hzの値を指定してください。"):e.coefficientInSigmoid<=0?new Error("勝率換算係数には0より大きい値を指定してください。"):e.badMoveLevelThreshold1<1||e.badMoveLevelThreshold1>100?new Error("緩手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold2<1||e.badMoveLevelThreshold2>100?new Error("疑問手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold3<1||e.badMoveLevelThreshold3>100?new Error("悪手には1%～100%の閾値を指定してください。"):e.badMoveLevelThreshold4<1||e.badMoveLevelThreshold4>100?new Error("大悪手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold1>=e.badMoveLevelThreshold2?new Error("緩手には疑問手より小さい値を指定してください。"):e.badMoveLevelThreshold2>=e.badMoveLevelThreshold3?new Error("疑問手には悪手より小さい値を指定してください。"):e.badMoveLevelThreshold3>=e.badMoveLevelThreshold4?new Error("悪手には大悪手より小さい値を指定してください。"):void 0}function cn(){return{black:{name:"人",uri:Ai},white:{name:"人",uri:Ai},timeLimit:{timeSeconds:0,byoyomi:30,increment:0},enableEngineTimeout:!1,humanIsFront:!0,enableComment:!0,enableAutoSave:!0,repeat:1,swapPlayers:!1,maxMoves:1e3}}function hn(e){return 0===e.timeLimit.timeSeconds&&0===e.timeLimit.byoyomi?new Error("持ち時間と秒読みが両方とも0です。"):0!==e.timeLimit.byoyomi&&0!==e.timeLimit.increment?new Error("秒読みとフィッシャールールは併用できません。"):void 0}function dn(e){const t=hn(e);return t||(e.enableAutoSave?new Error("自動保存はWeb版で利用できません。"):void 0)}function un(){return{}}(function(e){e["STANDARD"]="standard",e["CHERRY_BLOSSOM"]="cherry-blossom",e["DARK"]="dark"})(Fi||(Fi={})),function(e){e["RECORD_INFO"]="recordInfo",e["COMMENT"]="comment",e["SEARCH"]="search",e["PV"]="pv",e["CHART"]="chart",e["PERCENTAGE_CHART"]="percentageChart",e["INVISIBLE"]="invisible"}(Ki||(Ki={})),function(e){e["ALL"]="all",e["ONLY_USER"]="onlyUser"}(qi||(qi={})),function(e){e["INFO"]="info",e["WARN"]="warn",e["ERROR"]="error"}(ji||(ji={})),function(e){e["APP_SETTING"]="appSetting",e["RESEARCH_SETTING"]="researchSetting",e["ANALYSIS_SETTING"]="analysisSetting",e["GAME_SETTING"]="gameSetting",e["CSA_GAME_SETTING_HISTORY"]="csaGameSettingHistory"}(Vi||(Vi={}));const pn={async getRecordPathFromProcArg(){return""},updateMenuState(){},async showOpenRecordDialog(){throw"Web版では利用できない機能です。"},async openRecord(){throw"Web版では利用できない機能です。"},async showSaveRecordDialog(){throw"Web版では利用できない機能です。"},async saveRecord(){throw"Web版では利用できない機能です。"},async showSelectFileDialog(){throw"Web版では利用できない機能です。"},async showSelectDirectoryDialog(){throw"Web版では利用できない機能です。"},async loadAppSetting(){const e=localStorage.getItem(Vi.APP_SETTING);return e?JSON.stringify({...rn(),...JSON.parse(e)}):JSON.stringify(rn())},async saveAppSetting(e){localStorage.setItem(Vi.APP_SETTING,e)},async loadResearchSetting(){const e=localStorage.getItem(Vi.RESEARCH_SETTING);return e?JSON.stringify({...un(),...JSON.parse(e)}):JSON.stringify(un())},async saveResearchSetting(e){localStorage.setItem(Vi.RESEARCH_SETTING,e)},async loadAnalysisSetting(){const e=localStorage.getItem(Vi.ANALYSIS_SETTING);return e?JSON.stringify({...sn(),...JSON.parse(e)}):JSON.stringify(sn())},async saveAnalysisSetting(e){localStorage.setItem(Vi.ANALYSIS_SETTING,e)},async loadGameSetting(){const e=localStorage.getItem(Vi.GAME_SETTING);return e?JSON.stringify({...cn(),...JSON.parse(e)}):JSON.stringify(cn())},async saveGameSetting(e){localStorage.setItem(Vi.GAME_SETTING,e)},async loadCSAGameSettingHistory(){throw"Web版では利用できない機能です。"},async saveCSAGameSettingHistory(e){localStorage.setItem(Vi.CSA_GAME_SETTING_HISTORY,e)},async loadUSIEngineSetting(){return(new Gi).json},async saveUSIEngineSetting(){},async showSelectUSIEngineDialog(){throw"Web版では利用できない機能です。"},async getUSIEngineInfo(){throw"Web版では利用できない機能です。"},async sendUSISetOption(){},async usiLaunch(){throw"Web版では利用できない機能です。"},async usiGo(){},async usiGoPonder(){},async usiPonderHit(){},async usiGoInfinite(){},async usiStop(){},async usiGameover(){},async usiQuit(){},async csaLogin(){throw"Web版では利用できない機能です。"},async csaLogout(){},async csaAgree(){},async csaMove(){},async csaResign(){},async csaWin(){},async csaStop(){},log(e,t){switch(e){case ji.INFO:console.log(t);break;case ji.WARN:console.warn(t);break;case ji.ERROR:console.error(t);break}},onSendError(){},onMenuEvent(){},onUSIBestMove(){},onUSIInfo(){},onUSIPonderInfo(){},onCSAGameSummary(){},onCSAReject(){},onCSAStart(){},onCSAMove(){},onCSAGameResult(){},onCSAClose(){}};function gn(){return window}const mn=gn().electronShogiAPI||pn,_n={...mn,async loadAppSetting(){return JSON.parse(await mn.loadAppSetting())},saveAppSetting(e){return mn.saveAppSetting(JSON.stringify(e))},async loadResearchSetting(){return JSON.parse(await mn.loadResearchSetting())},saveResearchSetting(e){return mn.saveResearchSetting(JSON.stringify(e))},async loadAnalysisSetting(){return JSON.parse(await mn.loadAnalysisSetting())},saveAnalysisSetting(e){return mn.saveAnalysisSetting(JSON.stringify(e))},async loadGameSetting(){return JSON.parse(await mn.loadGameSetting())},saveGameSetting(e){return mn.saveGameSetting(JSON.stringify(e))},async loadCSAGameSettingHistory(){return JSON.parse(await mn.loadCSAGameSettingHistory())},saveCSAGameSettingHistory(e){return mn.saveCSAGameSettingHistory(JSON.stringify(e))},async loadUSIEngineSetting(){return new Gi(await mn.loadUSIEngineSetting())},saveUSIEngineSetting(e){return mn.saveUSIEngineSetting(e.json)},async getUSIEngineInfo(e){return JSON.parse(await mn.getUSIEngineInfo(e))},usiLaunch(e){return mn.usiLaunch(JSON.stringify(e))},usiGo(e,t,i,n,o){return mn.usiGo(e,t,JSON.stringify(i),n,o)},usiGoPonder(e,t,i,n,o){return mn.usiGoPonder(e,t,JSON.stringify(i),n,o)},csaLogin(e){return mn.csaLogin(JSON.stringify(e))}};var vn=_n;function Sn(){return!!gn().electronShogiAPI}function En(e){const t=e?.type||"sine",i=e?.frequency||440,n=e?.volume||2,o=new AudioContext,a=o.createOscillator(),s=o.createGain();return a.connect(s),s.connect(o.destination),a.type=t,a.frequency.value=i,s.gain.value=.005*n,a.onended=()=>{s.disconnect(o.destination),a.disconnect(s)},a.start(o.currentTime),e?.time&&a.stop(o.currentTime+e.time),{stop:()=>{e?.time||a.stop()}}}function fn(e){En({type:"sine",frequency:e.frequency,time:.1,volume:e.volume})}function In(e){return En({type:"sine",frequency:e.frequency,volume:e.volume})}let yn;function wn(e){const t=Date.now();if(yn&&t<yn+200)return;const i=new Audio("sound/piece.mp3");i.volume=.01*e,i.play(),yn=t}var bn,An,Tn,Nn;function Rn(e,t){return{player1:{name:e,win:0},player2:{name:t,win:0},draw:0,invalid:0,total:0}}(function(e){e["WIN"]="win",e["LOSE"]="lose",e["DRAW"]="draw"})(bn||(bn={})),function(e){e["IDLE"]="idle",e["ACTIVE"]="active",e["PENDING"]="pending",e["BUSSY"]="bussy"}(An||(An={}));class kn{constructor(e,t,i,n,o){(0,Y.Z)(this,"recordManager",void 0),(0,Y.Z)(this,"blackClock",void 0),(0,Y.Z)(this,"whiteClock",void 0),(0,Y.Z)(this,"playerBuilder",void 0),(0,Y.Z)(this,"handlers",void 0),(0,Y.Z)(this,"state",void 0),(0,Y.Z)(this,"_setting",void 0),(0,Y.Z)(this,"startMoveNumber",0),(0,Y.Z)(this,"repeat",0),(0,Y.Z)(this,"blackPlayer",void 0),(0,Y.Z)(this,"whitePlayer",void 0),(0,Y.Z)(this,"gameResults",Rn("","")),(0,Y.Z)(this,"lastEventID",void 0),this.recordManager=e,this.blackClock=t,this.whiteClock=i,this.playerBuilder=n,this.handlers=o,this.state=An.IDLE,this._setting=cn(),this.lastEventID=0}get setting(){return this._setting}async startGame(e){if(this.state!==An.IDLE)throw Error("GameManager#startGame: 前回の対局が正常に終了できていません。アプリを再起動してください。");this._setting=e,this.repeat=0,e.startPosition||(this.startMoveNumber=this.recordManager.record.current.number),this.gameResults=Rn(e.black.name,e.white.name),await this.nextGame()}async nextGame(){this.repeat++,this.setting.startPosition?this.recordManager.reset(this.setting.startPosition):this.recordManager.record.current.number!==this.startMoveNumber&&(this.recordManager.changeMoveNumber(this.startMoveNumber),this.recordManager.removeNextMove()),this.recordManager.setGameStartMetadata({gameTitle:this.setting.repeat>=2?`連続対局 ${this.repeat}/${this.setting.repeat}`:void 0,blackName:this.setting.black.name,whiteName:this.setting.white.name,timeLimit:this.setting.timeLimit});const e={timeMs:1e3*this.setting.timeLimit.timeSeconds,byoyomi:this.setting.timeLimit.byoyomi,increment:this.setting.timeLimit.increment,onBeepShort:()=>this.handlers.onBeepShort(),onBeepUnlimited:()=>this.handlers.onBeepUnlimited(),onStopBeep:()=>this.handlers.onStopBeep()};this.blackClock.setup({...e,onTimeout:()=>{this.timeout(Z.BLACK)}}),this.whiteClock.setup({...e,onTimeout:()=>{this.timeout(Z.WHITE)}});try{this.blackPlayer=await this.playerBuilder.build(this.setting.black,(e=>this.recordManager.updateEnemySearchInfo(e))),this.whitePlayer=await this.playerBuilder.build(this.setting.white,(e=>this.recordManager.updateEnemySearchInfo(e)))}catch(t){try{await this.closePlayers()}catch(i){this.handlers.onError(i)}throw t}this.state=An.ACTIVE,this.handlers.onGameNext(),setTimeout((()=>this.nextMove()))}nextMove(){if(this.state!==An.ACTIVE)return void this.handlers.onError("GameManager#nextMove: 予期せぬステータスです:"+this.state);if(this._setting.maxMoves&&this.recordManager.record.current.number>=this._setting.maxMoves)return void this.endGame(je.DRAW);const e=this.recordManager.record.position.color;this.getActiveClock().start();const t=this.getPlayer(e),i=this.getPlayer($(e));if(!t||!i)return void this.handlers.onError("GameManager#nextMove: プレイヤーが初期化されていません。");const n=this.issueEventID();t.startSearch(this.recordManager.record,this.setting.timeLimit,this.blackClock.timeMs,this.whiteClock.timeMs,{onMove:(e,t)=>this.onMove(n,e,t),onResign:()=>this.onResign(n),onWin:()=>this.onWin(n),onError:e=>this.handlers.onError(e)}).catch((e=>{this.handlers.onError(new Error("GameManager#nextMove: プレイヤーにコマンドを送信できませんでした: "+e))})),i.startPonder(this.recordManager.record,this.setting.timeLimit,this.blackClock.timeMs,this.whiteClock.timeMs).catch((e=>{this.handlers.onError(new Error("GameManager#nextMove: プレイヤーにPonderコマンドを送信できませんでした: "+e))}))}onMove(e,t,i){if(e!==this.lastEventID)return void vn.log(ji.ERROR,"GameManager#onMove: event ID already disabled");if(this.state!==An.ACTIVE)return void vn.log(ji.ERROR,"GameManager#onMove: invalid state: "+this.state);if(!this.recordManager.record.position.isValidMove(t))return this.handlers.onError("反則手: "+t.getDisplayText()),void this.endGame(je.FOUL_LOSE);if(this.getActiveClock().stop(),this.recordManager.appendMove({move:t,moveOption:{ignoreValidation:!0},elapsedMs:this.getActiveClock().elapsedMs}),i&&this.recordManager.updateSearchInfo(Wi.PLAYER,i),i&&this.setting.enableComment){const e=nn(Wi.PLAYER,i);this.recordManager.appendComment(e,Ui.APPEND)}this.handlers.onPieceBeat();const n=this.recordManager.record.perpetualCheck;if(n)return n===this.recordManager.record.position.color?void this.endGame(je.FOUL_LOSE):void this.endGame(je.FOUL_WIN);this.recordManager.record.repetition?this.endGame(je.REPETITION_DRAW):this.nextMove()}onResign(e){e===this.lastEventID?this.state===An.ACTIVE?this.endGame(je.RESIGN):vn.log(ji.ERROR,"GameManager#onResign: invalid state: "+this.state):vn.log(ji.ERROR,"GameManager#onResign: event ID already disabled")}onWin(e){e===this.lastEventID?this.state===An.ACTIVE?this.endGame(je.ENTERING_OF_KING):vn.log(ji.ERROR,"GameManager#onWin: invalid state: "+this.state):vn.log(ji.ERROR,"GameManager#onWin: event ID already disabled")}onTimeout(){this.state===An.ACTIVE?this.endGame(je.TIMEOUT):this.handlers.onError("GameManager#onTimeout: 予期せぬステータスです: "+this.state)}timeout(e){this.handlers.onStopBeep();const t=this.getPlayer(e);t&&t.isEngine()&&!this.setting.enableEngineTimeout?t.stop().catch((e=>{this.handlers.onError(new Error("GameManager#timeout: プレイヤーにコマンドを送信できませんでした: "+e))})):this.onTimeout()}endGame(e){if(this.state!==An.ACTIVE&&this.state!==An.PENDING)return;this.state=An.BUSSY;const t=this.recordManager.record.position.color;Promise.resolve().then((()=>this.sendGameResults(t,e))).then((()=>this.closePlayers())).then((()=>{this.getActiveClock().pause(),this.recordManager.appendMove({move:e,elapsedMs:this.getActiveClock().elapsedMs}),this.recordManager.setGameEndMetadata(),this.updateGameResults(t,e),this.state=An.IDLE})).then((()=>{if(this._setting.enableAutoSave)return this.handlers.onSaveRecord()})).then((()=>{const t=e===je.INTERRUPT||this.repeat>=this.setting.repeat;t?this.handlers.onGameEnd(this.gameResults,e):(this.setting.swapPlayers&&this.swapPlayers(),this.nextGame().catch((e=>{this.handlers.onError(e)})))})).catch((e=>{this.handlers.onError(e),this.state=An.PENDING}))}updateGameResults(e,t){const i=Pn(e,Z.BLACK,t);switch(i){case bn.WIN:this.gameResults.player1.win++;break;case bn.LOSE:this.gameResults.player2.win++;break;case bn.DRAW:this.gameResults.draw++;break;default:this.gameResults.invalid++;break}this.gameResults.total++}swapPlayers(){this._setting={...this.setting,black:this.setting.white,white:this.setting.black},this.gameResults={...this.gameResults,player1:this.gameResults.player2,player2:this.gameResults.player1}}async sendGameResults(e,t){if(this.blackPlayer){const i=Pn(e,Z.BLACK,t);i&&await this.blackPlayer.gameover(i)}if(this.whitePlayer){const i=Pn(e,Z.WHITE,t);i&&await this.whitePlayer.gameover(i)}}async closePlayers(){this.blackPlayer&&(await this.blackPlayer.close(),this.blackPlayer=void 0),this.whitePlayer&&(await this.whitePlayer.close(),this.whitePlayer=void 0)}getPlayer(e){switch(e){case Z.BLACK:return this.blackPlayer;case Z.WHITE:return this.whitePlayer}}getActiveClock(){const e=this.recordManager.record.position.color;switch(e){case Z.BLACK:return this.blackClock;case Z.WHITE:return this.whiteClock}}issueEventID(){return this.lastEventID+=1,this.lastEventID}}function Pn(e,t,i){switch(i){case je.FOUL_WIN:case je.ENTERING_OF_KING:return e==t?bn.WIN:bn.LOSE;case je.RESIGN:case je.MATE:case je.TIMEOUT:case je.FOUL_LOSE:return e==t?bn.LOSE:bn.WIN;case je.DRAW:case je.REPETITION_DRAW:return bn.DRAW}return null}function Cn(e){let t=On(e);const i=e.getStandardMetadata(qe.TITLE)||e.getStandardMetadata(qe.TOURNAMENT)||e.getStandardMetadata(qe.OPUS_NAME)||e.getStandardMetadata(qe.OPUS_NO)||e.getStandardMetadata(qe.PLACE)||e.getStandardMetadata(qe.POSTED_ON)||e.getStandardMetadata(qe.AUTHOR);i&&(t+="_"+i);const n=e.getStandardMetadata(qe.BLACK_NAME)||e.getStandardMetadata(qe.BLACK_SHORT_NAME);n&&(t+="_"+n);const o=e.getStandardMetadata(qe.WHITE_NAME)||e.getStandardMetadata(qe.WHITE_SHORT_NAME);return o&&(t+="_"+o),t.trim().replaceAll("/","_").replaceAll("\\","_")+".kif"}function On(e){const t=e.getStandardMetadata(qe.START_DATETIME)||e.getStandardMetadata(qe.DATE);return t?t.trim().replaceAll(" ","_").replaceAll("/","").replaceAll(":",""):(new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}).replaceAll("/","")}class Mn{constructor(){(0,Y.Z)(this,"count",0)}get isBussy(){return 0!==this.count}retain(){this.count+=1}release(){this.count-=1}}function Hn(e,t){const i=[],n=e.clone();for(const o of t){const e=n.createMoveBySFEN(o);if(!e||!n.doMove(e))break;i.push(e)}return i}function Ln(e,t){const i=e.clone();let n,o="";for(const a of t){const e=i.createMoveBySFEN(a);if(!e)break;i.doMove(e,{ignoreValidation:!0}),o+=e.getDisplayText(n),n=e}return o}(function(e){e["BLACK_PLAYER"]="blackPlayer",e["WHITE_PLAYER"]="whitePlayer",e["RESEARCHER"]="researcher"})(Tn||(Tn={}));class Dn{constructor(e,t,i){(0,Y.Z)(this,"sessionID",void 0),(0,Y.Z)(this,"name",void 0),(0,Y.Z)(this,"sfen",void 0),(0,Y.Z)(this,"nodes",void 0),(0,Y.Z)(this,"nps",void 0),(0,Y.Z)(this,"iterates",[]),(0,Y.Z)(this,"hashfull",void 0),(0,Y.Z)(this,"currentMove",void 0),(0,Y.Z)(this,"currentMoveText",void 0),(0,Y.Z)(this,"ponderMove",void 0),this.sessionID=e,this.name=t,this.sfen=i}get latestIteration(){const e=[],t=new Set,i=new Set;for(const n of this.iterates){const o=n.pv?n.pv[0]:void 0;t.has(n.multiPV)||i.has(o)||(e.push(n),t.add(n.multiPV),i.add(o))}return e.sort(((e,t)=>(e.multiPV||1)-(t.multiPV||1)))}update(e,t,i){const n=Ue.newBySFEN(e),o={position:e};if(void 0!==t.depth&&(o.depth=t.depth),void 0!==t.seldepth&&(o.selectiveDepth=t.seldepth),void 0!==t.timeMs&&(o.timeMs=t.timeMs),void 0!==t.nodes&&(this.nodes=t.nodes),t.pv&&(o.pv=t.pv,o.text=n?Ln(n,t.pv):""),void 0!==t.multipv&&(o.multiPV=t.multipv),void 0!==t.scoreCP&&(o.score=t.scoreCP),void 0!==t.scoreMate&&(o.scoreMate=t.scoreMate),void 0!==t.lowerbound&&(o.lowerBound=t.lowerbound),void 0!==t.upperbound&&(o.upperBound=t.upperbound),void 0!==t.currmove){this.currentMove=t.currmove;const e=n&&n.createMoveBySFEN(t.currmove);e&&(this.currentMoveText=e.getDisplayText())}void 0!==t.hashfullPerMill&&(this.hashfull=t.hashfullPerMill/1e3),void 0!==t.nps&&(this.nps=t.nps),t.string&&(o.text=t.string),0!==Object.keys(o).length&&(void 0!==t.nodes&&(o.nodes=t.nodes),this.iterates.unshift(o)),this.ponderMove=i?.getDisplayText()}}class Gn{constructor(){(0,Y.Z)(this,"_blackPlayer",void 0),(0,Y.Z)(this,"_whitePlayer",void 0),(0,Y.Z)(this,"_researcher",void 0),(0,Y.Z)(this,"updateQueue",[]),(0,Y.Z)(this,"timeoutHandle",void 0)}get blackPlayer(){return this._blackPlayer}get whitePlayer(){return this._whitePlayer}get researcher(){return this._researcher}clear(){this._blackPlayer=void 0,this._whitePlayer=void 0,this._researcher=void 0,this.updateQueue=[]}update(e,t,i,n,o,a){this.updateQueue.push({sessionID:e,sfen:t.sfen,sender:i,name:n,info:o,ponderMove:a}),this.timeoutHandle||(this.timeoutHandle=window.setTimeout((()=>{this.dequeue()}),500))}dequeue(){for(const e of this.updateQueue)this._update(e);this.updateQueue=[],this.timeoutHandle=void 0}_update(e){switch(e.sender){case Tn.BLACK_PLAYER:this._blackPlayer&&this._blackPlayer.sessionID===e.sessionID&&this._blackPlayer.sfen===e.sfen||(this._blackPlayer=new Dn(e.sessionID,e.name,e.sfen)),this._blackPlayer.update(e.sfen,e.info,e.ponderMove),this._researcher=void 0;break;case Tn.WHITE_PLAYER:this._whitePlayer&&this._whitePlayer.sessionID===e.sessionID&&this._whitePlayer.sfen===e.sfen||(this._whitePlayer=new Dn(e.sessionID,e.name,e.sfen)),this._whitePlayer.update(e.sfen,e.info,e.ponderMove),this._researcher=void 0;break;case Tn.RESEARCHER:this._researcher&&this._researcher.sessionID===e.sessionID&&this._researcher.sfen===e.sfen||(this._researcher=new Dn(e.sessionID,e.name,e.sfen)),this._researcher.update(e.sfen,e.info),this._blackPlayer=void 0,this._whitePlayer=void 0;break}}}(function(e){e["NORMAL"]="normal",e["PASTE_DIALOG"]="pasteDialog",e["POSITION_EDITING"]="positionEditing",e["GAME_DIALOG"]="gameDialog",e["GAME"]="game",e["CSA_GAME_DIALOG"]="csaGameDialog",e["CSA_GAME"]="csaGame",e["RESEARCH"]="research",e["RESEARCH_DIALOG"]="researchDialog",e["ANALYSIS"]="analysis",e["ANALYSIS_DIALOG"]="analysisDialog",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSettingDialog",e["TEMPORARY"]="temporary"})(Nn||(Nn={}));class Bn{constructor(){(0,Y.Z)(this,"_queue",[])}get message(){return this._queue[0]}get hasMessage(){return 0!==this._queue.length}enqueue(e){this._queue.push(e)}dequeue(){this._queue.shift()}}class xn{constructor(){(0,Y.Z)(this,"_queue",[])}get errors(){return this._queue}get hasError(){return 0!==this._queue.length}push(e){e instanceof Error?this._queue.push(e):this._queue.push(new Error(""+e))}clear(){this._queue=[]}}class Wn{constructor(e,t){(0,Y.Z)(this,"setting",void 0),(0,Y.Z)(this,"onSearchInfo",void 0),(0,Y.Z)(this,"sessionID",0),(0,Y.Z)(this,"usi",void 0),(0,Y.Z)(this,"position",void 0),(0,Y.Z)(this,"searchHandler",void 0),(0,Y.Z)(this,"ponder",void 0),(0,Y.Z)(this,"inPonder",!1),(0,Y.Z)(this,"info",void 0),(0,Y.Z)(this,"usiInfoTimeout",void 0),this.setting=e,this.onSearchInfo=t}async launch(){this.sessionID=await vn.usiLaunch(this.setting),Un[this.sessionID]=this}isEngine(){return!0}async startSearch(e,t,i,n,o){this.searchHandler=o,this.usi=e.usi,this.position=e.position.clone(),this.inPonder&&this.ponder===this.usi?vn.usiPonderHit(this.sessionID):(this.info=void 0,await vn.usiGo(this.sessionID,this.usi,t,i,n)),this.inPonder=!1,this.ponder=void 0}async startPonder(e,t,i,n){const o=e.usi;if(!this.ponder||!this.ponder.startsWith(o))return;const a=Hi(this.setting.options[ki]);if("true"!==a)return;this.searchHandler=void 0,this.usi=this.ponder,this.position=e.position.clone();const s=this.position.createMoveBySFEN(this.ponder.slice(o.length+1));s&&(this.position.doMove(s),this.info=void 0,this.inPonder=!0,await vn.usiGoPonder(this.sessionID,this.ponder,t,i,n))}async startResearch(e){this.searchHandler=void 0,this.usi=e.usi,this.info=void 0,this.position=e.position.clone(),await vn.usiGoInfinite(this.sessionID,e.usi)}async stop(){await vn.usiStop(this.sessionID)}async gameover(e){await vn.usiGameover(this.sessionID,e)}async close(){this.searchHandler=void 0,await vn.usiQuit(this.sessionID),delete Un[this.sessionID]}onBestMove(e,t,i){const n=this.searchHandler;if(this.searchHandler=void 0,!n||!this.position)return;if(e!==this.usi)return;if("resign"===t)return void n.onResign();if("win"===t)return void n.onWin();const o=this.position.createMoveBySFEN(t);if(!o)return n.onError("エンジンから不明な指し手を受信しました:"+t),void n.onResign();if(this.ponder=i&&`${e} ${t} ${i}`,this.flushUSIInfo(),this.info&&this.info.pv&&this.info.pv.length>=1&&this.info.pv[0].equals(o)){const e={...this.info,pv:this.info.pv.slice(1)};n.onMove(o,e)}else n.onMove(o)}onUSIInfo(e,t){if(e!==this.usi||!this.position)return;if(t.multipv&&1!==t.multipv)return;const i=this.position.color===Z.BLACK?1:-1,n=t.pv&&t.pv.length>=1?t.pv:t.currmove?[t.currmove]:void 0,o={usi:e,score:t.scoreCP&&t.scoreCP*i,mate:t.scoreMate&&t.scoreMate*i,pv:n&&Hn(this.position,n)};this.updateUSIInfo(o)}updateUSIInfo(e){this.info=e,this.usiInfoTimeout||(this.usiInfoTimeout=window.setTimeout((()=>{this.flushUSIInfo()}),500))}flushUSIInfo(){this.usiInfoTimeout&&(clearTimeout(this.usiInfoTimeout),this.usiInfoTimeout=void 0),this.onSearchInfo&&this.info&&this.onSearchInfo(this.info)}}const Un={};function Fn(e,t,i,n){const o=Un[e];o&&o.onBestMove(t,i,n)}function Kn(e,t,i){const n=Un[e];n&&n.onUSIInfo(t,i)}class qn{constructor(e,t,i,n){if((0,Y.Z)(this,"recordManager",void 0),(0,Y.Z)(this,"_setting",void 0),(0,Y.Z)(this,"appSetting",void 0),(0,Y.Z)(this,"handler",void 0),(0,Y.Z)(this,"researcher",void 0),(0,Y.Z)(this,"number",void 0),(0,Y.Z)(this,"actualMove",void 0),(0,Y.Z)(this,"color",Z.BLACK),(0,Y.Z)(this,"lastSearchInfo",void 0),(0,Y.Z)(this,"searchInfo",void 0),(0,Y.Z)(this,"timerHandle",void 0),this.recordManager=e,this._setting=t,this.appSetting=i,this.handler=n,!t.usi)throw new Error("エンジンが設定されていません。")}get setting(){return this._setting}async start(){await this.setupEngine(this.setting.usi),setTimeout((()=>this.next()))}close(){this.clearTimer(),this.closeEngine().catch((e=>{this.handler.onError(e)}))}async setupEngine(e){await this.closeEngine();const t=new Wn(e,this.updateSearchInfo.bind(this));await t.launch(),this.researcher=t}next(){if(!this.researcher)return this.handler.onError(new Error("エンジンが初期化されていません。")),void this.finish();if(this.clearTimer(),this.actualMove=void 0,this.lastSearchInfo=this.searchInfo,this.searchInfo=void 0,this.number=void 0!==this.number?this.number+1:this.setting.startCriteria.enableNumber?this.setting.startCriteria.number-1:0,this.setting.endCriteria.enableNumber&&this.number>=this.setting.endCriteria.number)return void this.finish();this.recordManager.changeMoveNumber(this.number);const e=this.recordManager.record;e.current.number===this.number&&(e.current.next||e.current.move instanceof Pe)?(this.actualMove=e.current.move instanceof Pe?e.current.move:void 0,this.color=$(e.position.color),this.timerHandle=window.setTimeout((()=>{this.onResult(),this.next()}),1e3*this.setting.perMoveCriteria.maxSeconds),this.researcher.startResearch(e).catch((e=>{this.handler.onError(e)}))):this.finish()}finish(){this.handler.onFinish(),this.close()}clearTimer(){this.timerHandle&&(clearTimeout(this.timerHandle),this.timerHandle=void 0)}onResult(){if(!this.searchInfo||!this.lastSearchInfo)return;const e=this.color===Z.BLACK?1:-1,t=void 0!==this.searchInfo.score?this.searchInfo.score*e:void 0,i=void 0!==this.searchInfo.score&&void 0!==this.lastSearchInfo.score?(this.searchInfo.score-this.lastSearchInfo.score)*e:void 0,n=this.actualMove&&this.lastSearchInfo.pv?this.actualMove.equals(this.lastSearchInfo.pv[0]):void 0;let o="";if(void 0!==i&&void 0!==t&&!n){const e=jn(t-i,t,this.appSetting);e&&(o+=`【${e}】\n`)}o+=nn(Wi.RESEARCHER,this.searchInfo),this.recordManager.appendComment(o,this.setting.commentBehavior)}async closeEngine(){this.researcher&&(this.researcher.close(),this.researcher=void 0)}updateSearchInfo(e){this.recordManager.updateSearchInfo(Wi.RESEARCHER,e),this.searchInfo=e}}function jn(e,t,i){const n=$i(e,i.coefficientInSigmoid)-$i(t,i.coefficientInSigmoid);return n>=i.badMoveLevelThreshold4?"大悪手":n>=i.badMoveLevelThreshold3?"悪手":n>=i.badMoveLevelThreshold2?"疑問手":n>=i.badMoveLevelThreshold1?"緩手":null}function Vn(){return{id:"",myColor:Z.BLACK,toMove:Z.BLACK,position:"",timeUnitMs:1e3,totalTime:0,byoyomi:0,delay:0,increment:0}}var Zn,zn;function Yn(){return{host:"localhost",port:4081,id:"",password:""}}function $n(){return{player:{name:"人",uri:Ai},server:Yn(),autoFlip:!0,enableComment:!0,enableAutoSave:!0,repeat:1}}function Jn(e){return""===e.server.host?new Error("ホスト名が空です。"):e.server.port<0||e.server.port>65535?new Error("無効なポート番号です。"):""===e.server.id?new Error("IDが空です。"):void 0}function Xn(){return{player:{name:"人",uri:Ai},serverHistory:[],autoFlip:!0,enableComment:!0,enableAutoSave:!0,repeat:1}}function Qn(e,t){return{player:e.player,server:e.serverHistory?.length>t?e.serverHistory[t]:Yn(),autoFlip:e.autoFlip,enableComment:e.enableComment,enableAutoSave:e.enableAutoSave,repeat:e.repeat}}(function(e){e["UNKNOWN"]="unknown",e["RESIGN"]="resign",e["SENNICHITE"]="sennichite",e["OUTE_SENNICHITE"]="oute_sennichite",e["ILLEGAL_MOVE"]="illegal_move",e["ILLEGAL_ACTION"]="illegal_action",e["TIME_UP"]="time_up",e["JISHOGI"]="jishogi",e["MAX_MOVES"]="max_moves"})(Zn||(Zn={})),function(e){e["WIN"]="win",e["LOSE"]="lose",e["DRAW"]="draw",e["CENSORED"]="censored",e["CHUDAN"]="chudan"}(zn||(zn={}));const eo=10;function to(e,t){const i=[t.server];for(const n of e.serverHistory)if(n.host===t.server.host&&n.port===t.server.port&&n.id===t.server.id&&n.password===t.server.password||i.push(n),i.length===eo)break;return{player:t.player,serverHistory:i,autoFlip:t.autoFlip,enableComment:t.enableComment,enableAutoSave:t.enableAutoSave,repeat:t.repeat}}var io;(function(e){e[e["OFFLINE"]=0]="OFFLINE",e[e["WAITING_LOGIN"]=1]="WAITING_LOGIN",e[e["READY"]=2]="READY",e[e["GAME"]=3]="GAME"})(io||(io={}));class no{constructor(e,t,i,n,o){(0,Y.Z)(this,"recordManager",void 0),(0,Y.Z)(this,"blackClock",void 0),(0,Y.Z)(this,"whiteClock",void 0),(0,Y.Z)(this,"playerBuilder",void 0),(0,Y.Z)(this,"handlers",void 0),(0,Y.Z)(this,"_state",io.OFFLINE),(0,Y.Z)(this,"_setting",$n()),(0,Y.Z)(this,"sessionID",0),(0,Y.Z)(this,"repeat",0),(0,Y.Z)(this,"player",void 0),(0,Y.Z)(this,"gameSummary",Vn()),(0,Y.Z)(this,"searchInfo",void 0),this.recordManager=e,this.blackClock=t,this.whiteClock=i,this.playerBuilder=n,this.handlers=o}get state(){return this._state}get setting(){return this._setting}get isMyTurn(){const e=this.recordManager.record.position.color;return e===this.gameSummary.myColor}login(e){if(this.sessionID)throw new Error("CSAGameManager#start: session already exists");return this._setting=e,this.repeat=0,this.relogin()}async relogin(){this.repeat++,this._state=io.WAITING_LOGIN;try{this.player=await this.playerBuilder.build(this._setting.player,(e=>this.recordManager.updateEnemySearchInfo(e))),this.sessionID=await vn.csaLogin(this._setting.server),this._state=io.READY,oo[this.sessionID]=this,this.handlers.onGameNext()}catch(e){throw this.close(!0),e}}stop(){this.sessionID&&(vn.csaStop(this.sessionID),this.close(!0))}logout(){this.close(!0)}close(e){this._state!==io.OFFLINE&&(this.sessionID&&(delete oo[this.sessionID],vn.csaLogout(this.sessionID).catch((e=>{this.handlers.onError(e)})),this.sessionID=0),this.player&&(this.player.close().catch((e=>{this.handlers.onError(e)})),this.player=void 0),this.blackClock.stop(),this.whiteClock.stop(),this._state=io.OFFLINE,e||this.repeat>=this.setting.repeat?this.handlers.onGameEnd():this.relogin().catch((e=>{this.handlers.onError(e)})))}onGameSummary(e){this.gameSummary=e,vn.csaAgree(this.sessionID,this.gameSummary.id)}onReject(){this.close()}onStart(e){this.recordManager.importRecord(this.gameSummary.position,oi.CSA),this.recordManager.setGameStartMetadata({gameTitle:this.gameSummary.id,blackName:this.gameSummary.blackPlayerName,whiteName:this.gameSummary.whitePlayerName,timeLimit:{timeSeconds:this.gameSummary.totalTime*this.gameSummary.timeUnitMs/1e3,byoyomi:this.gameSummary.byoyomi*this.gameSummary.timeUnitMs/1e3,increment:this.gameSummary.increment*this.gameSummary.timeUnitMs/1e3}}),this.setting.autoFlip&&this.handlers.onFlipBoard&&this.handlers.onFlipBoard(this.gameSummary.myColor===Z.WHITE),this._state=io.GAME,this.next(e)}onMove(e,t){const i=this.isMyTurn,n=Zt(this.recordManager.record.position,e);if(n instanceof Error)return void this.handlers.onError(`解釈できない指し手 [${e}]: ${n.message}`);const o=/^.*,T([0-9]+)$/.exec(e),a=o?Number(parseInt(o[1]))*this.gameSummary.timeUnitMs:0;if(this.recordManager.appendMove({move:n,moveOption:{ignoreValidation:!0},elapsedMs:a}),i&&this.searchInfo&&this.recordManager.updateSearchInfo(Wi.PLAYER,this.searchInfo),i&&this.searchInfo&&this.setting.enableComment){const e=nn(Wi.PLAYER,this.searchInfo);this.recordManager.appendComment(e,Ui.APPEND)}this.handlers.onPieceBeat(),this.next(t)}async onGameResult(e,t){if(e===Zn.RESIGN)this.recordManager.appendMove({move:je.RESIGN});else if(e===Zn.JISHOGI)this.recordManager.appendMove({move:je.ENTERING_OF_KING});else if(e===Zn.ILLEGAL_MOVE){const e=this.recordManager.record.position.color;t===zn.WIN?this.recordManager.appendMove({move:e===this.gameSummary.myColor?je.FOUL_WIN:je.FOUL_LOSE}):t===zn.LOSE&&this.recordManager.appendMove({move:e===this.gameSummary.myColor?je.FOUL_LOSE:je.FOUL_WIN})}else e===Zn.TIME_UP?this.recordManager.appendMove({move:je.TIMEOUT}):t===zn.DRAW?this.recordManager.appendMove({move:je.DRAW}):t!==zn.CHUDAN&&t!==zn.CENSORED||this.recordManager.appendMove({move:je.INTERRUPT});this.setting.enableAutoSave&&await this.handlers.onSaveRecord(),this.close()}async onClose(){this.close(!0)}next(e){this.blackClock.stop(),this.whiteClock.stop();const t={byoyomi:this.gameSummary.byoyomi*this.gameSummary.timeUnitMs/1e3,onBeepShort:()=>this.handlers.onBeepShort(),onBeepUnlimited:()=>this.handlers.onBeepUnlimited(),onStopBeep:()=>this.handlers.onStopBeep()};this.blackClock.setup({...t,timeMs:e.black.time*this.gameSummary.timeUnitMs}),this.whiteClock.setup({...t,timeMs:e.white.time*this.gameSummary.timeUnitMs});const i=this.recordManager.record.position.color;if(i===Z.BLACK?this.blackClock.start():this.whiteClock.start(),!this.player)return void this.handlers.onError("想定されない問題が発生しました。CSA サーバーからデータを受信しましたが、プレイヤーが初期化されていません。");const n={timeSeconds:this.gameSummary.totalTime*this.gameSummary.timeUnitMs/1e3,byoyomi:this.gameSummary.byoyomi*this.gameSummary.timeUnitMs/1e3,increment:this.gameSummary.increment*this.gameSummary.timeUnitMs/1e3};i===this.gameSummary.myColor?this.player.startSearch(this.recordManager.record,n,e.black.time*this.gameSummary.timeUnitMs,e.white.time*this.gameSummary.timeUnitMs,{onMove:(e,t)=>{this.searchInfo=t,vn.csaMove(this.sessionID,ii(e))},onResign:()=>{vn.csaResign(this.sessionID)},onWin:()=>{vn.csaWin(this.sessionID)},onError:e=>{this.handlers.onError(e)}}).catch((e=>{this.handlers.onError(new Error("CSAGameManager#next: プレイヤーにコマンドを送信できませんでした: "+e))})):this.player.startPonder(this.recordManager.record,n,this.blackClock.timeMs,this.whiteClock.timeMs).catch((e=>{this.handlers.onError(new Error("CSAGameManager#next: プレイヤーにPonderコマンドを送信できませんでした: "+e))}))}}const oo={};function ao(e,t){const i=oo[e];i&&i.onGameSummary(t)}function so(e){const t=oo[e];t&&t.onReject()}function ro(e,t){const i=oo[e];i&&i.onStart(t)}function lo(e,t,i){const n=oo[e];n&&n.onMove(t,i)}function co(e,t,i){const n=oo[e];n&&n.onGameResult(t,i)}function ho(e){const t=oo[e];t&&t.onClose()}class uo{constructor(){(0,Y.Z)(this,"setting",{timeMs:0,byoyomi:0,increment:0}),(0,Y.Z)(this,"_timeMs",0),(0,Y.Z)(this,"_byoyomi",0),(0,Y.Z)(this,"_elapsedMs",0),(0,Y.Z)(this,"timerHandle",0),(0,Y.Z)(this,"timerStart",0),(0,Y.Z)(this,"lastTimeMs",0)}setup(e){this.setting=e,this._timeMs=e.timeMs||0,this._byoyomi=e.byoyomi||0,this._elapsedMs=0}get time(){return Math.ceil(this._timeMs/1e3)}get timeMs(){return this._timeMs}get byoyomi(){return this._byoyomi}get elapsedMs(){return this._elapsedMs}start(){this.clearTimer(),this.timerStart=Date.now(),this.lastTimeMs=this._timeMs,this._byoyomi=this.setting.byoyomi||0,this._elapsedMs=0,this.timerHandle=window.setInterval((()=>{const e=this.timeMs,t=this.byoyomi;this._elapsedMs=Date.now()-this.timerStart;const i=this.lastTimeMs-this._elapsedMs;i>=0?this._timeMs=i:(this._timeMs=0,this._byoyomi=Math.max(Math.ceil((this.setting.byoyomi||0)+i/1e3),0)),0!==this.timeMs||0!==this.byoyomi?this.fireBeep(e,t):this.timeout()}),100)}fireBeep(e,t){let i=Math.ceil(this.timeMs/1e3),n=Math.ceil(e/1e3);0!==i&&0!==this.byoyomi||(0!==i||0===n?(0!==this.byoyomi&&(i=this.byoyomi,n=t),i!==n&&(i<=5?this.setting.onBeepUnlimited&&this.setting.onBeepUnlimited():(i<=10||20===i||30===i||60===i)&&this.setting.onBeepShort&&this.setting.onBeepShort())):this.setting.onBeepShort&&this.setting.onBeepShort())}pause(){this.clearTimer()}stop(){this.clearTimer(),this.incrementTime()}timeout(){this.clearTimer(),this.setting.onTimeout&&this.setting.onTimeout()}clearTimer(){this.timerHandle&&(window.clearInterval(this.timerHandle),this.timerHandle=0),this.setting.onStopBeep&&this.setting.onStopBeep()}incrementTime(){this._timeMs+=1e3*(this.setting.increment||0)}}class po{constructor(){(0,Y.Z)(this,"searchHandler",void 0)}isEngine(){return!1}async startSearch(e,t,i,n,o){this.searchHandler=o}async startPonder(){}async stop(){}async gameover(){}async close(){this.searchHandler=void 0}doMove(e){const t=this.searchHandler;this.searchHandler=void 0,t&&t.onMove(e)}resign(){const e=this.searchHandler;this.searchHandler=void 0,e&&e.onResign()}win(){const e=this.searchHandler;this.searchHandler=void 0,e&&e.onWin()}}const go=new po,mo={async build(e,t){if(e.uri===Ai)return go;if(Ni(e.uri)&&e.usi){const i=new Wn(e.usi,t);return await i.launch(),i}throw new Error("defaultPlayerBuilder#build: 予期せぬプレイヤーURIです: "+e.uri)}};class _o{constructor(){(0,Y.Z)(this,"_bussy",new Mn),(0,Y.Z)(this,"_message",new Bn),(0,Y.Z)(this,"_error",new xn),(0,Y.Z)(this,"recordManager",new an),(0,Y.Z)(this,"_appSetting",rn()),(0,Y.Z)(this,"_appState",Nn.NORMAL),(0,Y.Z)(this,"lastAppState",void 0),(0,Y.Z)(this,"_isAppSettingDialogVisible",!1),(0,Y.Z)(this,"_confirmation",void 0),(0,Y.Z)(this,"usiMonitor",new Gn),(0,Y.Z)(this,"blackClock",new uo),(0,Y.Z)(this,"whiteClock",new uo),(0,Y.Z)(this,"gameManager",new kn(this.recordManager,this.blackClock,this.whiteClock,mo,this)),(0,Y.Z)(this,"csaGameManager",new no(this.recordManager,this.blackClock,this.whiteClock,mo,this)),(0,Y.Z)(this,"researcher",void 0),(0,Y.Z)(this,"analysisManager",void 0),(0,Y.Z)(this,"unlimitedBeepHandler",void 0),this.recordManager.on("changePosition",(()=>{this.onUpdatePosition()}))}get isBussy(){return this._bussy.isBussy}retainBussyState(){return this._bussy.retain()}releaseBussyState(){return this._bussy.release()}get message(){return this._message.message}get hasMessage(){return this._message.hasMessage}enqueueMessage(e){this._message.enqueue(e)}dequeueMessage(){this._message.dequeue()}get errors(){return this._error.errors}get hasError(){return this._error.hasError}pushError(e){vn.log(ji.ERROR,nt(e)),this._error.push(e)}clearErrors(){this._error.clear()}get record(){return this.recordManager.record}get recordFilePath(){return this.recordManager.recordFilePath}updateStandardRecordMetadata(e){this.recordManager.updateStandardMetadata(e)}get appSetting(){return this._appSetting}async updateAppSetting(e){const t={...this.appSetting,...e},i=ln(t);if(i)throw i;await vn.saveAppSetting(t),this._appSetting=t}flipBoard(){this._appSetting.boardFlipping=!this.appSetting.boardFlipping,vn.saveAppSetting(this.appSetting)}get appState(){return this._appState}get confirmation(){return this._confirmation?.message}showConfirmation(e){if(this.appState==Nn.TEMPORARY)return vn.log(ji.ERROR,`Store#showConfirmation: 確認ダイアログを多重に表示しようとしました。 lastAppState=${this.lastAppState}`+(this._confirmation?` currentMessage=${this._confirmation.message}`:"")+` newMessage=${e.message}`),void(e.onCancel&&e.onCancel());this._confirmation=e,this.lastAppState=this.appState,this._appState=Nn.TEMPORARY}confirmationOk(){const e=this._confirmation?.onOk;this._confirmation=void 0,this.lastAppState&&(this._appState=this.lastAppState,this.lastAppState=void 0),e&&e()}confirmationCancel(){const e=this._confirmation?.onCancel;this._confirmation=void 0,this.lastAppState&&(this._appState=this.lastAppState,this.lastAppState=void 0),e&&e()}showPasteDialog(){this.appState===Nn.NORMAL&&(this._appState=Nn.PASTE_DIALOG)}showGameDialog(){this.appState===Nn.NORMAL&&(this._appState=Nn.GAME_DIALOG)}showCSAGameDialog(){this.appState===Nn.NORMAL&&(this._appState=Nn.CSA_GAME_DIALOG)}showResearchDialog(){this.appState===Nn.NORMAL&&(this._appState=Nn.RESEARCH_DIALOG)}showAnalysisDialog(){this.appState===Nn.NORMAL&&(this._appState=Nn.ANALYSIS_DIALOG)}showUsiEngineManagementDialog(){this.appState===Nn.NORMAL&&(this._appState=Nn.USI_ENGINE_SETTING_DIALOG)}closeModalDialog(){this.appState!==Nn.PASTE_DIALOG&&this.appState!==Nn.GAME_DIALOG&&this.appState!==Nn.CSA_GAME_DIALOG&&this.appState!==Nn.RESEARCH_DIALOG&&this.appState!==Nn.ANALYSIS_DIALOG&&this.appState!==Nn.USI_ENGINE_SETTING_DIALOG||(this._appState=Nn.NORMAL)}get isAppSettingDialogVisible(){return this._isAppSettingDialogVisible}showAppSettingDialog(){this._isAppSettingDialogVisible=!0}closeAppSettingDialog(){this._isAppSettingDialogVisible=!1}get usiBlackPlayerMonitor(){return this.usiMonitor.blackPlayer}get usiWhitePlayerMonitor(){return this.usiMonitor.whitePlayer}get usiResearcherMonitor(){return this.usiMonitor.researcher}updateUSIInfo(e,t,i,n,o){this.recordManager.record.usi===t&&this.usiMonitor.update(e,this.recordManager.record.position,i,n,o)}updateUSIPonderInfo(e,t,i,n,o){const a=tt.newByUSI(t);if(a instanceof Error)return void vn.log(ji.ERROR,`invalid USI: ${t} (updateUSIPonderInfo)`);const s=a.current.move;s instanceof Pe&&this.usiMonitor.update(e,a.position,i,n,o,s)}get blackTime(){return this.blackClock.time}get blackByoyomi(){return this.blackClock.byoyomi}get whiteTime(){return this.whiteClock.time}get whiteByoyomi(){return this.whiteClock.byoyomi}startGame(e){this.appState===Nn.GAME_DIALOG&&(this.retainBussyState(),vn.saveGameSetting(e).then((()=>(this.initializeDisplaySettingForGame(e),this.gameManager.startGame(e)))).then((()=>this._appState=Nn.GAME)).catch((e=>{this.pushError("対局の初期化中にエラーが出ました: "+e)})).finally((()=>{this.releaseBussyState()})))}get csaGameState(){return this.csaGameManager.state}loginCSAGame(e,t){this.appState===Nn.CSA_GAME_DIALOG&&(this.retainBussyState(),Promise.resolve().then((async()=>{if(t.saveHistory){const t=await vn.loadCSAGameSettingHistory(),i=to(t,e);await vn.saveCSAGameSettingHistory(i)}})).then((()=>this.csaGameManager.login(e))).then((()=>this._appState=Nn.CSA_GAME)).catch((e=>{this.pushError("対局の初期化中にエラーが出ました: "+e)})).finally((()=>{this.releaseBussyState()})))}logoutCSAGame(){this.appState===Nn.CSA_GAME&&(this.csaGameManager.state!==io.GAME?(this.csaGameManager.logout(),this._appState=Nn.NORMAL):this.pushError("ログアウトするには対局を終了してください。"))}initializeDisplaySettingForGame(e){if(e.humanIsFront){let t=this.appSetting.boardFlipping;e.black.uri===Ai&&e.white.uri!==Ai?t=!1:e.black.uri!==Ai&&e.white.uri===Ai&&(t=!0),t!==this.appSetting.boardFlipping&&this.flipBoard()}}stopGame(){this.appState===Nn.GAME?this.gameManager.endGame(je.INTERRUPT):this.appState===Nn.CSA_GAME&&this.showConfirmation({message:"中断を要求すると負けになる可能性があります。よろしいですか？",onOk:()=>{this.csaGameManager.stop()}})}onGameNext(){this.usiMonitor.clear()}onGameEnd(e,t){if(this.appState===Nn.GAME||this.appState===Nn.CSA_GAME){if(e&&e.total>=2){const t=e.total-e.invalid;this.enqueueMessage({text:"連続対局終了",attachments:[{type:"list",items:[{text:e.player1.name,children:[`勝ち数: ${e.player1.win}`,`勝率: ${ot(e.player1.win,t,1)}`]},{text:e.player2.name,children:[`勝ち数: ${e.player2.win}`,`勝率: ${ot(e.player2.win,t,1)}`]},{text:`引き分け: ${e.draw}`},{text:`有効対局数: ${t}`},{text:`無効対局数: ${e.invalid}`}]}]})}else t&&this.enqueueMessage({text:`対局終了（${Qe(t)})`});this._appState=Nn.NORMAL}}onFlipBoard(e){this._appSetting.boardFlipping!==e&&this.flipBoard()}onSaveRecord(){const e=Cn(this.recordManager.record.metadata),t=`${this.appSetting.autoSaveDirectory}/${e}`;return this.saveRecordByPath(t)}onPieceBeat(){wn(this.appSetting.pieceVolume)}onBeepShort(){(this.appSetting.clockSoundTarget!==qi.ONLY_USER||this.isMovableByUser)&&(this.unlimitedBeepHandler||fn({frequency:this.appSetting.clockPitch,volume:this.appSetting.clockVolume}))}onBeepUnlimited(){(this.appSetting.clockSoundTarget!==qi.ONLY_USER||this.isMovableByUser)&&(this.unlimitedBeepHandler||(this.unlimitedBeepHandler=In({frequency:this.appSetting.clockPitch,volume:this.appSetting.clockVolume})))}onStopBeep(){this.unlimitedBeepHandler&&(this.unlimitedBeepHandler.stop(),this.unlimitedBeepHandler=void 0)}doMove(e){this.appState!==Nn.NORMAL&&this.appState!==Nn.RESEARCH||this.recordManager.appendMove({move:e})&&wn(this.appSetting.pieceVolume)}onFinish(){this.appState===Nn.ANALYSIS&&(this._message.enqueue({text:"棋譜解析が終了しました。"}),this._appState=Nn.NORMAL)}onError(e){this.pushError(e)}startResearch(e){if(this.appState!==Nn.RESEARCH_DIALOG)return;if(this.retainBussyState(),!e.usi)return void this.pushError(new Error("エンジンが設定されていません。"));const t=e.usi;vn.saveResearchSetting(e).then((()=>(this.researcher=new Wn(t,(e=>{this.recordManager.updateSearchInfo(Wi.RESEARCHER,e)})),this.researcher.launch()))).then((()=>{this._appState=Nn.RESEARCH,this.onUpdatePosition()})).catch((e=>{this.researcher=void 0,this.pushError("検討の初期化中にエラーが出ました: "+e)})).finally((()=>{this.releaseBussyState()}))}stopResearch(){this.appState===Nn.RESEARCH&&(this.researcher&&(this.researcher.close(),this.researcher=void 0),this._appState=Nn.NORMAL)}startAnalysis(e){this.appState===Nn.ANALYSIS_DIALOG&&(this.retainBussyState(),vn.saveAnalysisSetting(e).then((()=>(this.analysisManager=new qn(this.recordManager,e,this.appSetting,this),this.analysisManager.start()))).then((()=>{this._appState=Nn.ANALYSIS})).catch((e=>{this.analysisManager=void 0,this.pushError("検討の初期化中にエラーが出ました: "+e)})).finally((()=>{this.releaseBussyState()})))}stopAnalysis(){this.appState===Nn.ANALYSIS&&(this.analysisManager&&(this.analysisManager.close(),this.analysisManager=void 0),this._appState=Nn.NORMAL)}onUpdatePosition(){this.researcher&&this.researcher.startResearch(this.recordManager.record)}resetRecord(){this.appState==Nn.NORMAL&&this.showConfirmation({message:"現在の棋譜は削除されます。よろしいですか？",onOk:()=>{this.recordManager.reset()}})}updateRecordComment(e){this.recordManager.updateComment(e)}insertSpecialMove(e){this.appState!==Nn.NORMAL&&this.appState!==Nn.RESEARCH||this.recordManager.appendMove({move:e})}startPositionEditing(){this.appState===Nn.NORMAL&&this.showConfirmation({message:"現在の棋譜は削除されます。よろしいですか？",onOk:()=>{this._appState=Nn.POSITION_EDITING,this.recordManager.resetByCurrentPosition()}})}endPositionEditing(){this.appState===Nn.POSITION_EDITING&&(this._appState=Nn.NORMAL)}initializePosition(e){this.appState==Nn.POSITION_EDITING&&this.showConfirmation({message:"現在の局面は破棄されます。よろしいですか？",onOk:()=>{this.recordManager.reset(e)}})}changeTurn(){this.appState==Nn.POSITION_EDITING&&this.recordManager.swapNextTurn()}editPosition(e){this.appState===Nn.POSITION_EDITING&&this.recordManager.changePosition(e)}changeMoveNumber(e){this.appState!==Nn.NORMAL&&this.appState!==Nn.RESEARCH||this.recordManager.changeMoveNumber(e)}changeBranch(e){this.appState!==Nn.NORMAL&&this.appState!==Nn.RESEARCH||this.recordManager.changeBranch(e)}removeCurrentMove(){this.appState!==Nn.NORMAL&&this.appState!==Nn.RESEARCH||(this.recordManager.record.current.isLastMove?this.recordManager.removeCurrentMove():this.showConfirmation({message:`${this.recordManager.record.current.number}手目以降を削除します。よろしいですか？`,onOk:()=>{this.recordManager.removeCurrentMove()}}))}copyRecordKIF(){const e=Lt(this.recordManager.record,{returnCode:this.appSetting.returnCode});navigator.clipboard.writeText(e)}copyRecordCSA(){const e=ni(this.recordManager.record,{returnCode:this.appSetting.returnCode});navigator.clipboard.writeText(e)}copyRecordUSIBefore(){const e=this.recordManager.record.usi;navigator.clipboard.writeText(e)}copyRecordUSIAll(){const e=this.recordManager.record.usiAll;navigator.clipboard.writeText(e)}copyBoardSFEN(){const e=this.recordManager.record.sfen;navigator.clipboard.writeText(e)}pasteRecord(e){if(this.appState!==Nn.NORMAL)return;const t=this.recordManager.importRecord(e);t&&this.pushError(t)}openRecord(e){this.appState===Nn.NORMAL&&(this.retainBussyState(),Promise.resolve().then((()=>e||vn.showOpenRecordDialog())).then((e=>{if(e)return vn.openRecord(e).then((t=>{const i=this.recordManager.importRecordFromBuffer(t,e);return i&&Promise.reject(i)}))})).catch((e=>{this.pushError("棋譜の読み込み中にエラーが出ました: "+e)})).finally((()=>{this.releaseBussyState()})))}saveRecord(e){this.appState===Nn.NORMAL&&(this.retainBussyState(),Promise.resolve().then((()=>{const t=this.recordManager.recordFilePath;if(e?.overwrite&&t)return t;const i=Cn(this.recordManager.record.metadata);return vn.showSaveRecordDialog(i)})).then((e=>{if(e)return this.saveRecordByPath(e)})).catch((e=>{this.pushError(e)})).finally((()=>{this.releaseBussyState()})))}async saveRecordByPath(e){const t=this.recordManager.exportRecordAsBuffer(e,{returnCode:this.appSetting.returnCode});if(t instanceof Error)throw t;this.retainBussyState();try{await vn.saveRecord(e,t)}catch(i){throw new Error(`棋譜の保存に失敗しました: ${i}`)}finally{this.releaseBussyState()}}get isMovableByUser(){switch(this.appState){case Nn.NORMAL:case Nn.RESEARCH:return!0;case Nn.GAME:return(this.recordManager.record.position.color===Z.BLACK?this.gameManager.setting.black.uri:this.gameManager.setting.white.uri)===Ai;case Nn.CSA_GAME:return this.csaGameManager.isMyTurn&&this.csaGameManager.setting.player.uri===Ai}return!1}}const vo=(0,h.qj)(new _o);function So(){return vo}const Eo=["src"];function fo(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("img",{class:"icon",src:e.source,draggable:"false"},null,8,Eo)}var Io;(function(e){e["BUSSY"]="bussy",e["ERROR"]="error",e["INFO"]="info",e["GAME"]="game",e["INTERNET"]="internet",e["STOP"]="stop",e["RESIGN"]="resign",e["RESEARCH"]="research",e["END"]="end",e["QUIZ"]="quiz",e["EDIT"]="edit",e["CHECK"]="check",e["SWAP"]="swap",e["SWAP_H"]="swap_h",e["SETTINGS"]="settings",e["ENGINE_SETTINGS"]="engineSettings",e["FLIP"]="flip",e["FILE"]="file",e["OPEN"]="open",e["SAVE"]="save",e["SAVE_AS"]="saveAs",e["PASTE"]="paste",e["COPY"]="copy",e["DELETE"]="delete",e["COMMENT"]="comment",e["BRAIN"]="brain",e["PV"]="pv",e["CHART"]="chart",e["PERCENT"]="percent",e["ARROW_DROP"]="arrowDrop",e["FIRST"]="first",e["BACK"]="back",e["NEXT"]="next",e["LAST"]="last",e["QUESTION"]="question",e["ANALYSIS"]="analysis",e["DESCRIPTION"]="description",e["PLAY"]="play",e["CLOSE"]="close",e["CALL"]="call"})(Io||(Io={}));const yo={[Io.BUSSY]:"icon/hourglass_empty_white_24dp.svg",[Io.ERROR]:"icon/error_outline_white_24dp.svg",[Io.INFO]:"icon/info_white_24dp.svg",[Io.GAME]:"icon/sports_esports_white_24dp.svg",[Io.INTERNET]:"icon/language_FILL0_wght400_GRAD0_opsz48.svg",[Io.STOP]:"icon/block_white_24dp.svg",[Io.RESIGN]:"icon/flag_white_24dp.svg",[Io.RESEARCH]:"icon/science_white_24dp.svg",[Io.END]:"icon/do_disturb_on_white_24dp.svg",[Io.QUIZ]:"icon/quiz_FILL0_wght400_GRAD0_opsz48.svg",[Io.EDIT]:"icon/app_registration_white_24dp.svg",[Io.CHECK]:"icon/check_circle_white_24dp.svg",[Io.SWAP]:"icon/swap_vert_white_24dp.svg",[Io.SWAP_H]:"icon/swap_horiz_white_24dp.svg",[Io.SETTINGS]:"icon/settings_white_24dp.svg",[Io.ENGINE_SETTINGS]:"icon/settings_input_component_white_24dp.svg",[Io.FLIP]:"icon/flip_camera_android_white_24dp.svg",[Io.FILE]:"icon/draft_FILL0_wght400_GRAD0_opsz48.svg",[Io.OPEN]:"icon/file_open_FILL0_wght400_GRAD0_opsz48.svg",[Io.SAVE]:"icon/save_FILL0_wght400_GRAD0_opsz48.svg",[Io.SAVE_AS]:"icon/save_as_FILL0_wght400_GRAD0_opsz48.svg",[Io.PASTE]:"icon/content_paste_white_24dp.svg",[Io.COPY]:"icon/content_copy_white_24dp.svg",[Io.DELETE]:"icon/backspace_white_24dp.svg",[Io.COMMENT]:"icon/edit_note_white_24dp.svg",[Io.BRAIN]:"icon/psychology_white_24dp.svg",[Io.PV]:"icon/manage_search_FILL0_wght400_GRAD0_opsz48.svg",[Io.CHART]:"icon/show_chart_white_24dp.svg",[Io.PERCENT]:"icon/percent_white_24dp.svg",[Io.ARROW_DROP]:"icon/arrow_drop_down_white_24dp.svg",[Io.FIRST]:"icon/first_page_white_24dp.svg",[Io.BACK]:"icon/chevron_left_white_24dp.svg",[Io.NEXT]:"icon/chevron_right_white_24dp.svg",[Io.LAST]:"icon/last_page_white_24dp.svg",[Io.QUESTION]:"icon/help_white_24dp.svg",[Io.ANALYSIS]:"icon/query_stats_white_24dp.svg",[Io.DESCRIPTION]:"icon/description_white_24dp.svg",[Io.PLAY]:"icon/play_arrow_FILL1_wght400_GRAD0_opsz48.svg",[Io.CLOSE]:"icon/close_FILL0_wght400_GRAD0_opsz48.svg",[Io.CALL]:"icon/record_voice_over_FILL0_wght400_GRAD0_opsz48.svg"};Object.values(yo).forEach((e=>{ri(e)}));var wo=(0,o.aZ)({name:"ButtonIcon",props:{icon:{type:String,required:!0}},setup(e){return{source:yo[e.icon]}}});const bo=(0,yi.Z)(wo,[["render",fo]]);var Ao=bo;const To={ref:"dialog",class:"menu"},No={class:"groups"},Ro={class:"group"},ko=(0,o._)("div",{class:"label"},"戻る",-1),Po={class:"group"},Co=(0,o._)("div",{class:"label"},"ローカル対局",-1),Oo=(0,o._)("div",{class:"label"},"通信対局（CSA）",-1);function Mo(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",To,[(0,o._)("div",No,[(0,o._)("div",Ro,[(0,o._)("button",{class:"close",onClick:t[0]||(t[0]=(...t)=>e.onClose&&e.onClose(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"]),ko])]),(0,o._)("div",Po,[(0,o._)("button",{onClick:t[1]||(t[1]=(...t)=>e.onLocalGame&&e.onLocalGame(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Co]),(0,o._)("button",{onClick:t[2]||(t[2]=(...t)=>e.onCSAGame&&e.onCSAGame(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.INTERNET},null,8,["icon"]),Oo])])])],512)])}function Ho(e,t){e.addEventListener("cancel",(e=>{e.preventDefault(),e.stopPropagation(),t&&t()})),e.addEventListener("copy",(e=>{e.stopPropagation()})),e.addEventListener("paste",(e=>{e.stopPropagation()})),e.showModal()}function Lo(e){return document.getElementById(e)}var Do=(0,o.aZ)({name:"GameMenu",components:{ButtonIcon:Ao},emits:["close"],setup(e,t){const i=So(),n=(0,h.iH)(null),a=()=>{t.emit("close")};(0,o.bv)((()=>{Ho(n.value,a)}));const s=()=>{i.showGameDialog(),t.emit("close")},r=()=>{i.showCSAGameDialog(),t.emit("close")};return{dialog:n,Icon:Io,onClose:a,onLocalGame:s,onCSAGame:r}}});const Go=(0,yi.Z)(Do,[["render",Mo]]);var Bo=Go;const xo={ref:"dialog",class:"menu"},Wo={class:"groups"},Uo={class:"group"},Fo=(0,o._)("div",{class:"label"},"戻る",-1),Ko={class:"group"},qo=["disabled"],jo=(0,o._)("div",{class:"label"},"初期化",-1),Vo=["disabled"],Zo=(0,o._)("div",{class:"label"},"開く",-1),zo=["disabled"],Yo=(0,o._)("div",{class:"label"},"上書き保存",-1),$o=["disabled"],Jo=(0,o._)("div",{class:"label"},"保存",-1),Xo={class:"group"},Qo=(0,o._)("div",{class:"label"},"コピー・KIF",-1),ea=(0,o._)("div",{class:"label"},"コピー・CSA",-1),ta=(0,o._)("div",{class:"label"},"コピー・USI",-1),ia=(0,o._)("div",{class:"label"},"コピー・SFEN",-1),na=["disabled"],oa=(0,o._)("div",{class:"label"},"貼り付け",-1);function aa(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",xo,[(0,o._)("div",Wo,[(0,o._)("div",Uo,[(0,o._)("button",{class:"close",onClick:t[0]||(t[0]=(...t)=>e.onClose&&e.onClose(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"]),Fo])]),(0,o._)("div",Ko,[(0,o._)("button",{disabled:!e.states.newFile,onClick:t[1]||(t[1]=(...t)=>e.onNewFile&&e.onNewFile(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.FILE},null,8,["icon"]),jo],8,qo),(0,o._)("button",{disabled:!e.states.open,onClick:t[2]||(t[2]=(...t)=>e.onOpen&&e.onOpen(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.OPEN},null,8,["icon"]),Zo],8,Vo),(0,o._)("button",{disabled:!e.states.saveAs,onClick:t[3]||(t[3]=(...t)=>e.onSave&&e.onSave(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SAVE},null,8,["icon"]),Yo],8,zo),(0,o._)("button",{disabled:!e.states.save,onClick:t[4]||(t[4]=(...t)=>e.onSaveAs&&e.onSaveAs(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SAVE_AS},null,8,["icon"]),Jo],8,$o)]),(0,o._)("div",Xo,[(0,o._)("button",{onClick:t[5]||(t[5]=(...t)=>e.onCopyKIF&&e.onCopyKIF(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),Qo]),(0,o._)("button",{onClick:t[6]||(t[6]=(...t)=>e.onCopyCSA&&e.onCopyCSA(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),ea]),(0,o._)("button",{onClick:t[7]||(t[7]=(...t)=>e.onCopyUSI&&e.onCopyUSI(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),ta]),(0,o._)("button",{onClick:t[8]||(t[8]=(...t)=>e.onCopySFEN&&e.onCopySFEN(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),ia]),(0,o._)("button",{disabled:!e.states.paste,onClick:t[9]||(t[9]=(...t)=>e.onPaste&&e.onPaste(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.PASTE},null,8,["icon"]),oa],8,na)])])],512)])}var sa=(0,o.aZ)({name:"FileMenu",components:{ButtonIcon:Ao},emits:["close"],setup(e,t){const i=So(),n=(0,h.iH)(null),a=()=>{t.emit("close")};(0,o.bv)((()=>{Ho(n.value,a)}));const s=()=>{i.resetRecord(),t.emit("close")},r=()=>{i.openRecord(),t.emit("close")},l=()=>{i.saveRecord({overwrite:!0}),t.emit("close")},c=()=>{i.saveRecord(),t.emit("close")},d=()=>{i.copyRecordKIF(),t.emit("close")},u=()=>{i.copyRecordCSA(),t.emit("close")},p=()=>{i.copyRecordUSIAll(),t.emit("close")},g=()=>{i.copyBoardSFEN(),t.emit("close")},m=()=>{i.showPasteDialog(),t.emit("close")},_=(0,o.Fl)((()=>({newFile:i.appState===Nn.NORMAL,open:i.appState===Nn.NORMAL,save:i.appState===Nn.NORMAL,saveAs:i.appState===Nn.NORMAL,paste:i.appState===Nn.NORMAL})));return{dialog:n,Icon:Io,onClose:a,onNewFile:s,onOpen:r,onSave:l,onSaveAs:c,onCopyKIF:d,onCopyCSA:u,onCopyUSI:p,onCopySFEN:g,onPaste:m,states:_}}});const ra=(0,yi.Z)(sa,[["render",aa]]);var la=ra;const ca={ref:"dialog",class:"menu"},ha={class:"groups"},da={class:"group"},ua=(0,o._)("div",{class:"label"},"戻る",-1),pa={class:"group"},ga=(0,o._)("div",{class:"label"},"平手",-1),ma=(0,o._)("div",{class:"label"},"香落ち",-1),_a=(0,o._)("div",{class:"label"},"右香落ち",-1),va=(0,o._)("div",{class:"label"},"角落ち",-1),Sa=(0,o._)("div",{class:"label"},"飛車落ち",-1),Ea=(0,o._)("div",{class:"label"},"飛車香落ち",-1),fa=(0,o._)("div",{class:"label"},"2枚落ち",-1),Ia=(0,o._)("div",{class:"label"},"4枚落ち",-1),ya=(0,o._)("div",{class:"label"},"6枚落ち",-1),wa=(0,o._)("div",{class:"label"},"8枚落ち",-1),ba=(0,o._)("div",{class:"label"},"詰め将棋",-1),Aa=(0,o._)("div",{class:"label"},"双玉詰め将棋",-1);function Ta(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",ca,[(0,o._)("div",ha,[(0,o._)("div",da,[(0,o._)("button",{class:"close",onClick:t[0]||(t[0]=(...t)=>e.onClose&&e.onClose(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"]),ua])]),(0,o._)("div",pa,[(0,o._)("button",{onClick:t[1]||(t[1]=(...t)=>e.onStandard&&e.onStandard(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),ga]),(0,o._)("button",{onClick:t[2]||(t[2]=(...t)=>e.onHandicapLance&&e.onHandicapLance(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),ma]),(0,o._)("button",{onClick:t[3]||(t[3]=(...t)=>e.onHandicapRightLance&&e.onHandicapRightLance(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),_a]),(0,o._)("button",{onClick:t[4]||(t[4]=(...t)=>e.onHandicapBishop&&e.onHandicapBishop(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),va]),(0,o._)("button",{onClick:t[5]||(t[5]=(...t)=>e.onHandicapRook&&e.onHandicapRook(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Sa]),(0,o._)("button",{onClick:t[6]||(t[6]=(...t)=>e.onHandicapRookLance&&e.onHandicapRookLance(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Ea]),(0,o._)("button",{onClick:t[7]||(t[7]=(...t)=>e.onHandicap2Pieces&&e.onHandicap2Pieces(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),fa]),(0,o._)("button",{onClick:t[8]||(t[8]=(...t)=>e.onHandicap4Pieces&&e.onHandicap4Pieces(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Ia]),(0,o._)("button",{onClick:t[9]||(t[9]=(...t)=>e.onHandicap6Pieces&&e.onHandicap6Pieces(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),ya]),(0,o._)("button",{onClick:t[10]||(t[10]=(...t)=>e.onHandicap8Pieces&&e.onHandicap8Pieces(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),wa]),(0,o._)("button",{onClick:t[11]||(t[11]=(...t)=>e.onTsumeShogi&&e.onTsumeShogi(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.QUIZ},null,8,["icon"]),ba]),(0,o._)("button",{onClick:t[12]||(t[12]=(...t)=>e.onTsumeShogi2Kings&&e.onTsumeShogi2Kings(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.QUIZ},null,8,["icon"]),Aa])])])],512)])}var Na=(0,o.aZ)({name:"InitialPositionMenu",components:{ButtonIcon:Ao},emits:["close"],setup(e,t){const i=So(),n=(0,h.iH)(null),a=()=>{t.emit("close")};(0,o.bv)((()=>{Ho(n.value,a)}));const s=()=>{i.initializePosition(Oe.STANDARD),t.emit("close")},r=()=>{i.initializePosition(Oe.HANDICAP_LANCE),t.emit("close")},l=()=>{i.initializePosition(Oe.HANDICAP_RIGHT_LANCE),t.emit("close")},c=()=>{i.initializePosition(Oe.HANDICAP_BISHOP),t.emit("close")},d=()=>{i.initializePosition(Oe.HANDICAP_ROOK),t.emit("close")},u=()=>{i.initializePosition(Oe.HANDICAP_ROOK_LANCE),t.emit("close")},p=()=>{i.initializePosition(Oe.HANDICAP_2PIECES),t.emit("close")},g=()=>{i.initializePosition(Oe.HANDICAP_4PIECES),t.emit("close")},m=()=>{i.initializePosition(Oe.HANDICAP_6PIECES),t.emit("close")},_=()=>{i.initializePosition(Oe.HANDICAP_8PIECES),t.emit("close")},v=()=>{i.initializePosition(Oe.TSUME_SHOGI),t.emit("close")},S=()=>{i.initializePosition(Oe.TSUME_SHOGI_2KINGS),t.emit("close")};return{dialog:n,Icon:Io,onClose:a,onStandard:s,onHandicapLance:r,onHandicapRightLance:l,onHandicapBishop:c,onHandicapRook:d,onHandicapRookLance:u,onHandicap2Pieces:p,onHandicap4Pieces:g,onHandicap6Pieces:m,onHandicap8Pieces:_,onTsumeShogi:v,onTsumeShogi2Kings:S}}});const Ra=(0,yi.Z)(Na,[["render",Ta]]);var ka=Ra,Pa=(0,o.aZ)({name:"BoardPane",components:{BoardView:bi,ButtonIcon:Ao,GameMenu:Bo,FileMenu:la,InitialPositionMenu:ka},props:{maxSize:{type:li,required:!0}},emits:["resize"],setup(e,t){const i=So(),n=(0,h.iH)(!1),a=(0,h.iH)(!1),s=(0,h.iH)(!1),r=e=>{t.emit("resize",e)},l=e=>{i.appState===Nn.GAME||i.appState===Nn.CSA_GAME?go.doMove(e):i.doMove(e)},c=e=>{i.editPosition(e)},d=()=>{n.value=!0},u=()=>{i.stopGame()},p=()=>{go.win()},g=()=>{go.resign()},m=()=>{i.showResearchDialog()},_=()=>{i.stopResearch()},v=()=>{i.showAnalysisDialog()},S=()=>{i.stopAnalysis()},E=()=>{i.startPositionEditing()},f=()=>{i.endPositionEditing()},I=()=>{s.value=!0},y=()=>{i.changeTurn()},w=()=>{i.showAppSettingDialog()},b=()=>{i.showUsiEngineManagementDialog()},A=()=>{So().flipBoard()},T=()=>{a.value=!0},N=()=>{i.removeCurrentMove()},R=(0,o.Fl)((()=>i.appState===Nn.POSITION_EDITING)),k=(0,o.Fl)((()=>i.isMovableByUser)),P=(0,o.Fl)((()=>i.appSetting)),C=(0,o.Fl)((()=>i.record.position)),O=(0,o.Fl)((()=>{const e=i.record.current.move;return e instanceof Pe?e:void 0})),M=(0,o.Fl)((()=>i.record.metadata.getStandardMetadata(qe.BLACK_NAME))),H=(0,o.Fl)((()=>i.record.metadata.getStandardMetadata(qe.WHITE_NAME))),L=(0,o.Fl)((()=>{if(i.appState===Nn.GAME||i.csaGameState===io.GAME)return{black:{time:i.blackTime,byoyomi:i.blackByoyomi},white:{time:i.whiteTime,byoyomi:i.whiteByoyomi}}})),D=(0,o.Fl)((()=>({game:i.appState===Nn.NORMAL,stop:i.appState===Nn.GAME||i.appState===Nn.CSA_GAME,win:i.appState===Nn.CSA_GAME&&i.isMovableByUser,resign:(i.appState===Nn.GAME||i.appState===Nn.CSA_GAME)&&i.isMovableByUser,research:i.appState===Nn.NORMAL,endResearch:i.appState===Nn.RESEARCH,analysis:i.appState===Nn.NORMAL,endAnalysis:i.appState===Nn.ANALYSIS,startEditPosition:i.appState===Nn.NORMAL,endEditPosition:i.appState===Nn.POSITION_EDITING,initPosition:i.appState===Nn.POSITION_EDITING,removeCurrentMove:i.appState===Nn.NORMAL||i.appState===Nn.RESEARCH,engineSettings:i.appState===Nn.NORMAL})));return{isGameMenuVisible:n,isFileMenuVisible:a,isInitialPositionMenuVisible:s,appSetting:P,position:C,lastMove:O,blackPlayerName:M,whitePlayerName:H,clock:L,controlStates:D,onResize:r,onMove:l,onEdit:c,onGame:d,onStop:u,onWin:p,onResign:g,onResearch:m,onEndResearch:_,onAnalysis:v,onEndAnalysis:S,onStartEditPosition:E,onEndEditPosition:f,onInitPosition:I,onChangeTurn:y,onOpenAppSettings:w,onOpenEngineSettings:b,onFlip:A,onFileAction:T,onRemoveCurrentMove:N,allowEdit:R,allowMove:k,Icon:Io}}});const Ca=(0,yi.Z)(Pa,[["render",C],["__scopeId","data-v-58cfebfb"]]);var Oa=Ca;const Ma=e=>((0,o.dD)("data-v-2f3c443f"),e=e(),(0,o.Cn)(),e),Ha={class:"record-pane"},La={class:"record"},Da={class:"options"},Ga={class:"option"},Ba=["checked"],xa=Ma((()=>(0,o._)("label",{for:"show-elapsed-time"},"消費時間",-1))),Wa={class:"option"},Ua=["checked"],Fa=Ma((()=>(0,o._)("label",{for:"show-comment"},"コメント",-1)));function Ka(e,t,i,n,a,s){const r=(0,o.up)("RecordView");return(0,o.wg)(),(0,o.iD)("div",Ha,[(0,o._)("div",La,[(0,o.Wm)(r,{record:e.record,operational:e.isRecordOperational,"show-comment":e.showComment,"show-elapsed-time":e.showElapsedTime,onGoBegin:e.goBegin,onGoBack:e.goBack,onGoForward:e.goForward,onGoEnd:e.goEnd,onSelectMove:e.selectMove,onSelectBranch:e.selectBranch},null,8,["record","operational","show-comment","show-elapsed-time","onGoBegin","onGoBack","onGoForward","onGoEnd","onSelectMove","onSelectBranch"])]),(0,o._)("div",Da,[(0,o._)("div",Ga,[(0,o._)("input",{id:"show-elapsed-time",type:"checkbox",checked:e.showElapsedTime,onChange:t[0]||(t[0]=(...t)=>e.onToggleElapsedTime&&e.onToggleElapsedTime(...t))},null,40,Ba),xa]),(0,o._)("div",Wa,[(0,o._)("input",{id:"show-comment",type:"checkbox",checked:e.showComment,onChange:t[1]||(t[1]=(...t)=>e.onToggleComment&&e.onToggleComment(...t))},null,40,Ua),Fa])])])}const qa={class:"record-view"},ja={class:"controller"},Va=["disabled"],Za=["disabled"],za=["disabled"],Ya=["disabled"],$a={ref:"moveList",class:"move-list"},Ja=["value","onClick"],Xa={class:"move-number"},Qa={class:"move-text"},es={key:0,class:"move-time"},ts={key:1,class:"move-comment"},is={ref:"branchList",class:"branch-list"},ns=["value","onClick"],os={class:"move-text"},as={key:0,class:"move-comment"};function ss(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",qa,[(0,o._)("div",ja,[(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[0]||(t[0]=t=>e.goBegin())},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.FIRST},null,8,["icon"])],8,Va),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[1]||(t[1]=t=>e.goBack())},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.BACK},null,8,["icon"])],8,Za),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[2]||(t[2]=t=>e.goForward())},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.NEXT},null,8,["icon"])],8,za),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[3]||(t[3]=t=>e.goEnd())},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.LAST},null,8,["icon"])],8,Ya)]),(0,o._)("div",$a,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.moves,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.number,class:(0,a.C_)(["move-element",{"has-branch":t.hasBranch,selected:t.selected}]),value:t.number,onClick:i=>e.changeNumber(t.number)},[(0,o._)("div",Xa,(0,a.zw)(0!==t.number?t.number:""),1),(0,o._)("div",Qa,(0,a.zw)(t.text),1),e.showElapsedTime?((0,o.wg)(),(0,o.iD)("div",es,(0,a.zw)(t.time),1)):(0,o.kq)("",!0),e.showComment?((0,o.wg)(),(0,o.iD)("div",ts,(0,a.zw)(t.comment),1)):(0,o.kq)("",!0)],10,Ja)))),128))],512),(0,o._)("div",is,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.branches,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.index,class:(0,a.C_)(["move-element",{selected:t.selected}]),value:t.index,onClick:i=>e.changeBranch(t.index)},[(0,o._)("div",os,(0,a.zw)(t.text),1),e.showComment?((0,o.wg)(),(0,o.iD)("div",as,(0,a.zw)(t.comment),1)):(0,o.kq)("",!0)],10,ns)))),128))],512)])}var rs=(0,o.aZ)({name:"RecordView",components:{ButtonIcon:Ao},props:{record:{type:Object,required:!0},operational:{type:Boolean,required:!1},showElapsedTime:{type:Boolean,required:!1},showComment:{type:Boolean,required:!1}},emits:["goBegin","goBack","goForward","goEnd","selectMove","selectBranch"],setup(e,t){const i=(0,h.iH)(null),n=(0,h.iH)(null),a=()=>{e.operational&&t.emit("goBegin")},s=()=>{e.operational&&t.emit("goBack")},r=()=>{e.operational&&t.emit("goForward")},l=()=>{e.operational&&t.emit("goEnd")},c=i=>{e.operational&&t.emit("selectMove",Number(i))},d=i=>{e.operational&&t.emit("selectBranch",Number(i))},u=(0,o.Fl)((()=>0===e.record.current.number)),p=(0,o.Fl)((()=>{const t=[];return e.record.moves.forEach((i=>{t.push({number:i.number,text:i.displayText,time:0!=i.number?i.timeText:"",hasBranch:i.hasBranch,comment:i.comment,selected:i===e.record.current})})),t})),g=(0,o.Fl)((()=>{if(!e.record.branchBegin.branch)return null;const t=[];let i;for(i=e.record.branchBegin;i&&i.move;i=i.branch)t.push({index:t.length,text:i.displayText,comment:i.comment,selected:i.activeBranch});return t}));return(0,o.ic)((()=>{const e=i.value;e.childNodes.forEach((e=>{e instanceof HTMLElement&&e.classList.contains("selected")&&e.scrollIntoView({behavior:"auto",block:"nearest"})}))})),{beginPosSelected:u,moves:p,branches:g,moveList:i,branchList:n,goBegin:a,goBack:s,goForward:r,goEnd:l,changeNumber:c,changeBranch:d,Icon:Io}}});const ls=(0,yi.Z)(rs,[["render",ss],["__scopeId","data-v-006c6f53"]]);var cs=ls;const hs=200;var ds=(0,o.aZ)({name:"RecordPane",components:{RecordView:cs},setup(){const e=So(),t=t=>{e.changeMoveNumber(t)},i=()=>{t(0)},n=()=>{t(e.record.current.number-1)},a=()=>{t(e.record.current.number+1)},s=()=>{t(Number.MAX_SAFE_INTEGER)},r=e=>{t(e)},l=t=>{e.changeBranch(t)},c=t=>{const i=t.target;e.updateAppSetting({showElapsedTimeInRecordView:i.checked})},h=t=>{const i=t.target;e.updateAppSetting({showCommentInRecordView:i.checked})},d=(0,o.Fl)((()=>e.appState===Nn.NORMAL||e.appState===Nn.RESEARCH)),u=(0,o.Fl)((()=>e.appSetting.showCommentInRecordView)),p=(0,o.Fl)((()=>e.appSetting.showElapsedTimeInRecordView)),g=(0,o.Fl)((()=>e.record));return{isRecordOperational:d,showElapsedTime:p,showComment:u,record:g,goBegin:i,goBack:n,goForward:a,goEnd:s,selectMove:r,selectBranch:l,onToggleElapsedTime:c,onToggleComment:h}}});const us=(0,yi.Z)(ds,[["render",Ka],["__scopeId","data-v-2f3c443f"]]);var ps=us;const gs={class:"root"},ms={class:"tabs"},_s=(0,o.Uk)(" 棋譜情報 "),vs=(0,o.Uk)(" コメント "),Ss=(0,o.Uk)(" 思考 "),Es=(0,o.Uk)(" 読み筋 "),fs=(0,o.Uk)(" 評価値 "),Is=(0,o.Uk)(" 期待勝率 "),ys=(0,o.Uk)(" 最小化 "),ws={class:"tab-contents"};function bs(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon"),c=(0,o.up)("RecordInfo"),h=(0,o.up)("RecordComment"),d=(0,o.up)("EngineAnalytics"),u=(0,o.up)("EvaluationChart");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",gs,["invisible"===e.activeTab?((0,o.wg)(),(0,o.iD)("div",{key:0,style:(0,a.j5)(`height: calc(100% - ${e.headerHeight}px);`)},null,4)):(0,o.kq)("",!0),(0,o._)("div",ms,[(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.RECORD_INFO}]),onClick:t[0]||(t[0]=t=>e.changeSelect(e.Tab.RECORD_INFO))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.DESCRIPTION},null,8,["icon"]),_s],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.COMMENT}]),onClick:t[1]||(t[1]=t=>e.changeSelect(e.Tab.COMMENT))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.COMMENT},null,8,["icon"]),vs],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.SEARCH}]),onClick:t[2]||(t[2]=t=>e.changeSelect(e.Tab.SEARCH))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.BRAIN},null,8,["icon"]),Ss],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.PV}]),onClick:t[3]||(t[3]=t=>e.changeSelect(e.Tab.PV))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.PV},null,8,["icon"]),Es],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.CHART}]),onClick:t[4]||(t[4]=t=>e.changeSelect(e.Tab.CHART))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.CHART},null,8,["icon"]),fs],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.PERCENTAGE_CHART}]),onClick:t[5]||(t[5]=t=>e.changeSelect(e.Tab.PERCENTAGE_CHART))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.PERCENT},null,8,["icon"]),Is],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.INVISIBLE}]),onClick:t[6]||(t[6]=t=>e.changeSelect(e.Tab.INVISIBLE))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.ARROW_DROP},null,8,["icon"]),ys],2)]),(0,o._)("div",ws,[(0,o.Wm)(c,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.RECORD_INFO}]),size:e.contentSize},null,8,["class","size"]),(0,o.Wm)(h,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.COMMENT}])},null,8,["class"]),(0,o.Wm)(d,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.SEARCH}]),size:e.contentSize,"history-mode":!0},null,8,["class","size"]),(0,o.Wm)(d,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.PV}]),size:e.contentSize,"history-mode":!1},null,8,["class","size"]),(0,o.Wm)(u,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.CHART}]),size:e.contentSize,type:e.EvaluationChartType.RAW},null,8,["class","size","type"]),(0,o.Wm)(u,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.PERCENTAGE_CHART}]),size:e.contentSize,type:e.EvaluationChartType.WIN_RATE},null,8,["class","size","type"])])])])}const As={class:"root"},Ts=["value","readonly"];function Ns(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",As,[(0,o._)("textarea",{ref:"textarea",class:"text",value:e.comment,readonly:!!e.readonly,onInput:t[0]||(t[0]=(...t)=>e.change&&e.change(...t))},null,40,Ts)])])}var Rs=(0,o.aZ)({name:"RecordComment",setup(){const e=So(),t=(0,o.Fl)((()=>e.record.current.comment)),i=(0,o.Fl)((()=>e.appState!=Nn.NORMAL)),n=(0,h.iH)(null),a=t=>{const i=t.target.value;e.updateRecordComment(i)};return(0,o.bv)((()=>{n.value.addEventListener("copy",(e=>{e.stopPropagation()})),n.value.addEventListener("paste",(e=>{e.stopPropagation()}))})),{textarea:n,comment:t,readonly:i,change:a}}});const ks=(0,yi.Z)(Rs,[["render",Ns],["__scopeId","data-v-74746424"]]);var Ps=ks;const Cs={class:"root"};function Os(e,t,i,n,a,s){const r=(0,o.up)("EngineAnalyticsElement");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Cs,[e.blackPlayer?((0,o.wg)(),(0,o.j4)(r,{key:0,"history-mode":e.historyMode,name:e.blackPlayer.name,info:e.blackPlayer,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,o.kq)("",!0),e.whitePlayer?((0,o.wg)(),(0,o.j4)(r,{key:1,"history-mode":e.historyMode,name:e.whitePlayer.name,info:e.whitePlayer,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,o.kq)("",!0),e.researcher?((0,o.wg)(),(0,o.j4)(r,{key:2,"history-mode":e.historyMode,name:e.researcher.name,info:e.researcher,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,o.kq)("",!0)])])}const Ms=e=>((0,o.dD)("data-v-6522ae2d"),e=e(),(0,o.Cn)(),e),Hs={class:"root"},Ls={class:"headers"},Ds={class:"header"},Gs=Ms((()=>(0,o._)("span",{class:"label"},"エンジン名: ",-1))),Bs={class:"value"},xs={class:"header"},Ws=Ms((()=>(0,o._)("span",{class:"label"},"予想手: ",-1))),Us={class:"value"},Fs={class:"header"},Ks=Ms((()=>(0,o._)("span",{class:"label"},"最善手: ",-1))),qs={class:"value"},js={class:"header"},Vs=Ms((()=>(0,o._)("span",{class:"label"},"秒間探索ノード(NPS): ",-1))),Zs={class:"value"},zs={class:"header"},Ys=Ms((()=>(0,o._)("span",{class:"label"},"探索ノード数: ",-1))),$s={class:"value"},Js={class:"header"},Xs=Ms((()=>(0,o._)("span",{class:"label"},"ハッシュ使用率: ",-1))),Qs={class:"value"},er=(0,o.uE)('<div class="list-header" data-v-6522ae2d><div class="list-column time" data-v-6522ae2d>経過時間</div><div class="list-column multipv-index" data-v-6522ae2d>順位</div><div class="list-column depth" data-v-6522ae2d>深さ</div><div class="list-column nodes" data-v-6522ae2d>探索局面数</div><div class="list-column score" data-v-6522ae2d>評価値</div></div>',1),tr={class:"list-column time"},ir={class:"list-column multipv-index"},nr={class:"list-column depth"},or={class:"list-column nodes"},ar={class:"list-column score"},sr={class:"list-column score-flag"},rr={class:"list-column text"},lr=["onClick"],cr=(0,o.Uk)(" 再現 ");function hr(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon"),c=(0,o.up)("PVPreviewDialog");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Hs,[(0,o._)("div",Ls,[(0,o._)("div",Ds,[Gs,(0,o._)("span",Bs,(0,a.zw)(e.name),1)]),(0,o._)("div",xs,[Ws,(0,o._)("span",Us,(0,a.zw)(e.info.ponderMove?e.info.ponderMove:"---"),1)]),(0,o._)("div",Fs,[Ks,(0,o._)("span",qs,(0,a.zw)(e.info.currentMoveText||"---"),1)]),(0,o._)("div",js,[Vs,(0,o._)("span",Zs,(0,a.zw)(e.info.nps||"---"),1)]),(0,o._)("div",zs,[Ys,(0,o._)("span",$s,(0,a.zw)(e.info.nodes||"---"),1)]),(0,o._)("div",Js,[Xs,(0,o._)("span",Qs,(0,a.zw)(e.info.hashfull?(100*e.info.hashfull).toFixed(1):"---")+" % ",1)])]),er,(0,o._)("div",{class:"list",style:(0,a.j5)(`height:${e.height-37}px`)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.historyMode?e.info.iterates:e.info.latestIteration,((t,i)=>((0,o.wg)(),(0,o.iD)("div",{key:i,class:(0,a.C_)(["list-item",{highlight:e.enableHighlight&&1===t.multiPV}])},[(0,o._)("div",tr,(0,a.zw)(t.timeMs?(t.timeMs/1e3).toFixed(1)+"s":""),1),(0,o._)("div",ir,(0,a.zw)(t.multiPV||""),1),(0,o._)("div",nr,(0,a.zw)(t.depth)+(0,a.zw)(t.selectiveDepth&&t.depth?"/":"")+(0,a.zw)(t.selectiveDepth),1),(0,o._)("div",or,(0,a.zw)(t.nodes),1),(0,o._)("div",ar,(0,a.zw)(t.score)+" "+(0,a.zw)(t.scoreMate?t.scoreMate:""),1),(0,o._)("div",sr,(0,a.zw)(t.lowerBound?"++":"")+" "+(0,a.zw)(t.upperBound?"--":"")+" "+(0,a.zw)(t.scoreMate?"詰":""),1),(0,o._)("div",rr,[t.pv&&0!==t.pv.length&&t.text?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:i=>e.showPreview(t)},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.PLAY},null,8,["icon"]),cr],8,lr)):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,a.zw)(t.text),1)])],2)))),128))],4),e.preview?((0,o.wg)(),(0,o.j4)(c,{key:0,position:e.preview.position,pv:e.preview.pv,infos:e.preview.infos,onClose:e.closePreview},null,8,["position","pv","infos","onClose"])):(0,o.kq)("",!0)])])}const dr={ref:"dialog"},ur={class:"control top"},pr={class:"control-row"},gr={class:"control-row"},mr={class:"control-row"},_r={class:"informations"};function vr(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon"),c=(0,o.up)("BoardView");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",dr,[(0,o.Wm)(c,{class:"board","piece-image-type":e.appSetting.pieceImage,"board-image-type":e.appSetting.boardImage,"board-label-type":e.appSetting.boardLabelType,"max-size":e.maxSize,position:e.pos,"last-move":e.lastMove,flip:e.flip},{"right-control":(0,o.w5)((()=>[(0,o._)("div",ur,[(0,o._)("div",pr,[(0,o._)("button",{class:"control-item",onClick:t[0]||(t[0]=(...t)=>e.doFlip&&e.doFlip(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.FLIP},null,8,["icon"])]),(0,o._)("button",{class:"control-item",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"])])]),(0,o._)("div",gr,[(0,o._)("button",{class:"control-item",onClick:t[2]||(t[2]=(...t)=>e.goBegin&&e.goBegin(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.FIRST},null,8,["icon"])]),(0,o._)("button",{class:"control-item",onClick:t[3]||(t[3]=(...t)=>e.goEnd&&e.goEnd(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.LAST},null,8,["icon"])])]),(0,o._)("div",mr,[(0,o._)("button",{class:"control-item",onClick:t[4]||(t[4]=(...t)=>e.goBack&&e.goBack(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.BACK},null,8,["icon"])]),(0,o._)("button",{class:"control-item",onClick:t[5]||(t[5]=(...t)=>e.goForward&&e.goForward(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.NEXT},null,8,["icon"])])])])])),_:1},8,["piece-image-type","board-image-type","board-label-type","max-size","position","last-move","flip"]),(0,o._)("div",_r,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.infos,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"information"},(0,a.zw)(e),1)))),128))])],512)])}var Sr=(0,o.aZ)({name:"PVPreviewDialog",components:{BoardView:bi,ButtonIcon:Ao},props:{position:{type:String,required:!0},pv:{type:Object,required:!0},infos:{type:Object,default:[],required:!1}},emits:["close"],setup(e,t){const i=So(),n=(0,h.iH)(null),a=(0,h.qj)(new li(0,0)),s=(0,h.qj)(new tt),r=(0,h.iH)(i.appSetting.boardFlipping),l=()=>{a.width=.8*window.innerWidth,a.height=.8*window.innerHeight-80},c=()=>{const t=Ue.newBySFEN(e.position);if(t){s.clear(t);for(const t of e.pv){const e=s.position.createMoveBySFEN(t);if(!e)break;s.append(e,{ignoreValidation:!0})}s.goto(1)}};(0,o.bv)((async()=>{l(),c(),window.addEventListener("resize",l),Ho(n.value)})),(0,o.Ah)((()=>{window.removeEventListener("resize",l)})),(0,o.YP)([()=>e.position,()=>e.pv],(()=>{c(),Ho(n.value)}));const d=()=>{t.emit("close")},u=()=>{s.goto(0)},p=()=>{s.goto(Number.MAX_SAFE_INTEGER)},g=()=>{s.goBack()},m=()=>{s.goForward()},_=()=>{r.value=!r.value},v=(0,o.Fl)((()=>s.position)),S=(0,o.Fl)((()=>s.current.move instanceof Pe?s.current.move:null));return{dialog:n,appSetting:i.appSetting,pos:v,lastMove:S,maxSize:a,flip:r,close:d,goBegin:u,goEnd:p,goBack:g,goForward:m,doFlip:_,Icon:Io}}});const Er=(0,yi.Z)(Sr,[["render",vr],["__scopeId","data-v-f82f9ba0"]]);var fr=Er,Ir=(0,o.aZ)({name:"EngineAnalyticsElement",components:{ButtonIcon:Ao,PVPreviewDialog:fr},props:{historyMode:{type:Boolean,required:!0},name:{type:String,required:!0},info:{type:Dn,required:!0},height:{type:Number,required:!0}},setup:e=>{const t=(0,o.Fl)((()=>{if(!e.historyMode)return!1;for(const t of e.info.iterates)if(t.multiPV&&1!==t.multiPV)return!0;return!1})),i=(0,h.iH)(null),n=e=>{const t=[];void 0!==e.depth&&t.push(`深さ=${e.depth}`),void 0!==e.selectiveDepth&&t.push(`選択的深さ=${e.selectiveDepth}`),e.score&&(t.push(`評価値=${e.score}`),e.lowerBound&&t.push("（下界値）"),e.upperBound&&t.push("（上界値）")),e.scoreMate&&t.push(`詰み手数=${e.scoreMate}`),e.multiPV&&t.push(`順位=${e.multiPV}`),i.value={position:e.position,pv:e.pv||[],infos:[t.join(" / "),e.text||""]}},a=()=>{i.value=null};return{Icon:Io,enableHighlight:t,preview:i,showPreview:n,closePreview:a}}});const yr=(0,yi.Z)(Ir,[["render",hr],["__scopeId","data-v-6522ae2d"]]);var wr=yr,br=(0,o.aZ)({name:"EngineAnalytics",components:{EngineAnalyticsElement:wr},props:{size:{type:li,required:!0},historyMode:{type:Boolean,required:!0}},setup(e){const t=So(),i=(0,o.Fl)((()=>t.usiBlackPlayerMonitor)),n=(0,o.Fl)((()=>t.usiWhitePlayerMonitor)),a=(0,o.Fl)((()=>t.usiResearcherMonitor)),s=(0,o.Fl)((()=>{const i=(t.usiBlackPlayerMonitor?1:0)+(t.usiWhitePlayerMonitor?1:0)+(t.usiResearcherMonitor?1:0);return 0!==i?e.size.height/i:0}));return{blackPlayer:i,whitePlayer:n,researcher:a,elementHeight:s}}});const Ar=(0,yi.Z)(br,[["render",Os],["__scopeId","data-v-3b22508c"]]);var Tr=Ar;const Nr={class:"root"},Rr=["width","height"];function kr(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Nr,[(0,o._)("canvas",{ref:"canvas",width:e.size.width.toFixed(0),height:e.size.height.toFixed(0)},null,8,Rr)])])}var Pr=i(6300);const Cr=1e6,Or=2e3,Mr=-Or;var Hr,Lr;function Dr(e){switch(e){case Hr.BLACK_PLAYER:return"先手";case Hr.WHITE_PLAYER:return"後手";case Hr.RESEARCHER:return"検討"}}function Gr(e,t){const i=e.customData;if(i)switch(t){case Hr.BLACK_PLAYER:if(e.nextColor===Z.BLACK)return;return i.playerSearchInfo;case Hr.WHITE_PLAYER:if(e.nextColor===Z.WHITE)return;return i.playerSearchInfo;case Hr.RESEARCHER:return i.researchInfo}}function Br(e,t,i){const n=void 0!==e.score?e.score:void 0!==e.mate?e.mate>0?Cr:-Cr:void 0;if(void 0!==n)switch(t){case Lr.RAW:return Math.min(Math.max(n,Mr),Or);case Lr.WIN_RATE:return $i(n,i)}}function xr(e){switch(e){default:return{main:"black",ticks:"dimgray",grid:"lightgray",head:"red",blackPlayer:"royalblue",whitePlayer:"darkorange",researcher:"darkgreen"};case Fi.DARK:return{main:"white",ticks:"darkgray",grid:"dimgray",head:"red",blackPlayer:"deepskyblue",whitePlayer:"orange",researcher:"mediumseagreen"}}}(function(e){e[e["BLACK_PLAYER"]=0]="BLACK_PLAYER",e[e["WHITE_PLAYER"]=1]="WHITE_PLAYER",e[e["RESEARCHER"]=2]="RESEARCHER"})(Hr||(Hr={})),function(e){e["RAW"]="raw",e["WIN_RATE"]="winRate"}(Lr||(Lr={}));var Wr=(0,o.aZ)({name:"EvaluationChart",props:{size:{type:li,required:!0},type:{type:String,required:!0}},setup(e){const t=(0,h.iH)(null),i=So();let n,a=Or,s=Mr;e.type===Lr.WIN_RATE&&(a=100,s=0);const r=(t,i,n,o)=>{const a=[],s=n.moves;for(const l of s){const t=Gr(l,i);if(!t)continue;const n=Br(t,e.type,o.coefficientInSigmoid);void 0!==n&&a.push({x:l.number,y:n})}const r=s[s.length-1];if(i===Hr.BLACK_PLAYER&&r.nextColor===Z.BLACK||i===Hr.WHITE_PLAYER&&r.nextColor===Z.WHITE){const t=r.customData;if(t&&t.enemySearchInfo){const i=Br(t.enemySearchInfo,e.type,o.coefficientInSigmoid);void 0!==i&&a.push({x:r.number+1,y:i})}}return{label:Dr(i),borderColor:t,data:a,showLine:!0}},l=(e,t)=>({label:"現在の局面",borderColor:t.head,data:[{x:e.current.number,y:a},{x:e.current.number,y:s}],showLine:!0,pointBorderWidth:0,pointRadius:0}),c=(e,t,i)=>[l(e,i),r(i.blackPlayer,Hr.BLACK_PLAYER,e,t),r(i.whitePlayer,Hr.WHITE_PLAYER,e,t),r(i.researcher,Hr.RESEARCHER,e,t)],d=(e,t)=>({x:{min:0,max:e.length+10,ticks:{color:t.ticks},grid:{color:t.grid}},y:{min:s,max:a,ticks:{color:t.ticks},grid:{color:t.grid}}}),u=(e,t)=>{const i=xr(t.thema);n.data.datasets=c(e,t,i),n.options.color=i.main,n.options.scales=d(e,i),n.update()},p=(e,t,n)=>{if(null===e.x)return;const o=n.scales.x.max-n.scales.x.min,a=n.scales.x.right-n.scales.x.left,s=(e.x-n.scales.x.left)/a*o+n.scales.x.min,r=Math.round(s);i.changeMoveNumber(r)};return(0,o.bv)((()=>{const e=t.value,i=e.getContext("2d");n=new Pr.kL(i,{type:"scatter",data:{datasets:[]},options:{animation:{duration:0},maintainAspectRatio:!1,events:["click"],onClick:p}}),n.draw()})),(0,o.Ah)((()=>{n.destroy()})),(0,o.YP)((()=>[i.record,i.appSetting]),(([e,t])=>u(e,t)),{deep:!0}),(0,o.YP)((()=>[e.size]),(([e])=>{n.resize(e.width,e.height)}),{deep:!0}),{canvas:t}}});const Ur=(0,yi.Z)(Wr,[["render",kr],["__scopeId","data-v-c92a42fc"]]);var Fr=Ur;const Kr=e=>((0,o.dD)("data-v-1fb9186d"),e=e(),(0,o.Cn)(),e),qr={class:"element"},jr=Kr((()=>(0,o._)("div",{class:"key"},"ファイル",-1))),Vr={class:"value"},Zr={class:"key"},zr=["value","onInput"];function Yr(e,t,i,n,s,r){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{ref:"root",class:"root",style:(0,a.j5)(`height:${e.size.height}px`)},[(0,o._)("div",qr,[jr,(0,o._)("div",Vr,(0,a.zw)(e.filePath||"（新規棋譜）"),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.list,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.key,class:"element"},[(0,o._)("div",Zr,(0,a.zw)(t.displayName),1),(0,o._)("input",{class:"value",value:t.value,onInput:i=>e.change(i,t.key)},null,40,zr)])))),128))],4)])}var $r=(0,o.aZ)({name:"RecordComment",props:{size:{type:li,required:!0}},setup(){const e=(0,h.iH)(null),t=So(),i=(0,o.Fl)((()=>t.recordFilePath)),n=(0,o.Fl)((()=>Object.values(qe).map((e=>{const i=t.record.metadata;return{key:e,displayName:$e(e),value:i.getStandardMetadata(e)||""}}))));(0,o.bv)((()=>{e.value.addEventListener("copy",(e=>{e.stopPropagation()})),e.value.addEventListener("paste",(e=>{e.stopPropagation()}))}));const a=(e,i)=>{const n=e.target;t.updateStandardRecordMetadata({key:i,value:n.value})};return{root:e,filePath:i,list:n,change:a}}});const Jr=(0,yi.Z)($r,[["render",Yr],["__scopeId","data-v-1fb9186d"]]);var Xr=Jr;const Qr=30,el=240+Qr;var tl=(0,o.aZ)({name:"TabPane",components:{RecordComment:Ps,EngineAnalytics:Tr,EvaluationChart:Fr,RecordInfo:Xr,ButtonIcon:Ao},props:{size:{type:li,required:!0}},setup(e){const t=So(),i=e=>{t.updateAppSetting({tab:e}).catch((e=>{vn.log(ji.WARN,"TabPane: failed to update app setting: "+nt(e))}))},n=(0,o.Fl)((()=>t.appSetting.tab)),a=(0,o.Fl)((()=>e.size.reduce(new li(0,Qr))));return{activeTab:n,contentSize:a,headerHeight:Qr,changeSelect:i,Icon:Io,Tab:Ki,EvaluationChartType:Lr}}});const il=(0,yi.Z)(tl,[["render",bs],["__scopeId","data-v-05336efe"]]);var nl=il,ol=(0,o.aZ)({name:"StandardLayout",components:{BoardPane:Oa,RecordPane:ps,TabPane:nl},setup(){const e=(0,h.qj)(new li(0,0)),t=(0,h.iH)(new li(0,0)),i=()=>{e.width=window.innerWidth,e.height=window.innerHeight};(0,o.bv)((()=>{i(),window.addEventListener("resize",i)})),(0,o.Ah)((()=>{window.removeEventListener("resize",i)}));const n=e=>{t.value=e},a=(0,o.Fl)((()=>{const t=So().appSetting.tab!==Ki.INVISIBLE?el:Qr;return new li(e.width-hs,e.height-t)})),s=(0,o.Fl)((()=>({width:e.width-t.value.width+"px",height:`${t.value.height}px`}))),r=(0,o.Fl)((()=>new li(e.width,e.height-t.value.height)));return{boardPaneMaxSize:a,recordPaneStyle:s,bottomPaneSize:r,onBoardPaneResize:n}}});const al=(0,yi.Z)(ol,[["render",c],["__scopeId","data-v-c97084ae"]]);var sl=al;const rl=e=>((0,o.dD)("data-v-280b0f37"),e=e(),(0,o.Cn)(),e),ll={ref:"dialog"},cl=rl((()=>(0,o._)("div",{class:"dialog-title"},"対局",-1))),hl={class:"dialog-form-area"},dl={class:"players"},ul={class:"player"},pl=rl((()=>(0,o._)("div",{class:"top-label"},"先手（下手）",-1))),gl={class:"player"},ml=rl((()=>(0,o._)("div",{class:"top-label"},"後手（上手）",-1))),_l={class:"players-control"},vl=(0,o.Uk)(" 先後入れ替え "),Sl={class:"dialog-form-areas-h"},El={class:"dialog-form-area time-limit"},fl=rl((()=>(0,o._)("div",{class:"top-label"},"時間",-1))),Il={class:"dialog-form-item"},yl=rl((()=>(0,o._)("div",{class:"dialog-form-item-label"},"持ち時間",-1))),wl={ref:"hours",class:"time",type:"number",min:"0",max:"99",step:"1"},bl=rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"時間",-1))),Al={ref:"minutes",class:"time",type:"number",min:"0",max:"59",step:"1"},Tl=rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"分",-1))),Nl={class:"dialog-form-item"},Rl=rl((()=>(0,o._)("div",{class:"dialog-form-item-label"},"秒読み",-1))),kl={ref:"byoyomi",class:"time",type:"number",min:"0",max:"60",step:"1"},Pl=rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),Cl={class:"dialog-form-item"},Ol=rl((()=>(0,o._)("div",{class:"dialog-form-item-label"},"増加",-1))),Ml={ref:"increment",class:"time",type:"number",min:"0",max:"99",step:"1"},Hl=rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),Ll={class:"dialog-form-item"},Dl={id:"enable-engine-timeout",ref:"enableEngineTimeout",type:"checkbox"},Gl=rl((()=>(0,o._)("label",{for:"enable-engine-timeout"},"エンジンの時間切れあり",-1))),Bl={class:"dialog-form-area flags"},xl=rl((()=>(0,o._)("div",{class:"top-label"},"その他",-1))),Wl={class:"dialog-form-item"},Ul=rl((()=>(0,o._)("div",{class:"dialog-form-item-label"},"開始局面",-1))),Fl={ref:"startPosition"},Kl=(0,o.uE)('<option value="current" data-v-280b0f37>現在の局面</option><option value="standard" data-v-280b0f37>平手</option><option value="handicapLance" data-v-280b0f37>香落ち</option><option value="handicapRightLance" data-v-280b0f37>右香落ち</option><option value="handicapBishop" data-v-280b0f37>角落ち</option><option value="handicapRook" data-v-280b0f37>飛車落ち</option><option value="handicapRookLance" data-v-280b0f37>飛車香落ち</option><option value="handicap2Pieces" data-v-280b0f37>2枚落ち</option><option value="handicap4Pieces" data-v-280b0f37>4枚落ち</option><option value="handicap6Pieces" data-v-280b0f37>6枚落ち</option><option value="handicap8Pieces" data-v-280b0f37>8枚落ち</option>',11),ql=[Kl],jl={class:"dialog-form-item"},Vl=rl((()=>(0,o._)("div",{class:"dialog-form-item-label"},"最大手数",-1))),Zl={ref:"maxMoves",class:"number",type:"number",min:"1"},zl={class:"dialog-form-item"},Yl=rl((()=>(0,o._)("div",{class:"dialog-form-item-label"},"連続対局",-1))),$l={ref:"repeat",class:"number",type:"number",min:"1"},Jl={class:"dialog-form-item"},Xl={id:"swap-players",ref:"swapPlayers",type:"checkbox"},Ql=rl((()=>(0,o._)("label",{for:"swap-players"},"1局ごとに手番を入れ替える",-1))),ec={class:"dialog-form-item"},tc={id:"enable-comment",ref:"enableComment",type:"checkbox"},ic=rl((()=>(0,o._)("label",{for:"enable-comment"},"コメントを出力する",-1))),nc={class:"dialog-form-item"},oc={id:"enable-auto-save",ref:"enableAutoSave",type:"checkbox"},ac=rl((()=>(0,o._)("label",{for:"enable-auto-save"},"棋譜を自動で保存する",-1))),sc={class:"dialog-form-item"},rc={id:"human-is-front",ref:"humanIsFront",type:"checkbox"},lc=rl((()=>(0,o._)("label",{for:"human-is-front"},"人を手前に表示する",-1))),cc={class:"dialog-main-buttons"};function hc(e,t,i,n,a,s){const r=(0,o.up)("PlayerSelector"),l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",ll,[cl,(0,o._)("div",hl,[(0,o._)("div",dl,[(0,o._)("div",ul,[pl,(0,o.Wm)(r,{players:e.players,"player-uri":e.blackPlayerURI,"engine-settings":e.engineSettings.json,"display-ponder-state":!0,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectBlackPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])]),(0,o._)("div",gl,[ml,e.whitePlayerURI?((0,o.wg)(),(0,o.j4)(r,{key:0,players:e.players,"player-uri":e.whitePlayerURI,"engine-settings":e.engineSettings.json,"display-ponder-state":!0,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectWhitePlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])):(0,o.kq)("",!0)])]),(0,o._)("div",_l,[(0,o._)("button",{onClick:t[0]||(t[0]=(...t)=>e.onSwapColor&&e.onSwapColor(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.SWAP_H},null,8,["icon"]),vl])])]),(0,o._)("div",Sl,[(0,o._)("div",El,[fl,(0,o._)("div",Il,[yl,(0,o._)("input",wl,null,512),bl,(0,o._)("input",Al,null,512),Tl]),(0,o._)("div",Nl,[Rl,(0,o._)("input",kl,null,512),Pl]),(0,o._)("div",Cl,[Ol,(0,o._)("input",Ml,null,512),Hl]),(0,o._)("div",Ll,[(0,o._)("input",Dl,null,512),Gl])]),(0,o._)("div",Bl,[xl,(0,o._)("div",Wl,[Ul,(0,o._)("select",Fl,ql,512)]),(0,o._)("div",jl,[Vl,(0,o._)("input",Zl,null,512)]),(0,o._)("div",zl,[Yl,(0,o._)("input",$l,null,512)]),(0,o._)("div",Jl,[(0,o._)("input",Xl,null,512),Ql]),(0,o._)("div",ec,[(0,o._)("input",tc,null,512),ic]),(0,o._)("div",nc,[(0,o._)("input",oc,null,512),ac]),(0,o._)("div",sc,[(0,o._)("input",rc,null,512),lc])])]),(0,o._)("div",cc,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onStart())},"対局開始"),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onCancel())},"キャンセル")])],512)])}function dc(e){let t=Number(e.value);return e.max&&(t=Math.min(t,Number(e.max))),e.min&&(t=Math.max(t,Number(e.min))),t}const uc=e=>((0,o.dD)("data-v-2ccfb2d7"),e=e(),(0,o.Cn)(),e),pc={class:"root"},gc=["value"],mc=["value"],_c={key:0,class:"player-info"},vc=uc((()=>(0,o._)("span",{class:"player-info-key"},"先読み(Ponder):",-1))),Sc={class:"player-info-value"},Ec={key:1,class:"player-info"},fc=uc((()=>(0,o._)("span",{class:"player-info-key"},"スレッド数:",-1))),Ic={class:"player-info-value"},yc={key:2,class:"player-info"},wc=uc((()=>(0,o._)("span",{class:"player-info-key"},"マルチPV:",-1))),bc={class:"player-info-value"},Ac=["disabled"],Tc=(0,o.Uk)(" 設定 ");function Nc(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon"),c=(0,o.up)("USIEngineOptionDialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("div",pc,[(0,o._)("select",{ref:"playerSelect",class:"player-select",size:"1",value:e.playerUri,onChange:t[0]||(t[0]=(...t)=>e.onPlayerChange&&e.onPlayerChange(...t))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.players,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,a.zw)(e.name),9,mc)))),128))],40,gc),e.displayPonderState?((0,o.wg)(),(0,o.iD)("div",_c,[vc,(0,o._)("span",Sc,(0,a.zw)(e.ponderState||"---"),1)])):(0,o.kq)("",!0),e.displayThreadState?((0,o.wg)(),(0,o.iD)("div",Ec,[fc,(0,o._)("span",Ic,(0,a.zw)(e.threadState||"---"),1)])):(0,o.kq)("",!0),e.displayMultiPvState?((0,o.wg)(),(0,o.iD)("div",yc,[wc,(0,o._)("span",bc,(0,a.zw)(e.multiPVState||"---"),1)])):(0,o.kq)("",!0),(0,o._)("button",{class:"player-setting",disabled:!e.isPlayerSettingEnabled,onClick:t[1]||(t[1]=(...t)=>e.openPlayerSetting&&e.openPlayerSetting(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.SETTINGS},null,8,["icon"]),Tc],8,Ac)])]),e.engineSettingDialog?((0,o.wg)(),(0,o.j4)(c,{key:0,"latest-engine-setting":e.engineSettingDialog,"ok-button-text":"保存",onOk:e.savePlayerSetting,onCancel:e.closePlayerSetting},null,8,["latest-engine-setting","onOk","onCancel"])):(0,o.kq)("",!0)],64)}const Rc=e=>((0,o.dD)("data-v-63a94682"),e=e(),(0,o.Cn)(),e),kc={ref:"dialog"},Pc=Rc((()=>(0,o._)("div",{class:"dialog-title"},"エンジン設定",-1))),Cc={class:"dialog-form-area option-list"},Oc={class:"option"},Mc=Rc((()=>(0,o._)("div",{class:"option-name"},"エンジン名",-1))),Hc={class:"option-unchangeable"},Lc={class:"option"},Dc=Rc((()=>(0,o._)("div",{class:"option-name"},"作者",-1))),Gc={class:"option-unchangeable"},Bc={class:"option"},xc=Rc((()=>(0,o._)("div",{class:"option-name"},"場所",-1))),Wc={class:"option-unchangeable"},Uc={class:"option"},Fc=Rc((()=>(0,o._)("div",{class:"option-name"},"表示名",-1))),Kc={ref:"engineNameInput",class:"option-value-text",type:"text",name:"ElectronShogiEngineName"},qc={class:"option-name"},jc=["id","min","max","name"],Vc=["id","name"],Zc=["id","name"],zc=["onClick"],Yc=["id"],$c=Rc((()=>(0,o._)("option",{value:""},"既定値",-1))),Jc=Rc((()=>(0,o._)("option",{value:"true"},"ON",-1))),Xc=Rc((()=>(0,o._)("option",{value:"false"},"OFF",-1))),Qc=[$c,Jc,Xc],eh=["id"],th=Rc((()=>(0,o._)("option",{value:""},"既定値",-1))),ih=["value"],nh=["onClick"],oh={class:"dialog-main-buttons"};function ah(e,t,i,n,s,r){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",kc,[Pc,(0,o._)("div",Cc,[(0,o._)("div",Oc,[Mc,(0,o._)("div",Hc,(0,a.zw)(e.engine.defaultName),1)]),(0,o._)("div",Lc,[Dc,(0,o._)("div",Gc,(0,a.zw)(e.engine.author),1)]),(0,o._)("div",Bc,[xc,(0,o._)("div",Wc,(0,a.zw)(e.engine.path),1)]),(0,o._)("div",Uc,[Fc,(0,o._)("input",Kc,null,512)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.options,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.name,class:"option"},[(0,o._)("div",qc,(0,a.zw)(t.name),1),"spin"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:0,id:t.inputId,class:"option-value-number",type:"number",min:t.min,max:t.max,step:"1",name:t.name},null,8,jc)):(0,o.kq)("",!0),"string"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:1,id:t.inputId,class:"option-value-text",type:"text",name:t.name},null,8,Vc)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:2,id:t.inputId,class:"option-value-filename",type:"text",name:t.name},null,8,Zc)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:3,class:"dialog-button",onClick:i=>e.selectFile(t.inputId)}," 選択 ",8,zc)):(0,o.kq)("",!0),"check"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:4,id:t.inputId,class:"option-value-check"},Qc,8,Yc)):(0,o.kq)("",!0),"combo"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:5,id:t.inputId,class:"option-value-combo"},[th,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.vars,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e},(0,a.zw)(e),9,ih)))),128))],8,eh)):(0,o.kq)("",!0),"button"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:6,class:"dialog-button",onClick:i=>e.sendOption(t.name)}," 実行 ",8,nh)):(0,o.kq)("",!0)])))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.reset())}," エンジンの既定値に戻す "),(0,o._)("div",oh,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.ok())},(0,a.zw)(e.okButtonText),1),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)])}var sh=(0,o.aZ)({name:"USIEngineOptionDialog",props:{latestEngineSetting:{type:Object,required:!0},okButtonText:{type:String,required:!1,default:"OK"}},emits:["ok","cancel"],setup(e,t){const i=So(),n=(0,h.iH)(null),a=(0,h.iH)(null),s=e.latestEngineSetting,r=(0,h.iH)(s),l=(0,o.Fl)((()=>Object.values(r.value.options).sort(((e,t)=>{const i=e.name.startsWith("USI_"),n=t.name.startsWith("USI_");return i!==n?i?-1:1:e.name<t.name?-1:1})).map(((e,t)=>({...e,inputId:"usiEngineOptionDialogOption"+t,value:Hi(e)})))));i.retainBussyState(),(0,o.bv)((async()=>{Ho(n.value);try{r.value=await vn.getUSIEngineInfo(s.path),Di(r.value,s),a.value.value=r.value.name;for(const e of l.value){const t=Lo(e.inputId);t&&void 0!==e.value&&(t.value=e.value+"")}}catch(e){i.pushError(e),t.emit("cancel")}finally{i.releaseBussyState()}}));const c=async e=>{i.retainBussyState();try{const t=await vn.showSelectFileDialog(),n=Lo(e);t&&n&&(n.value=t)}catch(t){i.pushError(t)}finally{i.releaseBussyState()}},d=async e=>{i.retainBussyState();try{await vn.sendUSISetOption(r.value.path,e)}catch(t){i.pushError(t)}finally{i.releaseBussyState()}},u=()=>{a.value.value=r.value.defaultName;for(const e of l.value){const t=Lo(e.inputId);t&&(void 0!==r.value.options[e.name].default?t.value=r.value.options[e.name].default+"":t.value="")}},p=()=>{r.value.name=a.value.value;for(const e of l.value){const t=Lo(e.inputId);t&&(r.value.options[e.name].value=t.value?"spin"===e.type?dc(t):t.value:void 0)}t.emit("ok",r.value)},g=()=>{t.emit("cancel")};return{engine:r,dialog:n,engineNameInput:a,options:l,selectFile:c,sendOption:d,reset:u,ok:p,cancel:g}}});const rh=(0,yi.Z)(sh,[["render",ah],["__scopeId","data-v-63a94682"]]);var lh=rh,ch=(0,o.aZ)({name:"PlayerSelector",components:{ButtonIcon:Ao,USIEngineOptionDialog:lh},props:{players:{type:Array,required:!0},playerUri:{type:String,required:!0},engineSettings:{type:String,required:!0},displayPonderState:{type:Boolean,default:!1},displayThreadState:{type:Boolean,default:!1},displayMultiPvState:{type:Boolean,default:!1}},emits:["select-player","update-engine-setting"],setup(e,t){const i=So(),n=(0,h.iH)(null),a=(0,h.iH)(null),s=(0,o.Fl)((()=>{if(!Ni(e.playerUri))return null;const t=new Gi(e.engineSettings),i=t.getEngine(e.playerUri);return i&&"true"===Hi(i.options[ki])?"ON":"OFF"})),r=(0,o.Fl)((()=>{if(!Ni(e.playerUri))return null;const t=new Gi(e.engineSettings),i=t.getEngine(e.playerUri);if(!i)return null;const n=Hi(i.options[Ci])||Hi(i.options[Oi]);return n})),l=(0,o.Fl)((()=>{if(!Ni(e.playerUri))return null;const t=new Gi(e.engineSettings),i=t.getEngine(e.playerUri);if(!i)return null;const n=Hi(i.options[Pi])||Hi(i.options[Mi]);return n})),c=(0,o.Fl)((()=>Ni(e.playerUri))),d=()=>{if(Ni(e.playerUri)){const t=new Gi(e.engineSettings),n=t.getEngine(e.playerUri);if(!n)return void i.pushError("利用可能なエンジンが選択されていません。");a.value=n}},u=e=>{a.value=null,t.emit("update-engine-setting",e)},p=()=>{a.value=null},g=()=>{t.emit("select-player",n.value.value)};return{playerSelect:n,ponderState:s,threadState:r,multiPVState:l,isPlayerSettingEnabled:c,engineSettingDialog:a,onPlayerChange:g,openPlayerSetting:d,savePlayerSetting:u,closePlayerSetting:p,Icon:Io}}});const hh=(0,yi.Z)(ch,[["render",Nc],["__scopeId","data-v-2ccfb2d7"]]);var dh=hh,uh=(0,o.aZ)({name:"GameDialog",components:{ButtonIcon:Ao,PlayerSelector:dh},setup(){const e=So(),t=(0,h.iH)(null),i=(0,h.iH)(null),n=(0,h.iH)(null),a=(0,h.iH)(null),s=(0,h.iH)(null),r=(0,h.iH)(null),l=(0,h.iH)(null),c=(0,h.iH)(null),d=(0,h.iH)(null),u=(0,h.iH)(null),p=(0,h.iH)(null),g=(0,h.iH)(null),m=(0,h.iH)(null),_=(0,h.iH)(cn()),v=(0,h.iH)(new Gi),S=(0,h.iH)(""),E=(0,h.iH)("");e.retainBussyState(),(0,o.bv)((async()=>{try{_.value=await vn.loadGameSetting(),v.value=await vn.loadUSIEngineSetting(),S.value=_.value.black.uri,E.value=_.value.white.uri,Ho(t.value)}catch(i){e.pushError(i),e.closeModalDialog()}finally{e.releaseBussyState()}}));let f=!1;(0,o.ic)((()=>{f||(i.value.value=Math.floor(_.value.timeLimit.timeSeconds/3600),n.value.value=Math.floor(_.value.timeLimit.timeSeconds/60)%60,a.value.value=_.value.timeLimit.byoyomi,s.value.value=_.value.timeLimit.increment,r.value.value=void 0!==_.value.startPosition?_.value.startPosition:"current",l.value.checked=_.value.enableEngineTimeout,c.value.value=_.value.maxMoves,d.value.checked=_.value.humanIsFront,u.value.value=_.value.repeat,p.value.checked=_.value.swapPlayers,g.value.checked=_.value.enableComment,m.value.checked=_.value.enableAutoSave,f=!0)}));const I=e=>{if(Ni(e)&&v.value.hasEngine(e)){const t=v.value.getEngine(e);return{name:t.name,uri:e,usi:t}}return{name:"人",uri:Ai}},y=()=>{const t={black:I(S.value),white:I(E.value),timeLimit:{timeSeconds:60*(60*dc(i.value)+dc(n.value)),byoyomi:dc(a.value),increment:dc(s.value)},startPosition:"current"!==r.value.value?r.value.value:void 0,enableEngineTimeout:l.value.checked,maxMoves:dc(c.value),humanIsFront:d.value.checked,repeat:dc(u.value),swapPlayers:p.value.checked,enableComment:g.value.checked,enableAutoSave:m.value.checked},o=Sn()?hn(t):dn(t);o?e.pushError(o):e.startGame(t)},w=()=>{e.closeModalDialog()},b=async t=>{const i=new Gi(v.value.json);i.updateEngine(t),e.retainBussyState();try{await vn.saveUSIEngineSetting(i),v.value=i}catch(n){e.pushError(n)}finally{e.releaseBussyState()}},A=e=>{S.value=e},T=e=>{E.value=e},N=()=>{[S.value,E.value]=[E.value,S.value]},R=(0,o.Fl)((()=>[{name:"人",uri:Ai},...v.value.engineList]));return{CommentBehavior:Ui,dialog:t,hours:i,minutes:n,byoyomi:a,increment:s,startPosition:r,enableEngineTimeout:l,maxMoves:c,humanIsFront:d,repeat:u,swapPlayers:p,enableComment:g,enableAutoSave:m,engineSettings:v,blackPlayerURI:S,whitePlayerURI:E,players:R,onStart:y,onCancel:w,onUpdatePlayerSetting:b,onSelectBlackPlayer:A,onSelectWhitePlayer:T,onSwapColor:N,Icon:Io}}});const ph=(0,yi.Z)(uh,[["render",hc],["__scopeId","data-v-280b0f37"]]);var gh=ph;const mh=e=>((0,o.dD)("data-v-9f01fc12"),e=e(),(0,o.Cn)(),e),_h={ref:"dialog",class:"root"},vh=mh((()=>(0,o._)("div",{class:"dialog-title"},"通信対局（CSA プロトコル）",-1))),Sh={key:0,class:"dialog-form-area dialog-form-warning"},Eh=mh((()=>(0,o._)("div",{class:"dialog-form-note"}," 一部のログが無効になっています。 CSAプロトコルを使用した対局では各種ログの出力を推奨します。 アプリ設定からログを有効にしてアプリを再起動してください。 ",-1))),fh=[Eh],Ih={class:"dialog-form-area"},yh=mh((()=>(0,o._)("div",null,"プレイヤー",-1))),wh={class:"dialog-form-area"},bh={class:"dialog-form-item"},Ah=mh((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"履歴から選ぶ",-1))),Th={key:0,value:"0"},Nh=["value"],Rh=mh((()=>(0,o._)("hr",null,null,-1))),kh={class:"dialog-form-item"},Ph=mh((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"接続先ホスト",-1))),Ch={ref:"host",class:"long-text",list:"csa-server-host",type:"text"},Oh=mh((()=>(0,o._)("datalist",{id:"csa-server-host"},[(0,o._)("option",{value:"gserver.computer-shogi.org"}),(0,o._)("option",{value:"wdoor.c.u-tokyo.ac.jp"}),(0,o._)("option",{value:"localhost"})],-1))),Mh={class:"dialog-form-item"},Hh=mh((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"ポート番号",-1))),Lh={ref:"port",class:"number",list:"csa-server-port-number",type:"number"},Dh=mh((()=>(0,o._)("datalist",{id:"csa-server-port-number"},[(0,o._)("option",{value:"4081"})],-1))),Gh={class:"dialog-form-item"},Bh=mh((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"ID",-1))),xh={ref:"id",class:"long-text",type:"text"},Wh={class:"dialog-form-item"},Uh=mh((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"パスワード",-1))),Fh={ref:"password",class:"long-text",type:"password"},Kh={class:"dialog-form-item"},qh=mh((()=>(0,o._)("label",{for:"show-password"},"パスワードを表示する",-1))),jh={class:"dialog-form-item"},Vh={id:"save-history",ref:"saveHistory",type:"checkbox",checked:""},Zh={for:"save-history"},zh={class:"dialog-form-area"},Yh={class:"dialog-form-item"},$h=mh((()=>(0,o._)("div",{class:"dialog-form-item-label-wide number"},"連続対局",-1))),Jh={ref:"repeat",type:"number",min:"1"},Xh={class:"dialog-form-item"},Qh={id:"enable-comment",ref:"enableComment",type:"checkbox"},ed=mh((()=>(0,o._)("label",{for:"enable-comment"},"コメントを出力する",-1))),td={class:"dialog-form-item"},id={id:"enable-auto-save",ref:"enableAutoSave",type:"checkbox"},nd=mh((()=>(0,o._)("label",{for:"enable-auto-save"},"棋譜を自動で保存する",-1))),od={class:"dialog-form-item"},ad={id:"auto-flip",ref:"autoFlip",type:"checkbox"},sd=mh((()=>(0,o._)("label",{for:"auto-flip"},"盤面の向きを自動で調整する",-1))),rd={class:"dialog-main-buttons"};function ld(e,t,i,n,s,r){const l=(0,o.up)("PlayerSelector");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",_h,[vh,e.logEnabled?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Sh,fh)),(0,o._)("div",Ih,[yh,(0,o.Wm)(l,{players:e.players,"player-uri":e.playerURI,"engine-settings":e.engineSettings.json,"display-ponder-state":!0,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])]),(0,o._)("div",wh,[(0,o._)("div",bh,[Ah,(0,o._)("select",{class:"long-text",value:"0",onChange:t[0]||(t[0]=(...t)=>e.onChangeHistory&&e.onChangeHistory(...t))},[0===e.serverHistory.length?((0,o.wg)(),(0,o.iD)("option",Th," 履歴がありません ")):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.serverHistory,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.index,value:e.index},(0,a.zw)(e.host)+":"+(0,a.zw)(e.port)+" "+(0,a.zw)(e.id),9,Nh)))),128))],32)]),Rh,(0,o._)("div",kh,[Ph,(0,o._)("input",Ch,null,512),Oh]),(0,o._)("div",Mh,[Hh,(0,o._)("input",Lh,null,512),Dh]),(0,o._)("div",Gh,[Bh,(0,o._)("input",xh,null,512)]),(0,o._)("div",Wh,[Uh,(0,o._)("input",Fh,null,512)]),(0,o._)("div",Kh,[(0,o._)("input",{id:"show-password",type:"checkbox",onChange:t[1]||(t[1]=(...t)=>e.onTogglePasswordVisibility&&e.onTogglePasswordVisibility(...t))},null,32),qh]),(0,o._)("div",jh,[(0,o._)("input",Vh,null,512),(0,o._)("label",Zh," 履歴に保存する（最新"+(0,a.zw)(e.maxServerHistoryLenght)+"件まで） ",1)])]),(0,o._)("div",zh,[(0,o._)("div",Yh,[$h,(0,o._)("input",Jh,null,512)]),(0,o._)("div",Xh,[(0,o._)("input",Qh,null,512),ed]),(0,o._)("div",td,[(0,o._)("input",id,null,512),nd]),(0,o._)("div",od,[(0,o._)("input",ad,null,512),sd])]),(0,o._)("div",rd,[(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onStart())},"対局開始"),(0,o._)("button",{class:"dialog-button",onClick:t[3]||(t[3]=t=>e.onCancel())},"キャンセル")])],512)])}var cd=(0,o.aZ)({name:"CSAGameDialog",components:{PlayerSelector:dh},setup(){const e=So(),t=(0,h.iH)(null),i=(0,h.iH)(null),n=(0,h.iH)(null),a=(0,h.iH)(null),s=(0,h.iH)(null),r=(0,h.iH)(null),l=(0,h.iH)(null),c=(0,h.iH)(null),d=(0,h.iH)(null),u=(0,h.iH)(null),p=(0,h.iH)(Xn()),g=(0,h.iH)($n()),m=(0,h.iH)(new Gi),_=(0,h.iH)("");e.retainBussyState(),(0,o.bv)((async()=>{try{p.value=await vn.loadCSAGameSettingHistory(),g.value=Qn(p.value,0),m.value=await vn.loadUSIEngineSetting(),_.value=g.value.player.uri,Ho(t.value)}catch(i){e.pushError(i),e.closeModalDialog()}finally{e.releaseBussyState()}}));let v=!1;(0,o.ic)((()=>{v||(i.value.value=g.value.server.host,n.value.value=g.value.server.port,a.value.value=g.value.server.id,s.value.value=g.value.server.password,l.value.checked=g.value.enableComment,c.value.checked=g.value.enableAutoSave,d.value.value=g.value.repeat,u.value.checked=g.value.autoFlip,v=!0)}));const S=e=>{if(Ni(e)&&m.value.hasEngine(e)){const t=m.value.getEngine(e);return{name:t.name,uri:e,usi:t}}return{name:"人",uri:Ai}},E=()=>{const t={player:S(_.value),server:{host:String(i.value.value||"").trim(),port:Number(n.value.value),id:String(a.value.value||""),password:String(s.value.value||"")},enableComment:l.value.checked,enableAutoSave:c.value.checked,repeat:dc(d.value),autoFlip:u.value.checked},o=Jn(t);o?e.pushError(o):e.loginCSAGame(t,{saveHistory:r.value.checked})},f=()=>{e.closeModalDialog()},I=async t=>{const i=new Gi(m.value.json);i.updateEngine(t),e.retainBussyState();try{await vn.saveUSIEngineSetting(i),m.value=i}catch(n){e.pushError(n)}finally{e.releaseBussyState()}},y=e=>{_.value=e},w=e=>{const t=e.target;s.value.type=t.checked?"text":"password"},b=e=>{const t=e.target,o=p.value.serverHistory[Number(t.value)];o&&(i.value.value=o.host,n.value.value=o.port,a.value.value=o.id,s.value.value=o.password)},A=(0,o.Fl)((()=>[{name:"人",uri:Ai},...m.value.engineList])),T=(0,o.Fl)((()=>p.value.serverHistory.map(((e,t)=>({index:t,...e}))))),N=(0,o.Fl)((()=>e.appSetting.enableCSALog&&e.appSetting.enableAppLog&&e.appSetting.enableUSILog));return{maxServerHistoryLenght:eo,dialog:t,host:i,port:n,id:a,password:s,saveHistory:r,enableComment:l,enableAutoSave:c,repeat:d,autoFlip:u,engineSettings:m,playerURI:_,players:A,serverHistory:T,logEnabled:N,onStart:E,onCancel:f,onUpdatePlayerSetting:I,onSelectPlayer:y,onTogglePasswordVisibility:w,onChangeHistory:b,Icon:Io}}});const hd=(0,yi.Z)(cd,[["render",ld],["__scopeId","data-v-9f01fc12"]]);var dd=hd;const ud=e=>((0,o.dD)("data-v-34690848"),e=e(),(0,o.Cn)(),e),pd={ref:"dialog",class:"root"},gd=ud((()=>(0,o._)("div",{class:"dialog-title"},"検討",-1))),md={class:"dialog-form-area"},_d={class:"dialog-form-item"},vd={class:"dialog-main-buttons"};function Sd(e,t,i,n,a,s){const r=(0,o.up)("PlayerSelector");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",pd,[gd,(0,o._)("div",md,[(0,o._)("div",_d,[(0,o.Wm)(r,{players:e.engines,"player-uri":e.engineURI,"engine-settings":e.engineSettings.json,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])])]),(0,o._)("div",vd,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onStart())},"検討開始"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onCancel())},"キャンセル")])],512)])}var Ed=(0,o.aZ)({name:"ResearchDialog",components:{PlayerSelector:dh},setup(){const e=So(),t=(0,h.iH)(null),i=(0,h.iH)(un()),n=(0,h.iH)(new Gi),a=(0,h.iH)("");e.retainBussyState(),(0,o.bv)((async()=>{Ho(t.value);try{i.value=await vn.loadResearchSetting(),n.value=await vn.loadUSIEngineSetting(),a.value=i.value.usi?.uri||""}catch(o){e.pushError(o),e.closeModalDialog()}finally{e.releaseBussyState()}}));const s=(0,o.Fl)((()=>n.value.engineList)),r=()=>{if(!a.value||!n.value.hasEngine(a.value))return void e.pushError("エンジンを選択してください。");const t=n.value.getEngine(a.value),i={usi:t};e.startResearch(i)},l=()=>{e.closeModalDialog()},c=async t=>{const i=new Gi(n.value.json);i.updateEngine(t),e.retainBussyState();try{await vn.saveUSIEngineSetting(i),n.value=i}catch(o){e.pushError(o)}finally{e.releaseBussyState()}},d=e=>{a.value=e};return{dialog:t,engineSettings:n,engineURI:a,engines:s,onStart:r,onCancel:l,onUpdatePlayerSetting:c,onSelectPlayer:d}}});const fd=(0,yi.Z)(Ed,[["render",Sd],["__scopeId","data-v-34690848"]]);var Id=fd;const yd=e=>((0,o.dD)("data-v-0b032133"),e=e(),(0,o.Cn)(),e),wd={ref:"dialog"},bd=yd((()=>(0,o._)("div",{class:"dialog-title"},"エンジン管理",-1))),Ad={class:"dialog-form-area engine-list"},Td={key:0,class:"engine"},Nd=["value"],Rd={class:"engine-name"},kd=["onClick"],Pd=["onClick"],Cd=["onClick"],Od={class:"dialog-main-buttons"};function Md(e,t,i,n,s,r){const l=(0,o.up)("USIEngineOptionDialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("dialog",wd,[bd,(0,o._)("div",Ad,[0===e.engines.length?((0,o.wg)(),(0,o.iD)("div",Td," エンジンが登録されていません。 ")):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.uri,class:"engine",value:t.uri},[(0,o._)("div",Rd,(0,a.zw)(t.name),1),(0,o._)("button",{onClick:i=>e.openOptions(t.uri)},"設定",8,kd),(0,o._)("button",{onClick:i=>e.duplicate(t.uri)},"複製",8,Pd),(0,o._)("button",{onClick:i=>e.remove(t.uri)},"削除",8,Cd)],8,Nd)))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.add())},"追加"),(0,o._)("div",Od,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)]),e.optionDialog?((0,o.wg)(),(0,o.j4)(l,{key:0,"latest-engine-setting":e.optionDialog,onOk:e.optionOk,onCancel:e.optionCancel},null,8,["latest-engine-setting","onOk","onCancel"])):(0,o.kq)("",!0)],64)}var Hd=(0,o.aZ)({name:"USIEngineManagementDialog",components:{USIEngineOptionDialog:lh},setup(){const e=So(),t=(0,h.iH)(null),i=(0,h.iH)(null),n=(0,h.iH)(new Gi);e.retainBussyState(),(0,o.bv)((async()=>{Ho(t.value);try{n.value=await vn.loadUSIEngineSetting()}catch(i){e.pushError(i),e.closeModalDialog()}finally{e.releaseBussyState()}}));const a=async()=>{try{e.retainBussyState();const t=await vn.showSelectUSIEngineDialog();if(!t)return;n.value.addEngine(await vn.getUSIEngineInfo(t))}catch(t){e.pushError(t)}finally{e.releaseBussyState()}},s=e=>{n.value.removeEngine(e)},r=e=>{i.value=n.value.getEngine(e)},l=e=>{const t=n.value.getEngine(e),i=Li(t);n.value.addEngine(i)},c=async()=>{try{e.retainBussyState(),await vn.saveUSIEngineSetting(n.value),e.closeModalDialog()}catch(t){e.pushError(t)}finally{e.releaseBussyState()}},d=()=>{e.closeModalDialog()},u=e=>{n.value.updateEngine(e),i.value=null},p=()=>{i.value=null},g=(0,o.Fl)((()=>n.value.engineList));return{optionDialog:i,dialog:t,engines:g,add:a,remove:s,openOptions:r,duplicate:l,saveAndClose:c,cancel:d,optionOk:u,optionCancel:p}}});const Ld=(0,yi.Z)(Hd,[["render",Md],["__scopeId","data-v-0b032133"]]);var Dd=Ld;const Gd=e=>((0,o.dD)("data-v-cc44b198"),e=e(),(0,o.Cn)(),e),Bd={ref:"dialog"},xd=Gd((()=>(0,o._)("div",{class:"dialog-title"},"アプリ設定",-1))),Wd={class:"dialog-form-area settings"},Ud={class:"section"},Fd=Gd((()=>(0,o._)("div",{class:"section-title"},"外観",-1))),Kd={class:"dialog-form-item"},qd=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"テーマ",-1))),jd=["value"],Vd=["value"],Zd={class:"dialog-form-item"},zd=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒画像",-1))),Yd=["value"],$d=["value"],Jd={class:"dialog-form-item"},Xd=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"盤画像",-1))),Qd=["value"],eu=["value"],tu={class:"dialog-form-item"},iu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"段・筋を表示",-1))),nu=["checked"],ou=Gd((()=>(0,o._)("hr",null,null,-1))),au={class:"section"},su=Gd((()=>(0,o._)("div",{class:"section-title"},"音",-1))),ru={class:"dialog-form-item"},lu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒音の大きさ",-1))),cu=["value"],hu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),du={class:"dialog-form-item"},uu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の大きさ",-1))),pu=["value"],gu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),mu={class:"dialog-form-item"},_u=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の高さ",-1))),vu=["value"],Su=Gd((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"Hz (220 ~ 880)",-1))),Eu={class:"dialog-form-item"},fu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の対象",-1))),Iu=["value"],yu=Gd((()=>(0,o._)("option",{value:"all"},"全ての手番",-1))),wu=Gd((()=>(0,o._)("option",{value:"onlyUser"},"人の手番のみ",-1))),bu=[yu,wu],Au=Gd((()=>(0,o._)("hr",null,null,-1))),Tu={class:"section"},Nu=Gd((()=>(0,o._)("div",{class:"section-title"},"ファイル",-1))),Ru={class:"dialog-form-item"},ku=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"改行文字",-1))),Pu=["value"],Cu=Gd((()=>(0,o._)("option",{value:"crlf"},"CR + LF (Windows)",-1))),Ou=Gd((()=>(0,o._)("option",{value:"lf"},"LF (UNIX/Mac)",-1))),Mu=Gd((()=>(0,o._)("option",{value:"cr"},"CR (90年代Mac)",-1))),Hu=[Cu,Ou,Mu],Lu={class:"dialog-form-item"},Du=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"棋譜の自動保存先",-1))),Gu=["value"],Bu=Gd((()=>(0,o._)("hr",null,null,-1))),xu={class:"section"},Wu=Gd((()=>(0,o._)("div",{class:"section-title"},"評価値・期待勝率",-1))),Uu={class:"dialog-form-item"},Fu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"勝率換算係数",-1))),Ku=["value"],qu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"(推奨: 600 から 1500 まで)",-1))),ju={class:"dialog-form-item"},Vu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"緩手の閾値",-1))),Zu=["value"],zu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Yu={class:"dialog-form-item"},$u=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"疑問手の閾値",-1))),Ju=["value"],Xu=Gd((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Qu={class:"dialog-form-item"},ep=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"悪手の閾値",-1))),tp=["value"],ip=Gd((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),np={class:"dialog-form-item"},op=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"大悪手の閾値",-1))),ap=["value"],sp=Gd((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),rp=Gd((()=>(0,o._)("hr",null,null,-1))),lp={class:"section"},cp=Gd((()=>(0,o._)("div",{class:"section-title"},"開発者向け",-1))),hp={class:"dialog-form-area dialog-form-warning"},dp={key:0,class:"dialog-form-note"},up=Gd((()=>(0,o._)("div",{class:"dialog-form-note"}," ※ログの有効化にはアプリの再起動が必要です。 ",-1))),pp=Gd((()=>(0,o._)("div",{class:"dialog-form-note"}," ※ログの出力先は「デバッグ」-「ログファイルの場所を開く」で開きます。 ",-1))),gp=Gd((()=>(0,o._)("div",{class:"dialog-form-note"}," ※現在、古いログファイルの自動削除機能はありません。 ",-1))),mp={class:"dialog-form-item"},_p=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"アプリログを出力",-1))),vp=["checked"],Sp={class:"dialog-form-item"},Ep=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"USI通信ログを出力",-1))),fp=["checked"],Ip={class:"dialog-form-item"},yp=Gd((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"CSA通信ログを出力",-1))),wp=["checked"],bp={class:"dialog-main-buttons"};function Ap(e,t,i,n,s,r){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Bd,[xd,(0,o._)("div",Wd,[(0,o._)("div",Ud,[Fd,(0,o._)("div",Kd,[qd,(0,o._)("select",{ref:"thema",value:e.appSetting.thema},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.themaOptions,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.value,value:e.value},(0,a.zw)(e.name),9,Vd)))),128))],8,jd)]),(0,o._)("div",Zd,[zd,(0,o._)("select",{ref:"pieceImage",value:e.appSetting.pieceImage},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.pieceImageTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.value,value:e.value},(0,a.zw)(e.name),9,$d)))),128))],8,Yd)]),(0,o._)("div",Jd,[Xd,(0,o._)("select",{ref:"boardImage",value:e.appSetting.boardImage},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.boardImageTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.value,value:e.value},(0,a.zw)(e.name),9,eu)))),128))],8,Qd)]),(0,o._)("div",tu,[iu,(0,o._)("input",{ref:"displayBoardLabels",class:"toggle",checked:e.appSetting.boardLabelType!=e.BoardLabelType.NONE,type:"checkbox"},null,8,nu)])]),ou,(0,o._)("div",au,[su,(0,o._)("div",ru,[lu,(0,o._)("input",{ref:"pieceVolume",value:e.appSetting.pieceVolume,type:"number",max:"100",min:"0"},null,8,cu),hu]),(0,o._)("div",du,[uu,(0,o._)("input",{ref:"clockVolume",value:e.appSetting.clockVolume,type:"number",max:"100",min:"0"},null,8,pu),gu]),(0,o._)("div",mu,[_u,(0,o._)("input",{ref:"clockPitch",value:e.appSetting.clockPitch,type:"number",max:"880",min:"220"},null,8,vu),Su]),(0,o._)("div",Eu,[fu,(0,o._)("select",{ref:"clockSoundTarget",value:e.appSetting.clockSoundTarget},bu,8,Iu)])]),Au,(0,o._)("div",Tu,[Nu,(0,o._)("div",Ru,[ku,(0,o._)("select",{ref:"returnCode",value:e.appSetting.returnCode},Hu,8,Pu)]),(0,o._)("div",Lu,[Du,(0,o._)("input",{ref:"autoSaveDirectory",class:"directory",value:e.appSetting.autoSaveDirectory,type:"text"},null,8,Gu),(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=(...t)=>e.selectAutoSaveDirectory&&e.selectAutoSaveDirectory(...t))}," 選択 ")])]),Bu,(0,o._)("div",xu,[Wu,(0,o._)("div",Uu,[Fu,(0,o._)("input",{ref:"coefficientInSigmoid",value:e.appSetting.coefficientInSigmoid,type:"number",max:"10000",min:"1"},null,8,Ku),qu]),(0,o._)("div",ju,[Vu,(0,o._)("input",{ref:"badMoveLevelThreshold1",value:e.appSetting.badMoveLevelThreshold1,type:"number",max:"100",min:"0"},null,8,Zu),zu]),(0,o._)("div",Yu,[$u,(0,o._)("input",{ref:"badMoveLevelThreshold2",value:e.appSetting.badMoveLevelThreshold2,type:"number",max:"100",min:"0"},null,8,Ju),Xu]),(0,o._)("div",Qu,[ep,(0,o._)("input",{ref:"badMoveLevelThreshold3",value:e.appSetting.badMoveLevelThreshold3,type:"number",max:"100",min:"0"},null,8,tp),ip]),(0,o._)("div",np,[op,(0,o._)("input",{ref:"badMoveLevelThreshold4",value:e.appSetting.badMoveLevelThreshold4,type:"number",max:"100",min:"0"},null,8,ap),sp])]),rp,(0,o._)("div",lp,[cp,(0,o._)("div",hp,[e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",dp," ※ブラウザ版でログは出力されません。 ")),up,pp,gp]),(0,o._)("div",mp,[_p,(0,o._)("input",{ref:"enableAppLog",class:"toggle",checked:e.appSetting.enableAppLog,type:"checkbox"},null,8,vp)]),(0,o._)("div",Sp,[Ep,(0,o._)("input",{ref:"enableUSILog",class:"toggle",checked:e.appSetting.enableUSILog,type:"checkbox"},null,8,fp)]),(0,o._)("div",Ip,[yp,(0,o._)("input",{ref:"enableCSALog",class:"toggle",checked:e.appSetting.enableCSALog,type:"checkbox"},null,8,wp)])])]),(0,o._)("div",bp,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)])}const Tp={"\r\n":"crlf","\n":"lf","\r":"cr"},Np={crlf:"\r\n",lf:"\n",cr:"\r"};var Rp=(0,o.aZ)({name:"AppSettingDialog",setup(){const e=So(),t=(0,h.iH)(null),i=(0,h.iH)(null),n=(0,h.iH)(null),a=(0,h.iH)(null),s=(0,h.iH)(null),r=(0,h.iH)(null),l=(0,h.iH)(null),c=(0,h.iH)(null),d=(0,h.iH)(null),u=(0,h.iH)(null),p=(0,h.iH)(null),g=(0,h.iH)(null),m=(0,h.iH)(null),_=(0,h.iH)(null),v=(0,h.iH)(null),S=(0,h.iH)(null),E=(0,h.iH)(null),f=(0,h.iH)(null),I=(0,h.iH)(null);(0,o.bv)((()=>{Ho(t.value)}));const y=async()=>{const t={thema:i.value.value,pieceImage:n.value.value,boardImage:a.value.value,boardLabelType:s.value.checked?di.STANDARD:di.NONE,pieceVolume:dc(r.value),clockVolume:dc(l.value),clockPitch:dc(c.value),clockSoundTarget:d.value.value,returnCode:Np[u.value.value],autoSaveDirectory:p.value.value,coefficientInSigmoid:dc(g.value),badMoveLevelThreshold1:dc(m.value),badMoveLevelThreshold2:dc(_.value),badMoveLevelThreshold3:dc(v.value),badMoveLevelThreshold4:dc(S.value),enableAppLog:E.value.checked,enableUSILog:f.value.checked,enableCSALog:I.value.checked};e.retainBussyState();try{await e.updateAppSetting(t),e.closeAppSettingDialog()}catch(o){e.pushError(o)}finally{e.releaseBussyState()}},w=async()=>{e.retainBussyState();try{const t=await vn.showSelectDirectoryDialog(p.value.value);t&&(p.value.value=t)}catch(t){e.pushError(t)}finally{e.releaseBussyState()}},b=()=>{e.closeAppSettingDialog()},A=(0,o.Fl)((()=>({...e.appSetting,returnCode:Tp[e.appSetting.returnCode]}))),T=[{name:"標準（緑）",value:Fi.STANDARD},{name:"桜",value:Fi.CHERRY_BLOSSOM},{name:"ダーク",value:Fi.DARK}],N=[{name:"一文字駒",value:ci.HITOMOJI},{name:"一文字駒（ゴシック体）",value:ci.HITOMOJI_GOTHIC},{name:"一文字駒（ダーク）",value:ci.HITOMOJI_DARK},{name:"一文字駒（ゴシック体・ダーク）",value:ci.HITOMOJI_GOTHIC_DARK}],R=[{name:"木目（明るい）",value:hi.LIGHT},{name:"木目（暖かい）",value:hi.WARM},{name:"レジン",value:hi.RESIN},{name:"レジン2",value:hi.RESIN2},{name:"レジン3",value:hi.RESIN3},{name:"ダーク",value:hi.DARK},{name:"緑",value:hi.GREEN},{name:"桜",value:hi.CHERRY_BLOSSOM}];return{BoardLabelType:di,dialog:t,thema:i,pieceImage:n,boardImage:a,displayBoardLabels:s,pieceVolume:r,clockVolume:l,clockPitch:c,clockSoundTarget:d,returnCode:u,autoSaveDirectory:p,coefficientInSigmoid:g,badMoveLevelThreshold1:m,badMoveLevelThreshold2:_,badMoveLevelThreshold3:v,badMoveLevelThreshold4:S,enableAppLog:E,enableUSILog:f,enableCSALog:I,appSetting:A,themaOptions:T,pieceImageTypes:N,boardImageTypes:R,isNative:Sn(),selectAutoSaveDirectory:w,saveAndClose:y,cancel:b}}});const kp=(0,yi.Z)(Rp,[["render",Ap],["__scopeId","data-v-cc44b198"]]);var Pp=kp;const Cp=e=>((0,o.dD)("data-v-4490b135"),e=e(),(0,o.Cn)(),e),Op={ref:"dialog"},Mp={ref:"content"},Hp={class:"dialog-form-area"},Lp=Cp((()=>(0,o._)("div",{class:"message"},"以下の棋譜(または局面)を取り込みます。",-1))),Dp=Cp((()=>(0,o._)("div",{class:"message"},"※KIF形式/CSA形式/SFENに対応しています。",-1))),Gp={key:0,class:"message"},Bp=(0,o.Uk)(" ※テキストエリアに棋譜を貼り付けてください。"),xp=Cp((()=>(0,o._)("br",null,null,-1))),Wp=(0,o.Uk)(" ※インストールアプリ版では自動的に貼り付けられます。 "),Up=[Bp,xp,Wp],Fp={ref:"textarea"},Kp={class:"dialog-main-buttons"};function qp(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Op,[(0,o._)("div",Mp,[(0,o._)("div",Hp,[Lp,Dp,e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Gp,Up)),(0,o._)("textarea",Fp,null,512)])],512),(0,o._)("div",Kp,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=(...t)=>e.onOk&&e.onOk(...t))},"取り込む"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=(...t)=>e.onCancel&&e.onCancel(...t))},"キャンセル")])],512)])}var jp=(0,o.aZ)({name:"PasteDialog",setup(){const e=So(),t=(0,h.iH)(null),i=(0,h.iH)(null);e.retainBussyState(),(0,o.bv)((async()=>{try{Ho(t.value),Sn()&&(i.value.value=await navigator.clipboard.readText())}finally{e.releaseBussyState()}}));const n=()=>{const t=i.value.value;e.closeModalDialog(),t&&e.pasteRecord(t)},a=()=>{e.closeModalDialog()};return{dialog:t,textarea:i,onOk:n,onCancel:a,isNative:Sn()}}});const Vp=(0,yi.Z)(jp,[["render",qp],["__scopeId","data-v-4490b135"]]);var Zp=Vp;const zp=e=>((0,o.dD)("data-v-5dba5f52"),e=e(),(0,o.Cn)(),e),Yp={ref:"dialog",class:"bussy"},$p={class:"message-box"},Jp=zp((()=>(0,o._)("div",{class:"message"},"処理中です。お待ち下さい。",-1)));function Xp(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Yp,[(0,o._)("div",$p,[(0,o.Wm)(r,{class:"icon",icon:e.Icon.BUSSY},null,8,["icon"]),Jp])],512)])}var Qp=(0,o.aZ)({name:"BussyMessage",components:{ButtonIcon:Ao},setup(){const e=(0,h.iH)(null);return(0,o.bv)((()=>{Ho(e.value)})),{dialog:e,Icon:Io}}});const eg=(0,yi.Z)(Qp,[["render",Xp],["__scopeId","data-v-5dba5f52"]]);var tg=eg;const ig={ref:"dialog",class:"confirm"},ng={class:"message-box"},og={class:"message"},ag={class:"dialog-main-buttons"};function sg(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",ig,[(0,o._)("div",ng,[(0,o.Wm)(l,{class:"icon",icon:e.Icon.QUESTION},null,8,["icon"]),(0,o._)("div",og,(0,a.zw)(e.message),1)]),(0,o._)("div",ag,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onOk())},"OK"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onClose())},"キャンセル")])],512)])}var rg=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:Ao},setup(){const e=So(),t=(0,h.iH)(null),i=(0,o.Fl)((()=>e.confirmation)),n=()=>{e.confirmationOk()},a=()=>{e.confirmationCancel()};return(0,o.bv)((()=>{Ho(t.value,a)})),{dialog:t,message:i,onOk:n,onClose:a,Icon:Io}}});const lg=(0,yi.Z)(rg,[["render",sg],["__scopeId","data-v-e0767d9e"]]);var cg=lg;const hg={ref:"dialog",class:"info"},dg={class:"message-box"},ug={class:"message"},pg={key:0,class:"list"},gg={class:"dialog-main-buttons"};function mg(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",hg,[(0,o._)("div",dg,[(0,o.Wm)(l,{class:"icon",icon:e.Icon.INFO},null,8,["icon"]),(0,o._)("div",ug,(0,a.zw)(e.message.text),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.message.attachments,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,class:"attachment"},["list"===e.type?((0,o.wg)(),(0,o.iD)("ul",pg,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.items,((e,t)=>((0,o.wg)(),(0,o.iD)("li",{key:t,class:"list-item"},[(0,o.Uk)((0,a.zw)(e.text)+" ",1),(0,o._)("ul",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.children,((e,t)=>((0,o.wg)(),(0,o.iD)("li",{key:t,class:"list-child-item"},(0,a.zw)(e),1)))),128))])])))),128))])):(0,o.kq)("",!0)])))),128)),(0,o._)("div",gg,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var _g=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:Ao},setup(){const e=So(),t=(0,h.iH)(null);(0,o.bv)((()=>{Ho(t.value)}));const i=(0,o.Fl)((()=>e.message)),n=()=>{e.dequeueMessage()};return{dialog:t,message:i,onClose:n,Icon:Io}}});const vg=(0,yi.Z)(_g,[["render",mg],["__scopeId","data-v-1553f8ef"]]);var Sg=vg;const Eg={ref:"dialog",class:"error"},fg={class:"message-box"},Ig={class:"items"},yg={class:"notice"},wg={class:"index"},bg={class:"message"},Ag={class:"dialog-main-buttons"};function Tg(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Eg,[(0,o._)("div",fg,[(0,o.Wm)(l,{class:"icon",icon:e.Icon.ERROR},null,8,["icon"]),(0,o._)("div",Ig,[(0,o._)("div",yg,(0,a.zw)(e.errors.length)+" 件のエラーが発生しました。 ",1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.errors,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.index,class:"item"},[(0,o._)("p",wg,(0,a.zw)(e.index+1)+" 件目",1),(0,o._)("p",bg,(0,a.zw)(e.message),1)])))),128))])]),(0,o._)("div",Ag,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var Ng=(0,o.aZ)({name:"ErrorMessage",components:{ButtonIcon:Ao},setup(){const e=So(),t=(0,h.iH)(null);(0,o.bv)((()=>{Ho(t.value)}));const i=(0,o.Fl)((()=>e.errors.map(((e,t)=>({message:e.message,index:t}))))),n=()=>{e.clearErrors()};return{dialog:t,errors:i,onClose:n,Icon:Io}}});const Rg=(0,yi.Z)(Ng,[["render",Tg],["__scopeId","data-v-0a93ee62"]]);var kg=Rg;function Pg(){const e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement}function Cg(e,t){if(!Pg())switch(e){case"ArrowUp":return t.onArrowUp;case"ArrowDown":return t.onArrowDown;case"ArrowLeft":return t.onArrowLeft;case"ArrowRight":return t.onArrowRight}}function Og(e){document.addEventListener("keydown",(t=>{const i=Cg(t.key,e);i&&(t.preventDefault(),i())}))}const Mg=e=>((0,o.dD)("data-v-76d6e47d"),e=e(),(0,o.Cn)(),e),Hg={ref:"dialog",class:"root"},Lg=Mg((()=>(0,o._)("div",{class:"dialog-title"},"棋譜解析",-1))),Dg={class:"dialog-form-area"},Gg=Mg((()=>(0,o._)("div",null,"エンジン",-1))),Bg={class:"dialog-form-item"},xg={class:"dialog-form-area"},Wg=Mg((()=>(0,o._)("div",null,"開始条件",-1))),Ug={class:"dialog-form-item"},Fg=["checked"],Kg=["disabled","value"],qg=Mg((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"手目から",-1))),jg={class:"dialog-form-area"},Vg=Mg((()=>(0,o._)("div",null,"終了条件",-1))),Zg={class:"dialog-form-item"},zg=["checked"],Yg=["disabled","value"],$g=Mg((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"手目まで",-1))),Jg={class:"dialog-form-area"},Xg=Mg((()=>(0,o._)("div",null,"局面ごとの終了条件",-1))),Qg={class:"dialog-form-item"},em=["value"],tm=Mg((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒まで",-1))),im={class:"dialog-form-area"},nm=Mg((()=>(0,o._)("div",null,"出力設定",-1))),om={class:"dialog-form-item"},am=Mg((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"指し手コメント",-1))),sm=["value"],rm=["value"],lm=["value"],cm=["value"],hm=["value"],dm={class:"dialog-main-buttons"};function um(e,t,i,n,a,s){const r=(0,o.up)("PlayerSelector");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Hg,[Lg,(0,o._)("div",Dg,[Gg,(0,o._)("div",Bg,[(0,o.Wm)(r,{players:e.engines,"player-uri":e.engineURI,"engine-settings":e.engineSettings.json,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])])]),(0,o._)("div",xg,[Wg,(0,o._)("div",Ug,[(0,o._)("input",{ref:"enableStartNumber",class:"toggle",type:"checkbox",checked:e.defaultValues.enableStartNumber,onChange:t[0]||(t[0]=(...t)=>e.updateToggle&&e.updateToggle(...t))},null,40,Fg),(0,o._)("input",{ref:"startNumber",class:"small",type:"number",min:"1",step:"1",disabled:!e.defaultValues.enableStartNumber,value:e.defaultValues.startNumber},null,8,Kg),qg])]),(0,o._)("div",jg,[Vg,(0,o._)("div",Zg,[(0,o._)("input",{ref:"enableEndNumber",class:"toggle",type:"checkbox",checked:e.defaultValues.enableEndNumber,onChange:t[1]||(t[1]=(...t)=>e.updateToggle&&e.updateToggle(...t))},null,40,zg),(0,o._)("input",{ref:"endNumber",class:"small",type:"number",min:"1",step:"1",disabled:!e.defaultValues.enableEndNumber,value:e.defaultValues.endNumber},null,8,Yg),$g])]),(0,o._)("div",Jg,[Xg,(0,o._)("div",Qg,[(0,o._)("input",{ref:"maxSecondsPerMove",class:"small",type:"number",min:"0",step:"1",value:e.defaultValues.maxSecondsPerMove},null,8,em),tm])]),(0,o._)("div",im,[nm,(0,o._)("div",om,[am,(0,o._)("select",{ref:"commentBehavior",size:"1",value:e.defaultValues.commentBehavior},[(0,o._)("option",{value:e.CommentBehavior.NONE},"出力しない",8,rm),(0,o._)("option",{value:e.CommentBehavior.INSERT},"前方に加筆する",8,lm),(0,o._)("option",{value:e.CommentBehavior.APPEND},"末尾に加筆する",8,cm),(0,o._)("option",{value:e.CommentBehavior.OVERWRITE},"上書きする",8,hm)],8,sm)])]),(0,o._)("div",dm,[(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onStart())},"解析実行"),(0,o._)("button",{class:"dialog-button",onClick:t[3]||(t[3]=t=>e.onCancel())},"キャンセル")])],512)])}var pm=(0,o.aZ)({name:"ResearchDialog",components:{PlayerSelector:dh},setup(){const e=So(),t=(0,h.iH)(null),i=(0,h.iH)(null),n=(0,h.iH)(null),a=(0,h.iH)(null),s=(0,h.iH)(null),r=(0,h.iH)(null),l=(0,h.iH)(null),c=(0,h.iH)(sn()),d=(0,h.iH)(new Gi),u=(0,h.iH)("");e.retainBussyState(),(0,o.bv)((async()=>{Ho(t.value);try{c.value=await vn.loadAnalysisSetting(),d.value=await vn.loadUSIEngineSetting(),u.value=c.value.usi?.uri||""}catch(i){e.pushError(i),e.closeModalDialog()}finally{e.releaseBussyState()}}));const p=()=>{n.value.disabled=!i.value.checked,s.value.disabled=!a.value.checked},g=()=>{if(!u.value||!d.value.hasEngine(u.value))return void e.pushError("エンジンを選択してください。");const t=d.value.getEngine(u.value),o={usi:t,startCriteria:{enableNumber:i.value.checked,number:dc(n.value)},endCriteria:{enableNumber:a.value.checked,number:dc(s.value)},perMoveCriteria:{maxSeconds:dc(r.value)},commentBehavior:l.value.value};e.startAnalysis(o)},m=()=>{e.closeModalDialog()},_=async t=>{const i=new Gi(d.value.json);i.updateEngine(t),e.retainBussyState();try{await vn.saveUSIEngineSetting(i),d.value=i}catch(n){e.pushError(n)}finally{e.releaseBussyState()}},v=e=>{u.value=e},S=(0,o.Fl)((()=>d.value.engineList)),E=(0,o.Fl)((()=>({enableStartNumber:c.value.startCriteria.enableNumber,startNumber:c.value.startCriteria.number,enableEndNumber:c.value.endCriteria.enableNumber,endNumber:c.value.endCriteria.number,maxSecondsPerMove:c.value.perMoveCriteria.maxSeconds,commentBehavior:c.value.commentBehavior})));return{CommentBehavior:Ui,dialog:t,engineSettings:d,engineURI:u,enableStartNumber:i,startNumber:n,enableEndNumber:a,endNumber:s,maxSecondsPerMove:r,commentBehavior:l,engines:S,defaultValues:E,updateToggle:p,onStart:g,onCancel:m,onUpdatePlayerSetting:_,onSelectPlayer:v}}});const gm=(0,yi.Z)(pm,[["render",um],["__scopeId","data-v-76d6e47d"]]);var mm=gm;const _m=e=>((0,o.dD)("data-v-d0a6e96c"),e=e(),(0,o.Cn)(),e),vm={ref:"dialog",class:"bussy"},Sm={class:"message-box"},Em=_m((()=>(0,o._)("div",{class:"message"},"対局の開始を待っています。",-1))),fm={class:"dialog-main-buttons"};function Im(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",vm,[(0,o._)("div",Sm,[(0,o.Wm)(r,{class:"icon",icon:e.Icon.BUSSY},null,8,["icon"]),Em]),(0,o._)("div",fm,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onLogout())},"ログアウト")])],512)])}var ym=(0,o.aZ)({name:"CSAGameReadyDialog",components:{ButtonIcon:Ao},setup(){const e=So(),t=(0,h.iH)(null);(0,o.bv)((()=>{Ho(t.value)}));const i=()=>{e.logoutCSAGame()};return{dialog:t,Icon:Io,onLogout:i}}});const wm=(0,yi.Z)(ym,[["render",Im],["__scopeId","data-v-d0a6e96c"]]);var bm=wm,Am=(0,o.aZ)({name:"App",components:{StandardLayout:sl,GameDialog:gh,CSAGameDialog:dd,ResearchDialog:Id,USIEngineManagementDialog:Dd,AppSettingDialog:Pp,PasteDialog:Zp,BussyMessage:tg,ConfirmDialog:cg,InfoMessage:Sg,ErrorMessage:kg,AnalysisDialog:mm,CSAGameReadyDialog:bm},setup(){const e=So(),t=(0,o.Fl)((()=>e.appSetting.thema)),i=(0,o.Fl)((()=>({game:e.appState===Nn.GAME_DIALOG,csaGame:e.appState===Nn.CSA_GAME_DIALOG,research:e.appState===Nn.RESEARCH_DIALOG,analysis:e.appState===Nn.ANALYSIS_DIALOG,usiEngineSetting:e.appState===Nn.USI_ENGINE_SETTING_DIALOG,appSetting:e.isAppSettingDialogVisible,paste:e.appState===Nn.PASTE_DIALOG,bussy:e.isBussy,confirm:void 0!==e.confirmation,csaGameReady:e.csaGameState===io.READY}))),n=(0,o.Fl)((()=>e.hasMessage)),a=(0,o.Fl)((()=>e.hasError));return(0,o.bv)((()=>{const t=document.getElementsByTagName("body")[0];t.addEventListener("copy",(t=>{e.copyRecordKIF(),t.preventDefault()})),t.addEventListener("paste",(t=>{e.showPasteDialog(),t.preventDefault()})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{if(t.dataTransfer&&t.dataTransfer.files[0]){const i=t.dataTransfer.files[0].path;e.openRecord(i)}t.preventDefault()})),Og({onArrowUp(){const t=e.record.current.number;e.changeMoveNumber(t-1)},onArrowDown(){const t=e.record.current.number;e.changeMoveNumber(t+1)},onArrowLeft(){e.changeMoveNumber(0)},onArrowRight(){e.changeMoveNumber(Number.MAX_SAFE_INTEGER)}})})),{thema:t,dialogVisibilities:i,hasMessage:n,hasErrors:a}}});const Tm=(0,yi.Z)(Am,[["render",s],["__scopeId","data-v-12594b28"]]);var Nm,Rm=Tm;function km(){const e=So();mn.onSendError((t=>{e.pushError(t)})),mn.onMenuEvent((t=>{if(!e.isBussy)switch(t){case Nm.NEW_RECORD:e.resetRecord();break;case Nm.OPEN_RECORD:e.openRecord();break;case Nm.SAVE_RECORD:e.saveRecord({overwrite:!0});break;case Nm.SAVE_RECORD_AS:e.saveRecord();break;case Nm.COPY_RECORD:e.copyRecordKIF();break;case Nm.COPY_RECORD_CSA:e.copyRecordCSA();break;case Nm.COPY_RECORD_USI_BEFORE:e.copyRecordUSIBefore();break;case Nm.COPY_RECORD_USI_ALL:e.copyRecordUSIAll();break;case Nm.COPY_BOARD_SFEN:e.copyBoardSFEN();break;case Nm.PASTE_RECORD:e.showPasteDialog();break;case Nm.INSERT_INTERRUPT:e.insertSpecialMove(je.INTERRUPT);break;case Nm.INSERT_RESIGN:e.insertSpecialMove(je.RESIGN);break;case Nm.INSERT_DRAW:e.insertSpecialMove(je.DRAW);break;case Nm.INSERT_REPETITION_DRAW:e.insertSpecialMove(je.REPETITION_DRAW);break;case Nm.INSERT_MATE:e.insertSpecialMove(je.MATE);break;case Nm.INSERT_TIMEOUT:e.insertSpecialMove(je.TIMEOUT);break;case Nm.INSERT_FOUL_WIN:e.insertSpecialMove(je.FOUL_WIN);break;case Nm.INSERT_FOUL_LOSE:e.insertSpecialMove(je.FOUL_LOSE);break;case Nm.INSERT_ENTERING_OF_KING:e.insertSpecialMove(je.ENTERING_OF_KING);break;case Nm.INSERT_WIN_BY_DEFAULT:e.insertSpecialMove(je.WIN_BY_DEFAULT);break;case Nm.INSERT_LOSS_BY_DEFAULT:e.insertSpecialMove(je.LOSS_BY_DEFAULT);break;case Nm.REMOVE_CURRENT_MOVE:e.removeCurrentMove();break;case Nm.START_POSITION_EDITING:e.startPositionEditing();break;case Nm.END_POSITION_EDITING:e.endPositionEditing();break;case Nm.CHANGE_TURN:e.changeTurn();break;case Nm.INIT_POSITION_STANDARD:e.initializePosition(Oe.STANDARD);break;case Nm.INIT_POSITION_HANDICAP_LANCE:e.initializePosition(Oe.HANDICAP_LANCE);break;case Nm.INIT_POSITION_HANDICAP_RIGHT_LANCE:e.initializePosition(Oe.HANDICAP_RIGHT_LANCE);break;case Nm.INIT_POSITION_HANDICAP_BISHOP:e.initializePosition(Oe.HANDICAP_BISHOP);break;case Nm.INIT_POSITION_HANDICAP_ROOK:e.initializePosition(Oe.HANDICAP_ROOK);break;case Nm.INIT_POSITION_HANDICAP_ROOK_LANCE:e.initializePosition(Oe.HANDICAP_ROOK_LANCE);break;case Nm.INIT_POSITION_HANDICAP_2PIECES:e.initializePosition(Oe.HANDICAP_2PIECES);break;case Nm.INIT_POSITION_HANDICAP_4PIECES:e.initializePosition(Oe.HANDICAP_4PIECES);break;case Nm.INIT_POSITION_HANDICAP_6PIECES:e.initializePosition(Oe.HANDICAP_6PIECES);break;case Nm.INIT_POSITION_HANDICAP_8PIECES:e.initializePosition(Oe.HANDICAP_8PIECES);break;case Nm.INIT_POSITION_TSUME_SHOGI:e.initializePosition(Oe.TSUME_SHOGI);break;case Nm.INIT_POSITION_TSUME_SHOGI_2KINGS:e.initializePosition(Oe.TSUME_SHOGI_2KINGS);break;case Nm.START_GAME:e.showGameDialog();break;case Nm.START_CSA_GAME:e.showCSAGameDialog();break;case Nm.STOP_GAME:e.stopGame();break;case Nm.RESIGN:go.resign();break;case Nm.WIN:go.win();break;case Nm.LOGOUT:e.logoutCSAGame();break;case Nm.START_RESEARCH:e.showResearchDialog();break;case Nm.STOP_RESEARCH:e.stopResearch();break;case Nm.START_ANALYSIS:e.showAnalysisDialog();break;case Nm.STOP_ANALYSIS:e.stopAnalysis();break;case Nm.FLIP_BOARD:e.flipBoard();break;case Nm.APP_SETTING_DIALOG:e.showAppSettingDialog();break;case Nm.USI_ENGINE_SETTING_DIALOG:e.showUsiEngineManagementDialog();break}})),mn.onUSIBestMove(((e,t,i,n)=>{Fn(e,t,i,n)})),mn.onUSIInfo(((t,i,n,o,a)=>{const s=JSON.parse(a);e.updateUSIInfo(t,i,n,o,s),Kn(t,i,s)})),mn.onUSIPonderInfo(((t,i,n,o,a)=>{const s=JSON.parse(a);e.updateUSIPonderInfo(t,i,n,o,s),Kn(t,i,s)})),mn.onCSAGameSummary(((e,t)=>{ao(e,JSON.parse(t))})),mn.onCSAReject((e=>{so(e)})),mn.onCSAStart(((e,t)=>{ro(e,JSON.parse(t))})),mn.onCSAMove(((e,t,i)=>{lo(e,t,JSON.parse(i))})),mn.onCSAGameResult(((e,t,i)=>{co(e,t,i)})),mn.onCSAClose((e=>{ho(e)})),(0,o.YP)((()=>[e.appState,e.isBussy]),(([e,t])=>{mn.updateMenuState(e,t)})),mn.updateMenuState(e.appState,e.isBussy)}(function(e){e["NEW_RECORD"]="resetRecord",e["OPEN_RECORD"]="openRecord",e["SAVE_RECORD"]="saveRecord",e["SAVE_RECORD_AS"]="saveRecordAs",e["COPY_RECORD"]="copyRecord",e["COPY_RECORD_CSA"]="copyRecordCsa",e["COPY_RECORD_USI_BEFORE"]="copyRecordUsiBefore",e["COPY_RECORD_USI_ALL"]="copyRecordUsiAll",e["COPY_BOARD_SFEN"]="copyRecordSfen",e["PASTE_RECORD"]="pasteRecord",e["INSERT_INTERRUPT"]="insertInterrupt",e["INSERT_RESIGN"]="insertResign",e["INSERT_DRAW"]="insertDraw",e["INSERT_REPETITION_DRAW"]="insertRepetitionDraw",e["INSERT_MATE"]="insertMate",e["INSERT_TIMEOUT"]="insertTimeout",e["INSERT_FOUL_WIN"]="insertFoulWin",e["INSERT_FOUL_LOSE"]="insertFoulLose",e["INSERT_ENTERING_OF_KING"]="insertEnteringOfKing",e["INSERT_WIN_BY_DEFAULT"]="insertWinByDefault",e["INSERT_LOSS_BY_DEFAULT"]="insertLossByDefault",e["REMOVE_CURRENT_MOVE"]="remvoeCurrentMove",e["START_POSITION_EDITING"]="startPositionEditing",e["END_POSITION_EDITING"]="endPositionEditing",e["CHANGE_TURN"]="changeTurn",e["INIT_POSITION_STANDARD"]="initPositionStandard",e["INIT_POSITION_HANDICAP_LANCE"]="initPositionHandicapLance",e["INIT_POSITION_HANDICAP_RIGHT_LANCE"]="initPositionHandicapRightLance",e["INIT_POSITION_HANDICAP_BISHOP"]="initPositionHandicapBishop",e["INIT_POSITION_HANDICAP_ROOK"]="initPositionHandicapRook",e["INIT_POSITION_HANDICAP_ROOK_LANCE"]="initPositionHandicapRookLance",e["INIT_POSITION_HANDICAP_2PIECES"]="initPositionHandicap2Pieces",e["INIT_POSITION_HANDICAP_4PIECES"]="initPositionHandicap4Pieces",e["INIT_POSITION_HANDICAP_6PIECES"]="initPositionHandicap6Pieces",e["INIT_POSITION_HANDICAP_8PIECES"]="initPositionHandicap8Pieces",e["INIT_POSITION_TSUME_SHOGI"]="initPositionTsumeShogi",e["INIT_POSITION_TSUME_SHOGI_2KINGS"]="initPositionTsumeShogi2Kings",e["START_RESEARCH"]="startResearch",e["STOP_RESEARCH"]="stopResearch",e["START_ANALYSIS"]="startAnalysis",e["STOP_ANALYSIS"]="stopAnalysis",e["START_GAME"]="startGame",e["START_CSA_GAME"]="startCSAGame",e["STOP_GAME"]="stopGame",e["RESIGN"]="resign",e["WIN"]="win",e["LOGOUT"]="logout",e["FLIP_BOARD"]="flipBoard",e["APP_SETTING_DIALOG"]="appSetting",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSetting"})(Nm||(Nm={})),vn.log(ji.INFO,"start renderer process"),Pr.kL.register(...Pr.zX),km();const Pm=So();Promise.allSettled([vn.loadAppSetting().then((e=>{Pm.updateAppSetting(e)})).catch((e=>{Pm.pushError(new Error("アプリ設定の読み込み中にエラーが発生しました :"+e))})),vn.getRecordPathFromProcArg().then((e=>{e&&Pm.openRecord(e)}))]).finally((()=>{vn.log(ji.INFO,"mount app"),(0,n.ri)(Rm).mount("#app")}))},5832:function(){}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,n,o,a){if(!n){var s=1/0;for(h=0;h<e.length;h++){n=e[h][0],o=e[h][1],a=e[h][2];for(var r=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(r=!1,a<s&&(s=a));if(r){e.splice(h--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[n,o,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={826:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,s=n[0],r=n[1],l=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(l)var h=l(i)}for(t&&t(n);c<s.length;c++)a=s[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(h)},n=self["webpackChunkelectron_shogi"]=self["webpackChunkelectron_shogi"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(3161)}));n=i.O(n)})();
//# sourceMappingURL=index.e3ebc5c5.js.map